---

title: Bayesian Blocks

keywords: fastai
sidebar: home_sidebar

summary: "Partition a light curve with the Bayesian Block algorithm"
description: "Partition a light curve with the Bayesian Block algorithm"
nb_path: "nbs/14_bayesian.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/14_bayesian.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The functions implemented here are:</p>
<ul>
<li><p><a href="/wtlikebayesian#get_bb_partition"><code>get_bb_partition</code></a> to perform a BB partition. It requires a "fitness" function to perform an evaluation of the 
likelihoods for a set of sequential cells. There are two such, using the number of counts, and the Kerr likelihood. See the <a href="https://arxiv.org/pdf/1207.5578.pdf">Bayesian Block reference</a>.</p>
<ul>
<li><a href="/wtlikebayesian#CountFitness"><code>CountFitness</code></a></li>
<li><a href="/wtlikebayesian#LikelihoodFitness"><code>LikelihoodFitness</code></a>, the default</li>
</ul>
</li>
</ul>
<ul>
<li><a href="/wtlikebayesian#bb_overplot"><code>bb_overplot</code></a> which overplots fits to the partitioned blocks on the original light curve.</li>
</ul>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="CountFitness" class="doc_header"><code>class</code> <code>CountFitness</code><a href="https://github.com/tburnett/wtlike/tree/master/wtlike/bayesian.py#L20" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>CountFitness</code>(<strong><code>lc</code></strong>, <strong><code>p0</code></strong>=<em><code>0.05</code></em>) :: <code>FitnessFunc</code></p>
</blockquote>
<p>Adapted version of a astropy.stats.bayesian_blocks.FitnessFunc
Considerably modified to give the <code>fitness function</code> access to the cell data.</p>
<p>Implements the Event model using exposure instead of time.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="LikelihoodFitness" class="doc_header"><code>class</code> <code>LikelihoodFitness</code><a href="https://github.com/tburnett/wtlike/tree/master/wtlike/bayesian.py#L124" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>LikelihoodFitness</code>(<strong><code>lc</code></strong>, <strong><code>p0</code></strong>=<em><code>0.05</code></em>, <strong><code>npt</code></strong>=<em><code>50</code></em>) :: <a href="/wtlikebayesian#CountFitness"><code>CountFitness</code></a></p>
</blockquote>
<p>Fitness function that uses the full likelihood</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="doc_countfitness" class="doc_header"><code>doc_countfitness</code><a href="https://github.com/tburnett/wtlike/tree/master/wtlike/bayesian.py#L159" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>doc_countfitness</code>(<strong><code>fitness</code></strong>, <strong><code>light_curve_dict</code></strong>, <strong><code>source_name</code></strong>)</p>
</blockquote>
<h4 id="{class_name}-test-with-source-{source_name}">{class_name} test with source {source_name}<a class="anchor-link" href="#{class_name}-test-with-source-{source_name}"> </a></h4><p>Create object: <code>bbfitter = {class_name}(lc)</code></p>
<p>Object description:   {bbfitter}</p>
<p>Then <code>bbfitter({n})</code> returns the values
    {values}</p>
<p>Finally, the partition algorithm, 'bbfitter.fit()' returns {cffit}</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="get_bb_partition" class="doc_header"><code>get_bb_partition</code><a href="https://github.com/tburnett/wtlike/tree/master/wtlike/bayesian.py#L184" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>get_bb_partition</code>(<strong><code>config</code></strong>, <strong><code>lc</code></strong>, <strong><code>fitness_class</code></strong>=<em><code>'LikelihoodFitness'</code></em>, <strong><code>p0</code></strong>=<em><code>0.05</code></em>, <strong><code>key</code></strong>=<em><code>None</code></em>, <strong><code>clear</code></strong>=<em><code>False</code></em>)</p>
</blockquote>
<p>Perform Bayesian Block partition of the cells found in a light curve</p>
<ul>
<li>lc : input LightCurve object or DataFrame with fit cells</li>
<li>fitness_class</li>
</ul>
<p>return edges for partition</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="bb_overplot" class="doc_header"><code>bb_overplot</code><a href="https://github.com/tburnett/wtlike/tree/master/wtlike/bayesian.py#L213" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>bb_overplot</code>(<strong><code>config</code></strong>, <strong><code>lc</code></strong>, <strong><code>bb_fit</code></strong>, <strong><code>ax</code></strong>=<em><code>None</code></em>, <strong><code>source_name</code></strong>=<em><code>None</code></em>, <strong><code>step_name</code></strong>=<em><code>None</code></em>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>
<p>Plot light curve: cell fits with BB overplot</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Fit-blocks-and-overplot">Fit blocks and overplot<a class="anchor-link" href="#Fit-blocks-and-overplot"> </a></h3><p>The following code shows how to refit, and demonstrates the overplot function.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="WtLike" class="doc_header"><code>class</code> <code>WtLike</code><a href="https://github.com/tburnett/wtlike/tree/master/wtlike/bayesian.py#L226" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>WtLike</code>(<strong>*<code>pars</code></strong>, <strong>**<code>kwargs</code></strong>) :: <a href="/wtlikelightcurve#LightCurve"><code>LightCurve</code></a></p>
</blockquote>
<p>Inherit from <a href="/wtlikelightcurve#LightCurve"><code>LightCurve</code></a> and add Bayesian Block capability</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Test/Demonstration-with-3C-279">Test/Demonstration with 3C 279<a class="anchor-link" href="#Test/Demonstration-with-3C-279"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">time</span> full = WtLike(&#39;3C 279&#39;)
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>SourceData: photons and exposure for 3C 279: Restoring from cache with key &#34;3C 279_data&#34;
WtLike: Source 3C 279 with:
	 data:       179,695 photons from   2008-08-04 to 2021-04-21
	 exposure: 2,817,749 intervals from 2008-08-04 to 2021-04-20
CellData: Bin photon data into 663 1-week bins from 54683.0 to 59324.0
LightCurve: select 655 cells for fitting with e&gt;0.5 &amp; n&gt;2
CPU times: user 1.22 s, sys: 64.2 ms, total: 1.28 s
Wall time: 3.33 s
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary data-open="Hide Code" data-close="Show Code"></summary>
        <summary></summary>
        <div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">demo</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ### 3C 279 Demonstration</span>
<span class="sd">    First, the weekly light curve:</span>
<span class="sd">    {out1}    {fig1}</span>
<span class="sd">    </span>
<span class="sd">    Replot the figure with an expanded scale to see position of a flare:</span>
<span class="sd">    {fig2}</span>
<span class="sd">    {out3}    {fig3}</span>
<span class="sd">    {out4}    {fig4}</span>
<span class="sd">    </span>
<span class="sd">    Table of BB fits</span>
<span class="sd">    {bb_table}</span>
<span class="sd">    </span>
<span class="sd">    This can be compaared with Figure 4 from the [Kerr paper](https://arxiv.org/pdf/1910.00140.pdf)</span>
<span class="sd">    {kerr_fig4}</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">full</span>
    
    <span class="k">with</span> <span class="n">capture_print</span><span class="p">(</span><span class="s1">&#39;Create full weekly light curve&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">out1</span><span class="p">:</span>
        <span class="n">full</span> <span class="o">=</span> <span class="n">WtLike</span><span class="p">(</span><span class="s1">&#39;3C 279&#39;</span><span class="p">)</span>
    
    <span class="n">fig1</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span>
        <span class="n">full</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">yscale</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span><span class="mi">20</span><span class="p">),</span> <span class="n">ts_min</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span> <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;MJD&#39;</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">fignum</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
        <span class="n">width</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>  
    
    <span class="n">fig2</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span>
        <span class="n">full</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>  <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span> <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;MJD&#39;</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">fignum</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>  <span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="mi">57100</span><span class="p">,</span> <span class="mi">57300</span><span class="p">),),</span>
        <span class="n">width</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>  
    
    <span class="k">with</span> <span class="n">capture_print</span><span class="p">(</span><span class="s1">&#39;Define orbit-based subset around large flare at MJD 57189&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">out3</span><span class="p">:</span>
        <span class="n">orbit</span> <span class="o">=</span> <span class="n">full</span><span class="o">.</span><span class="n">view</span><span class="p">((</span><span class="mi">57186</span><span class="p">,</span> <span class="mi">57191</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="n">fig3</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span>
        <span class="n">orbit</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">tzero</span><span class="o">=</span><span class="mi">57186</span><span class="p">,</span>  <span class="n">ts_min</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>   <span class="n">fignum</span><span class="o">=</span><span class="mi">3</span> <span class="p">),</span>
            <span class="n">width</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>
    
    <span class="k">with</span> <span class="n">capture_print</span><span class="p">(</span><span class="s1">&#39;Apply BB and replot&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">out4</span><span class="p">:</span>
        <span class="n">orbit</span><span class="o">.</span><span class="n">applyBB</span><span class="p">()</span>
    <span class="n">fig4</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span>
        <span class="n">orbit</span><span class="o">.</span><span class="n">plot_BB</span><span class="p">(</span><span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">tzero</span><span class="o">=</span><span class="mi">57186</span><span class="p">,</span>  <span class="n">ts_min</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>   <span class="n">fignum</span><span class="o">=</span><span class="mi">4</span><span class="p">),</span>
                <span class="n">width</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>
    
    <span class="n">bb_table</span> <span class="o">=</span> <span class="n">orbit</span><span class="o">.</span><span class="n">bb_table</span><span class="p">()</span>
    
    <span class="n">kerr_fig4</span> <span class="o">=</span> <span class="n">image</span><span class="p">(</span><span class="s1">&#39;kerr_fig4.png&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">caption</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">locals</span><span class="p">()</span>

<span class="n">nbdoc</span><span class="p">(</span><span class="n">demo</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h3 id="3C-279-Demonstration">3C 279 Demonstration<a class="anchor-link" href="#3C-279-Demonstration"> </a></h3><p>First, the weekly light curve:</p>
<p><details  class="nbdoc-description" >  <summary> Create full weekly light curve </summary>  <div style="margin-left: 5%"><pre>SourceData: photons and exposure for 3C 279: Restoring from cache with key "3C 279_data"<br>WtLike: Source 3C 279 with:<br>    data:       179,695 photons from   2008-08-04 to 2021-04-21<br>     exposure: 2,817,749 intervals from 2008-08-04 to 2021-04-20<br>CellData: Bin photon data into 663 1-week bins from 54683.0 to 59324.0<br>LightCurve: select 655 cells for fitting with e&gt;0.5 & n&gt;2<br></pre></div> </details>    <div class="nbdoc_image"></p>
<p><figure style="margin-left: 5%" title="Figure 1">  <a href="images/demo_fig_01.png" title="images/demo_fig_01.png">    <img src="images/demo_fig_01.png" alt="Figure 1 at images/demo_fig_01.png" width=600>   </a> </figure>
&lt;/div&gt;</p>
<p>Replot the figure with an expanded scale to see position of a flare:</p>
<div class="nbdoc_image">
<figure style="margin-left: 5%" title="Figure 2">  <a href="images/demo_fig_02.png" title="images/demo_fig_02.png">    <img src="images/demo_fig_02.png" alt="Figure 2 at images/demo_fig_02.png" width=600>   </a> </figure>
</div><p><details  class="nbdoc-description" >  <summary> Define orbit-based subset around large flare at MJD 57189 </summary>  <div style="margin-left: 5%"><pre>CellData: Bin photon data into 80 orbit-based bins from 57186.1 to 57191.0<br>LightCurve: select 61 cells for fitting with e&gt;0.5 & n&gt;2<br></pre></div> </details>    <div class="nbdoc_image"></p>
<p><figure style="margin-left: 5%" title="Figure 3">  <a href="images/demo_fig_03.png" title="images/demo_fig_03.png">    <img src="images/demo_fig_03.png" alt="Figure 3 at images/demo_fig_03.png" width=600>   </a> </figure>
&lt;/div&gt;</p>
<p><details  class="nbdoc-description" >  <summary> Apply BB and replot </summary>  <div style="margin-left: 5%"><pre>Partitioned 61 cells into 10 blocks, using LikelihoodFitness <br>LightCurve: Loaded 10 / 10 cells for fitting<br></pre></div> </details>    <div class="nbdoc_image"></p>
<p><figure style="margin-left: 5%" title="Figure 4">  <a href="images/demo_fig_04.png" title="images/demo_fig_04.png">    <img src="images/demo_fig_04.png" alt="Figure 4 at images/demo_fig_04.png" width=600>   </a> </figure>
&lt;/div&gt;</p>
<p>Table of BB fits</p>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>t</th>
      <th>tw</th>
      <th>n</th>
      <th>flux</th>
      <th>ts</th>
      <th>errors</th>
      <th>limit</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>57186.624</td>
      <td>1.033</td>
      <td>45</td>
      <td>1.814</td>
      <td>76.300</td>
      <td>(-0.359, 0.396)</td>
      <td>2.528</td>
    </tr>
    <tr>
      <td>57187.722</td>
      <td>1.162</td>
      <td>456</td>
      <td>23.137</td>
      <td>3011.800</td>
      <td>(-1.107, 1.142)</td>
      <td>25.071</td>
    </tr>
    <tr>
      <td>57188.436</td>
      <td>0.266</td>
      <td>186</td>
      <td>30.939</td>
      <td>1356.400</td>
      <td>(-2.26, 2.373)</td>
      <td>35.023</td>
    </tr>
    <tr>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <td>57189.631</td>
      <td>0.074</td>
      <td>146</td>
      <td>23.458</td>
      <td>1059.500</td>
      <td>(-1.928, 2.037)</td>
      <td>26.984</td>
    </tr>
    <tr>
      <td>57189.927</td>
      <td>0.518</td>
      <td>259</td>
      <td>12.379</td>
      <td>1447.100</td>
      <td>(-0.793, 0.826)</td>
      <td>13.790</td>
    </tr>
    <tr>
      <td>57190.578</td>
      <td>0.783</td>
      <td>212</td>
      <td>3.700</td>
      <td>662.700</td>
      <td>(-0.292, 0.306)</td>
      <td>4.224</td>
    </tr>
  </tbody>
</table>
</div><p>This can be compaared with Figure 4 from the <a href="https://arxiv.org/pdf/1910.00140.pdf">Kerr paper</a></p>
<div class="nbdoc_image">
<figure style="margin-left: 5%" title="Figure 5">  <a href="images/demo_fig_05.png" title="images/demo_fig_05.png">    <img src="images/demo_fig_05.png" alt="Figure 5 at images/demo_fig_05.png" width=600>   </a> </figure>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

