---

title: Manage cell data

keywords: fastai
sidebar: home_sidebar

summary: "Create cells from source data"
description: "Create cells from source data"
nb_path: "nbs/08_cell_data.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/08_cell_data.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Creating-cells">Creating cells<a class="anchor-link" href="#Creating-cells"> </a></h2><p>As set out in Kerr, we choose binning in time to group photons into "cells". For each cell, we determine its likelihood function, which is then used to estimate the signal rate for that duration.</p>
<p>Eqn. 2 of Kerr shows the log likelihood as a sum of cells of the log likelihoods of the cells, where the $k^{th}$ cell's likelihood,  (with $\beta=0$), is</p>
<p>{% raw %}
$$ \displaystyle\log\mathcal{L}_k(\alpha)\ = \sum_{w}  \log \big( 1 + \alpha\ w \big) - \alpha\ f_k\ S   $$
{% endraw %}</p>
<p>The sum is over the weights $w$ in that cell, and $S$ is an estimate of the signal count flux, and $f_k$ is the total exposure for that $k^{th}$ cell. Note that $f_k$ can be expressed as the sum of the exposures per photon, accumulated over the live time, which is from the start of the run or the previous photon.</p>
<p><em>Fermi</em> data is broken into distinct runs, corresponding at most to a single orbit. The effective area, $\frac{df}{dt}$ varies by a factor of 2 or 3 for each 90-min orbit, is typically  $ 3 000\ \mathrm{cm}^2$, or $0.3\ \mathrm{m^2}$ for $fermi$. This is measured in 30-s intervals.</p>
<p>We'll call the exposure per photon $\tau$ to emphasize that it plays the role of time.</p>
<p>So for the $i^{th}$ photon,<br>
{% raw %}
$$\displaystyle\log\mathcal{L}_i(\alpha) = \log( 1 + \alpha\ w_i) - \alpha\  \tau_i\ S  $$
{% endraw %}</p>
<p>This corresponds to an exponential distribution in $\tau$.</p>
<h4 id="Band-cells">Band cells<a class="anchor-link" href="#Band-cells"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="time_bin_edges" class="doc_header"><code>time_bin_edges</code><a href="https://github.com/tburnett/wtlike/tree/master/wtlike/cell_data.py#L15" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>time_bin_edges</code>(<strong><code>config</code></strong>, <strong><code>exposure</code></strong>, <strong><code>tbin</code></strong>=<em><code>None</code></em>)</p>
</blockquote>
<p>Return an interleaved array of start/stop values</p>
<p>tbin: an array (a,b,d), default config.time_bins</p>
<p>interpretation of a, b:</p>

<pre><code>if &gt; 50000, interpret as MJD
if &lt;0, back from stop
otherwise, offset from start

</code></pre>
<p>d : if positive, the day bin size
    if 0; return contiguous bins</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="contiguous_bins" class="doc_header"><code>contiguous_bins</code><a href="https://github.com/tburnett/wtlike/tree/master/wtlike/cell_data.py#L64" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>contiguous_bins</code>(<strong><code>exposure</code></strong>, <strong><code>min_gap</code></strong>=<em><code>20</code></em>, <strong><code>min_duration</code></strong>=<em><code>600</code></em>)</p>
</blockquote>
<p>return a start/stop interleaved array for contiguous intervals</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="make_cells" class="doc_header"><code>make_cells</code><a href="https://github.com/tburnett/wtlike/tree/master/wtlike/cell_data.py#L96" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>make_cells</code>(<strong><code>exposure_factor</code></strong>=<em><code>1e-06</code></em>)</p>
</blockquote>
<p>New procedure, using photon exposure</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Test-new-cell-code">Test new cell code<a class="anchor-link" href="#Test-new-cell-code"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">config</span><span class="o">=</span><span class="n">Config</span><span class="p">();</span> <span class="n">config</span><span class="o">.</span><span class="n">verbose</span><span class="o">=</span><span class="mi">2</span>
<span class="n">source</span> <span class="o">=</span> <span class="n">PointSource</span><span class="p">(</span><span class="s1">&#39;Geminga&#39;</span><span class="p">)</span>

<span class="n">newcd</span> <span class="o">=</span> <span class="n">CellData</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">,</span> <span class="n">week_range</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="mi">11</span><span class="p">),</span> <span class="n">time_bins</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> 
                 <span class="n">key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">new_cells</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span><span class="c1">#clear=True)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>SelectData: Loading weeks slice(9, 11, None)
Loading file /home/burnett/wtlike_data/data_files/week_009.pkl-----
Opened week file &#34;week_009.pkl&#34; of 2008-08-04 15:44
	Found 104,927 photons, 4,970 SC entries)
	Found 4,970 S/C entries:  1,907 remain after zenith and theta cuts
Calculate exposure using the energy domain 100.0-1000000.0 5 bins/decade
Loading file /home/burnett/wtlike_data/data_files/week_010.pkl-----
Opened week file &#34;week_010.pkl&#34; of 2008-08-07 03:36
	Found 352,693 photons, 16,826 SC entries)
	Found 16,826 S/C entries:  5,633 remain after zenith and theta cuts
Calculate exposure using the energy domain 100.0-1000000.0 5 bins/decade
Loading file /home/burnett/wtlike_data/data_files/week_011.pkl-----
Opened week file &#34;week_011.pkl&#34; of 2008-08-14 01:08
	Found 359,189 photons, 16,617 SC entries)
	Found 16,617 S/C entries:  3,760 remain after zenith and theta cuts
Calculate exposure using the energy domain 100.0-1000000.0 5 bins/decade

SourceData: Source Geminga with:
	 data:         4,606 photons from 2008-08-04 to 2008-08-20
	 exposure:    11,300 intervals,  average flux 3101 cm^2 for 0.3 Ms
	 rates:  source 3.32e-06/s, background 1.08e-06/s, S/N ratio 3.08e+00
CellData: Bin photon data into 16 1-day bins from 54683.0 to 54699.0
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cells</span> <span class="o">=</span> <span class="n">newcd</span><span class="o">.</span><span class="n">cells</span><span class="p">;</span> <span class="n">cells</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>t</th>
      <th>tw</th>
      <th>e</th>
      <th>B</th>
      <th>oldS</th>
      <th>n</th>
      <th>S</th>
      <th>w</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>54683.5</td>
      <td>1.0</td>
      <td>71.25</td>
      <td>76.72</td>
      <td>236.47</td>
      <td>295</td>
      <td>238.89</td>
      <td>[0.95947265625, 0.8427734375, 0.419921875, 0.9...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>54684.5</td>
      <td>1.0</td>
      <td>68.49</td>
      <td>73.74</td>
      <td>227.30</td>
      <td>317</td>
      <td>230.76</td>
      <td>[0.9189453125, 0.77978515625, 0.927734375, 0.9...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>54685.5</td>
      <td>1.0</td>
      <td>66.66</td>
      <td>71.78</td>
      <td>221.23</td>
      <td>323</td>
      <td>212.49</td>
      <td>[0.495361328125, 0.414794921875, 0.41723632812...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>54686.5</td>
      <td>1.0</td>
      <td>79.35</td>
      <td>85.44</td>
      <td>263.35</td>
      <td>367</td>
      <td>263.99</td>
      <td>[0.8583984375, 0.89501953125, 0.93310546875, 0...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>54687.5</td>
      <td>1.0</td>
      <td>73.23</td>
      <td>78.85</td>
      <td>243.03</td>
      <td>319</td>
      <td>237.13</td>
      <td>[0.685546875, 0.9453125, 0.72900390625, 0.6425...</td>
    </tr>
    <tr>
      <th>5</th>
      <td>54688.5</td>
      <td>1.0</td>
      <td>75.79</td>
      <td>81.61</td>
      <td>251.53</td>
      <td>316</td>
      <td>259.21</td>
      <td>[0.9140625, 0.94189453125, 0.90234375, 0.89550...</td>
    </tr>
    <tr>
      <th>6</th>
      <td>54689.5</td>
      <td>1.0</td>
      <td>66.90</td>
      <td>72.04</td>
      <td>222.03</td>
      <td>295</td>
      <td>219.63</td>
      <td>[0.869140625, 0.6845703125, 0.80517578125, 0.7...</td>
    </tr>
    <tr>
      <th>7</th>
      <td>54690.5</td>
      <td>1.0</td>
      <td>70.57</td>
      <td>75.99</td>
      <td>234.22</td>
      <td>298</td>
      <td>231.06</td>
      <td>[0.62548828125, 0.90185546875, 0.6845703125, 0...</td>
    </tr>
    <tr>
      <th>8</th>
      <td>54691.5</td>
      <td>1.0</td>
      <td>62.94</td>
      <td>67.77</td>
      <td>208.87</td>
      <td>294</td>
      <td>209.44</td>
      <td>[0.904296875, 0.9794921875, 0.134521484375, 0....</td>
    </tr>
    <tr>
      <th>9</th>
      <td>54692.5</td>
      <td>1.0</td>
      <td>64.74</td>
      <td>69.71</td>
      <td>214.85</td>
      <td>277</td>
      <td>202.28</td>
      <td>[0.447021484375, 0.90478515625, 0.117309570312...</td>
    </tr>
    <tr>
      <th>10</th>
      <td>54693.5</td>
      <td>1.0</td>
      <td>55.45</td>
      <td>59.71</td>
      <td>184.02</td>
      <td>250</td>
      <td>185.50</td>
      <td>[0.9375, 0.41455078125, 0.72265625, 0.94433593...</td>
    </tr>
    <tr>
      <th>11</th>
      <td>54694.5</td>
      <td>1.0</td>
      <td>59.64</td>
      <td>64.22</td>
      <td>197.93</td>
      <td>245</td>
      <td>194.04</td>
      <td>[0.93408203125, 0.81591796875, 0.84619140625, ...</td>
    </tr>
    <tr>
      <th>12</th>
      <td>54695.5</td>
      <td>1.0</td>
      <td>52.91</td>
      <td>56.97</td>
      <td>175.60</td>
      <td>211</td>
      <td>171.37</td>
      <td>[0.7080078125, 0.92431640625, 0.88232421875, 0...</td>
    </tr>
    <tr>
      <th>13</th>
      <td>54696.5</td>
      <td>1.0</td>
      <td>46.10</td>
      <td>49.64</td>
      <td>153.00</td>
      <td>207</td>
      <td>150.57</td>
      <td>[0.76904296875, 0.96435546875, 0.126708984375,...</td>
    </tr>
    <tr>
      <th>14</th>
      <td>54697.5</td>
      <td>1.0</td>
      <td>55.53</td>
      <td>59.80</td>
      <td>184.30</td>
      <td>254</td>
      <td>180.75</td>
      <td>[0.074462890625, 0.66162109375, 0.927734375, 0...</td>
    </tr>
    <tr>
      <th>15</th>
      <td>54698.5</td>
      <td>1.0</td>
      <td>47.44</td>
      <td>51.08</td>
      <td>157.44</td>
      <td>202</td>
      <td>154.32</td>
      <td>[0.87158203125, 0.98291015625, 0.90478515625, ...</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">cells</span><span class="o">.</span><span class="n">oldS</span><span class="p">,</span> <span class="n">cells</span><span class="o">.</span><span class="n">S</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">);</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-6-94f1d56aa7e4&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-intense-fg ansi-bold">      1</span> <span class="ansi-green-fg">import</span> matplotlib<span class="ansi-blue-fg">.</span>pyplot <span class="ansi-green-fg">as</span> plt
<span class="ansi-green-fg">----&gt; 2</span><span class="ansi-red-fg"> </span>plt<span class="ansi-blue-fg">.</span>plot<span class="ansi-blue-fg">(</span>cells<span class="ansi-blue-fg">.</span>oldS<span class="ansi-blue-fg">,</span> cells<span class="ansi-blue-fg">.</span>S<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">&#39;.&#39;</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">;</span>

<span class="ansi-red-fg">NameError</span>: name &#39;cells&#39; is not defined</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="concatenate_cells" class="doc_header"><code>concatenate_cells</code><a href="https://github.com/tburnett/wtlike/tree/master/wtlike/cell_data.py#L326" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>concatenate_cells</code>(<strong><code>cells</code></strong>)</p>
</blockquote>
<p>Combine a group of cells to one</p>
<ul>
<li>cells: dataframe with cells containing  n, w, S, B<br>
<pre><code>  Optionally, if $t$ is present, generate t and tw
</code></pre>
Return a dict with summed n, S, B, and concatenated w</li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="partition_cells" class="doc_header"><code>partition_cells</code><a href="https://github.com/tburnett/wtlike/tree/master/wtlike/cell_data.py#L344" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>partition_cells</code>(<strong><code>config</code></strong>, <strong><code>cells</code></strong>, <strong><code>edges</code></strong>)</p>
</blockquote>
<p>Partition a set of cells</p>
<ul>
<li>cells -- A DataFrame of cells</li>
<li>edges  -- a list of edge times delimiting boundaries between cells</li>
</ul>
<p>Returns a DataFrame of combined cells, with times and widths adjusted to account for missing cells</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Study-cell-formation-with-Geminga">Study cell formation with Geminga<a class="anchor-link" href="#Study-cell-formation-with-Geminga"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cd</span><span class="o">.</span><span class="n">cells</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>t</th>
      <th>tw</th>
      <th>e</th>
      <th>n</th>
      <th>w</th>
      <th>S</th>
      <th>B</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>54686.5</td>
      <td>7.0</td>
      <td>501.67</td>
      <td>2232</td>
      <td>[0.95947265625, 0.8427734375, 0.419921875, 0.9...</td>
      <td>1664.94</td>
      <td>540.18</td>
    </tr>
    <tr>
      <th>1</th>
      <td>54693.5</td>
      <td>7.0</td>
      <td>412.35</td>
      <td>1782</td>
      <td>[0.62548828125, 0.90185546875, 0.6845703125, 0...</td>
      <td>1368.51</td>
      <td>444.00</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

