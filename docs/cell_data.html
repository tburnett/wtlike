---

title: Manage cell data


keywords: fastai
sidebar: home_sidebar

summary: "Create cells from source data"
description: "Create cells from source data"
nb_path: "nbs/08_cell_data.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/08_cell_data.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Creating-cells">Creating cells<a class="anchor-link" href="#Creating-cells"> </a></h2><p>As set out in Kerr, we create "cells" by binning in time to form light curves. For each cell, we determine its likelihood function, which is then used to estimate the signal rate for that duration.</p>
<p>Eqn. 2 of Kerr presents the log likelihood as a sum of cells of the log likelihoods of the cells, where the $k^{th}$ cell's likelihood,  (with $\beta=0$), is</p>
<p>{% raw %}
$$ \displaystyle\log\mathcal{L}_k(\alpha)\ = \sum_{w}  \log \big( 1 + \alpha\ w \big) - \alpha\ f_k\ S   $$
{% endraw %}</p>
<p>The sum is over the weights $w$ in that cell, and $S$ is an estimate of the signal count flux, and $f_k$ is the total exposure for that $k^{th}$ cell.</p>
<p><em>Fermi</em> data is broken into distinct runs, corresponding at most to a single orbit. The effective area, $\frac{df}{dt}$ varies by a factor of 2 or 3 for each 90-min orbit, is typically  $ 3 000\ \mathrm{cm}^2$, or $0.3\ \mathrm{m^2}$. This is measured in 30-s intervals.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Implementation">Implementation<a class="anchor-link" href="#Implementation"> </a></h2><p>The class <a href="/wtlikecell_data.html#CellData"><code>CellData</code></a> is created with the list of photons and exposure history for the source. It is created with 
a <code>time_bins</code> argument to describe the binning, generating a list, accessible via the property <code>cells</code> with the cell information needed to calculate the likelihood function.</p>
<p>Its <code>view</code> member function is used to create a new binning, by making a copy of the <a href="/wtlikecell_data.html#CellData"><code>CellData</code></a> object with the new binning.</p>
<p>The default binning is sequential, with start, stop, and step values. Units for start and stop are MJD, so step is in days. The conventions for interpeting the three numbers (0,0,7), the default, is all weeks from the start of data taking. This is implemented by the function <a href="/wtlikecell_data.html#time_bin_edges"><code>time_bin_edges</code></a>.</p>
<p>The function <a href="/wtlikecell_data.html#partition_cells"><code>partition_cells</code></a> is used to create a set of unequal-sized cells from a BB partition.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Special-phased-bins">Special phased bins<a class="anchor-link" href="#Special-phased-bins"> </a></h4><p>To study long-term, many days, variations in the flux, perhaps due to systematics in the exposure, we implement a folded binning version, specified by start, period, and number of cells.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="time_bin_edges" class="doc_header"><code>time_bin_edges</code><a href="https://github.com/tburnett/wtlike/tree/master/wtlike/cell_data.py#L15" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>time_bin_edges</code>(<strong><code>config</code></strong>, <strong><code>exposure</code></strong>, <strong><code>tbin</code></strong>=<em><code>None</code></em>)</p>
</blockquote>
<p>Return an interleaved array of start/stop values</p>
<p>tbin: an array (a,b,d), default config.time_bins</p>
<p>interpretation of a, b:</p>
<p>a:  if &gt; 50000, interpret as MJD for start
    if &lt; 0, back from stop
    otherwise, offset from start</p>
<p>b:  if &gt; 50000, interpret MJD value for stop
    if &gt; 0, increment from start
    otherwise, offset from stop</p>
<p>d : if positive, the day bin size
    if 0; return contiguous bins</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="contiguous_bins" class="doc_header"><code>contiguous_bins</code><a href="https://github.com/tburnett/wtlike/tree/master/wtlike/cell_data.py#L65" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>contiguous_bins</code>(<strong><code>exposure</code></strong>, <strong><code>min_gap</code></strong>=<em><code>20</code></em>, <strong><code>min_duration</code></strong>=<em><code>600</code></em>)</p>
</blockquote>
<p>return a start/stop interleaved array for contiguous intervals</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="CellData" class="doc_header"><code>class</code> <code>CellData</code><a href="https://github.com/tburnett/wtlike/tree/master/wtlike/cell_data.py#L97" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>CellData</code>(<strong>*<code>pars</code></strong>, <strong>**<code>kwargs</code></strong>) :: <a href="/wtlikesource_data.html#SourceData"><code>SourceData</code></a></p>
</blockquote>
<p>Manage a set of cells generated from a data set</p>
<p>Invoke superclass to load photon data and exposure for the source.</p>
<ul>
<li>time_bins, default config.time_bins</li>
</ul>
<p>The <code>e</code> cell entry is the weighted exposure for the cell in units $cm^2\ Ms$.</p>

</div>

</div>

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="CellData.view" class="doc_header"><code>CellData.view</code><a href="https://github.com/tburnett/wtlike/tree/master/wtlike/cell_data.py#L188" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>CellData.view</code>(<strong>*<code>pars</code></strong>, <strong><code>exp_min</code></strong>=<em><code>None</code></em>)</p>
</blockquote>
<p>Return a "view", a copy of this instance with a perhaps a different set of cells</p>
<ul>
<li><p>pars -- start, stop, step  to define new binning. Or start, step, or just step
 start and stop are either MJD values, or offsets from the start or stop.
 step -- the cell size in days, or if zero, orbit-based binning</p>
</li>
<li><p>exp_min [None] -- If specified, a different minimum exposure, in cm^2 Ms units to use for fitting
  from.</p>
</li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="concatenate_cells" class="doc_header"><code>concatenate_cells</code><a href="https://github.com/tburnett/wtlike/tree/master/wtlike/cell_data.py#L267" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>concatenate_cells</code>(<strong><code>cells</code></strong>)</p>
</blockquote>
<p>Combine a group of cells to one</p>
<ul>
<li>cells: dataframe with cells containing  n, w, S, B<br>
<pre><code>  Optionally, if $t$ is present, generate t and tw
</code></pre>
Return a dict with summed n, S, B, and concatenated w</li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="partition_cells" class="doc_header"><code>partition_cells</code><a href="https://github.com/tburnett/wtlike/tree/master/wtlike/cell_data.py#L285" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>partition_cells</code>(<strong><code>config</code></strong>, <strong><code>cells</code></strong>, <strong><code>edges</code></strong>)</p>
</blockquote>
<p>Partition a set of cells</p>
<ul>
<li>cells -- A DataFrame of cells</li>
<li>edges  -- a list of edge times delimiting boundaries between cells</li>
</ul>
<p>Returns a DataFrame of combined cells, with times and widths adjusted to account for missing cells</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Study-cell-formation-with-Geminga">Study cell formation with Geminga<a class="anchor-link" href="#Study-cell-formation-with-Geminga"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="phase_cells" class="doc_header"><code>phase_cells</code><a href="https://github.com/tburnett/wtlike/tree/master/wtlike/cell_data.py#L327" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>phase_cells</code>(<strong><code>period</code></strong>, <strong><code>nbins</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

</div>
 

