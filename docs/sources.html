---

title: Sources and weights


keywords: fastai
sidebar: home_sidebar

summary: "Define the PointSource class, code to load weight tables to combine with photon data"
description: "Define the PointSource class, code to load weight tables to combine with photon data"
nb_path: "nbs/03_sources.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/03_sources.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Weight-tables">Weight tables<a class="anchor-link" href="#Weight-tables"> </a></h3><p>We use a full-sky catalog analysis model, currently pointlike, see <a href="https://github.com/tburnett/pointlike/blob/master/python/uw/like2/.py">source_weights</a>, to evaluate the predicted flux from a source of interest with respect to the
background, the combined fluxes from all other sources.</p>
<p>We choose the following binning:</p>
<ul>
<li>energy:  4/decade from 100 MeV to 1 TeV (but only upto 10 GeV really used)</li>
<li>event types: Front/Back  </li>
<li>Angular position: HEALPix, nside from 64 to 512 depending on the PSF </li>
</ul>
<p>In the tables, the energy index and event type are packed into a 1-byte band index, and the HEALPix index 
is in NEST order.</p>
<p>The table output also includes the predicted flux for each band, and the spectral model used.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary data-open="Hide Code" data-close="Show Code"></summary>
        <summary></summary>
        <div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nd">@ipynb_doc</span>
<span class="k">def</span> <span class="nf">weight_table_plots</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ### Plots of weight vs. radius</span>
<span class="sd">    </span>
<span class="sd">    These plots, of a strong source with little background, and a weak one, show the</span>
<span class="sd">    value of the weight vs. the radius of the pixels in the table. These is a </span>
<span class="sd">    plot for each energy/event type band. The top row has energies 100 MeV to 1 GeV,</span>
<span class="sd">    the bottom row 1 GeV to 10 GeV, Front, in green, and Back in orange.</span>
<span class="sd">    {img}</span>
<span class="sd">    Note the absense of Back for energies below {Emid} MeV. The pointlike model does not</span>
<span class="sd">    compute these to avoid the larger PSF and Earth limb background. The maximum radius</span>
<span class="sd">    per band is determined by the PSF. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">Emid</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="mf">2.5</span><span class="p">)</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">image</span><span class="p">(</span><span class="s1">&#39;weight_table_plots.png&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">caption</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">locals</span><span class="p">()</span>
<span class="n">weight_table_plots</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h3 id="Plots-of-weight-vs.-radius">Plots of weight vs. radius<a class="anchor-link" href="#Plots-of-weight-vs.-radius"> </a></h3><p>These plots, of a strong source with little background, and a weak one, show the
value of the weight vs. the radius of the pixels in the table. These is a 
plot for each energy/event type band. The top row has energies 100 MeV to 1 GeV,
the bottom row 1 GeV to 10 GeV, Front, in green, and Back in orange.</p>
<p><figure style="margin-left: 5%" title="Figure 1">  <a href="images/weight_table_plots_fig_01.png" title="images/weight_table_plots_fig_01.png">    <img src="images/weight_table_plots_fig_01.png" alt="Figure 1 at images/weight_table_plots_fig_01.png" width=500>   </a> </figure>
Note the absense of Back for energies below 316 MeV. The pointlike model does not
compute these to avoid the larger PSF and Earth limb background. The maximum radius
per band is determined by the PSF.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The local code used to do the unpacking is in the class <a href="/wtlikesources.html#WeightMan"><code>WeightMan</code></a></p>
<p>This table is used with the data, as a simple lookup: A weight is assigned to each photon according to which energy, event type or HEALPix pixel it lands in.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Accounting-for-variations-from-neighboring-sources">Accounting for variations from neighboring sources<a class="anchor-link" href="#Accounting-for-variations-from-neighboring-sources"> </a></h3><p>Consider the case where sources $S_1$ and $S_2$ have overlapping pixels. For a given pixel the corresponding weights are
$w_1$ and $w_2$, and we investigate the effect on $S_1$ from a fractional variation $\alpha_2 \ne 0$ of $S_2$, such that
its flux for that pixel, $s_2$, becomes $(1+\alpha )\ s_2$. With the background $b$, the flux of all
sources besides $S_1$ and $S_2$, we have for the $S_1$ weight,
$$ w_1 = \frac{s_1}{s_1+s_2+b}\ \ ,$$ and similarly for $S_2$.</p>
<p>Replacing $s_2$ with $(1+\alpha ) s_2$, we have for the modified weight $w_1'$ that we should use for  $S_1$,
{% raw %}
$$w'_1 = \frac{w_1}{1+\alpha_2\ w_2}\ \ .   $$
{% endraw %}</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_wtzip_index" class="doc_header"><code>get_wtzip_index</code><a href="https://github.com/tburnett/wtlike/tree/master/wtlike/sources.py#L17" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_wtzip_index</code>(<strong><code>config</code></strong>, <strong><code>update</code></strong>=<em><code>False</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">ls</span> <span class="o">-</span><span class="n">l</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">burnett</span><span class="o">/</span><span class="n">fermi</span><span class="o">/</span><span class="n">wtlike</span><span class="o">-</span><span class="n">data</span><span class="o">/</span><span class="n">weight_files</span><span class="o">.</span><span class="n">zip</span> 
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>-rwxrwxrwx 1 burnett burnett 383189527 May  1 06:26 <span class="ansi-red-fg ansi-underline">/home/burnett/fermi/wtlike-data/weight_files.zip</span>*
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">wtzip</span><span class="p">[</span><span class="s1">&#39;index.pil&#39;</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">TypeError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">/tmp/ipykernel_229/3900842101.py</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span>wtzip<span class="ansi-blue-fg">[</span><span class="ansi-blue-fg">&#39;index.pil&#39;</span><span class="ansi-blue-fg">]</span>

<span class="ansi-red-fg">TypeError</span>: &#39;ZipFile&#39; object is not subscriptable</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="WeightMan" class="doc_header"><code>class</code> <code>WeightMan</code><a href="https://github.com/tburnett/wtlike/tree/master/wtlike/sources.py#L62" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>WeightMan</code>(<strong><code>config</code></strong>, <strong><code>source</code></strong>) :: <code>dict</code></p>
</blockquote>
<p>Weight Management</p>
<ul>
<li>Load weight tables</li>
<li>Assign weights to photons</li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="weight_radius_plots" class="doc_header"><code>weight_radius_plots</code><a href="https://github.com/tburnett/wtlike/tree/master/wtlike/sources.py#L208" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>weight_radius_plots</code>(<strong><code>photons</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="findsource" class="doc_header"><code>findsource</code><a href="https://github.com/tburnett/wtlike/tree/master/wtlike/sources.py#L224" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>findsource</code>(<strong>*<code>pars</code></strong>, <strong><code>gal</code></strong>=<em><code>False</code></em>)</p>
</blockquote>
<p>Return a SkyCoord, looking up a name, or interpreting args</p>
<p>Optional inputs: len(pars) is 1 for a source name or Jxxx, or 2 for coordinate pair</p>
<ul>
<li>name -- look up the name, return None if not found</li>
<li>Jxxxx.x+yyyy -- intrepret  to get ra, dec, then convert</li>
<li>ra,dec -- assume frame=fk5</li>
<li>l,b, gal=True -- assume degrees, frame=galactic</li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="FermiCatalog" class="doc_header"><code>class</code> <code>FermiCatalog</code><a href="https://github.com/tburnett/wtlike/tree/master/wtlike/sources.py#L274" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>FermiCatalog</code>(<strong><code>config</code></strong>=<em><code>None</code></em>, <strong><code>max_sep</code></strong>=<em><code>0.1</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="SourceLookup" class="doc_header"><code>class</code> <code>SourceLookup</code><a href="https://github.com/tburnett/wtlike/tree/master/wtlike/sources.py#L335" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>SourceLookup</code>(<strong><code>config</code></strong>)</p>
</blockquote>
<p>Use lists of the pointlike and catalog sources to check for correspondence of a name or position</p>

</div>

</div>

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="SourceLookup.__call__" class="doc_header"><code>SourceLookup.__call__</code><a href="https://github.com/tburnett/wtlike/tree/master/wtlike/sources.py#L383" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>SourceLookup.__call__</code>(<strong>*<code>pars</code></strong>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>
<p>Search the catalog lists. Options are:</p>
<ul>
<li>name of a pointlike source</li>
<li>name of a source found by astropy, or a coordinate, which is close to a source in the pointlike list</li>
<li>a coordinate pair (ra,dec), or (l,b, gal=True)</li>
</ul>
<p>Returns the pointlike name.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="PointSource" class="doc_header"><code>class</code> <code>PointSource</code><a href="https://github.com/tburnett/wtlike/tree/master/wtlike/sources.py#L452" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>PointSource</code>(<strong>*<code>pars</code></strong>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>
<p>Manage the position and name of a point source</p>

</div>

</div>

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="PointSource.fk5" class="doc_header"><code>PointSource.fk5</code><a href="https://github.com/tburnett/wtlike/tree/master/wtlike/sources.py#L512" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>PointSource.fk5</code>(<strong><code>name</code></strong>, <strong><code>position</code></strong>)</p>
</blockquote>
<p>position: (ra,dec) tuple</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

