---

title: Source Data analysis

keywords: fastai
sidebar: home_sidebar

summary: "Load, for analysis, data associated with a source, or manage a simulation"
description: "Load, for analysis, data associated with a source, or manage a simulation"
nb_path: "nbs/05_source_data.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/05_source_data.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Overview">Overview<a class="anchor-link" href="#Overview"> </a></h3><p>For a point source, and data selection, the class <a href="/wtlikesource_data#SourceData"><code>SourceData</code></a> is the user interface to source-oriented data. It relies on the modules <code>laad_data</code> for actual data, or <a href="/wtlikesimulation"><code>simulation</code></a> for simulated data.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="SourceData" class="doc_header"><code>class</code> <code>SourceData</code><a href="https://github.com/tburnett/wtlike/tree/master/wtlike/source_data.py#L15" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>SourceData</code>(<strong><code>source</code></strong>, <strong><code>config</code></strong>=<em><code>None</code></em>, <strong><code>clear</code></strong>=<em><code>False</code></em>, <strong><code>week_range</code></strong>=<em><code>None</code></em>, <strong><code>key</code></strong>=<em><code>''</code></em>)</p>
</blockquote>
<p>Load the photon data near the source and associated exposure.
--or--
Use a Simulation object to generate data</p>
<p>Either from:</p>
<ol>
<li><code>config.wtlike_data/'data_files'</code>, the Path to folder with list of pickle files</li>
<li>the cache, with key <code>{source.name}_data</code></li>
</ol>
<ul>
<li>source : name, PointSource, or Simulation</li>
<li><a href="/wtlikeconfig"><code>config</code></a> : basic configuration</li>
<li><code>source</code> : PointSource object if specified</li>
<li><code>clear</code> : if set, overwrite the cached results</li>
</ul>
<p>Calculate the values for</p>
<ul>
<li>S, B : sums of w and 1-w</li>
<li>exptot : total associated exposure</li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">debug</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>&gt; <span class="ansi-green-fg">/mnt/c/users/thbur/OneDrive/work/wtlike/wtlike/sources.py</span>(371)<span class="ansi-cyan-fg">__init__</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-fg">    369 </span><span class="ansi-red-fg">        </span><span class="ansi-green-fg">if</span> pt_name <span class="ansi-green-fg">is</span> <span class="ansi-green-fg">None</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">    370 </span><span class="ansi-red-fg">            </span><span class="ansi-green-fg">raise</span> Exception<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">&#39;Source not found&#39;</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">--&gt; 371 </span><span class="ansi-red-fg">        </span>self<span class="ansi-blue-fg">.</span>skycoord <span class="ansi-blue-fg">=</span> lookup<span class="ansi-blue-fg">.</span>skycoord
<span class="ansi-green-fg">    372 </span><span class="ansi-red-fg">        </span><span class="ansi-red-fg">#print(pars)</span>
<span class="ansi-green-fg">    373 </span><span class="ansi-red-fg">        </span><span class="ansi-green-fg">if</span> len<span class="ansi-blue-fg">(</span>pars<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">==</span><span class="ansi-cyan-fg">1</span><span class="ansi-blue-fg">:</span>

</pre>
</div>
</div>

<div class="output_area">


</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre><span class="ansi-green-intense-fg ansi-bold">    361 </span>    <span class="ansi-green-fg">def</span> __init__<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">*</span>pars<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span> <span class="ansi-red-fg"># name,  position=None, nickname=None, config=None,):</span>
<span class="ansi-green-intense-fg ansi-bold">    362 </span>        &#34;&#34;&#34;
<span class="ansi-green-intense-fg ansi-bold">    363 </span>
<span class="ansi-green-intense-fg ansi-bold">    364 </span>        &#34;&#34;&#34;
<span class="ansi-green-intense-fg ansi-bold">    365 </span>        config <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>config <span class="ansi-blue-fg">=</span> kwargs<span class="ansi-blue-fg">.</span>pop<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">&#39;config&#39;</span><span class="ansi-blue-fg">,</span> Config<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    366 </span>        lookup <span class="ansi-blue-fg">=</span> SourceLookup<span class="ansi-blue-fg">(</span>config<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    367 </span>        gal <span class="ansi-blue-fg">=</span> kwargs<span class="ansi-blue-fg">.</span>get<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">&#39;gal&#39;</span><span class="ansi-blue-fg">,</span> <span class="ansi-green-fg">False</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    368 </span>        self<span class="ansi-blue-fg">.</span>nickname <span class="ansi-blue-fg">=</span> pt_name <span class="ansi-blue-fg">=</span> lookup<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">*</span>pars<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span> kwargs <span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    369 </span>        <span class="ansi-green-fg">if</span> pt_name <span class="ansi-green-fg">is</span> <span class="ansi-green-fg">None</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    370 </span>            <span class="ansi-green-fg">raise</span> Exception<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">&#39;Source not found&#39;</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">--&gt; 371 </span><span class="ansi-red-fg">        </span>self<span class="ansi-blue-fg">.</span>skycoord <span class="ansi-blue-fg">=</span> lookup<span class="ansi-blue-fg">.</span>skycoord
<span class="ansi-green-intense-fg ansi-bold">    372 </span>        <span class="ansi-red-fg">#print(pars)</span>
<span class="ansi-green-intense-fg ansi-bold">    373 </span>        <span class="ansi-green-fg">if</span> len<span class="ansi-blue-fg">(</span>pars<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">==</span><span class="ansi-cyan-fg">1</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    374 </span>            name <span class="ansi-blue-fg">=</span> pars<span class="ansi-blue-fg">[</span><span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">]</span>
<span class="ansi-green-intense-fg ansi-bold">    375 </span>            <span class="ansi-green-fg">if</span> name<span class="ansi-blue-fg">==</span>pt_name <span class="ansi-green-fg">and</span> lookup<span class="ansi-blue-fg">.</span>cat_name <span class="ansi-green-fg">is</span> <span class="ansi-green-fg">not</span> <span class="ansi-green-fg">None</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    376 </span>                name <span class="ansi-blue-fg">=</span> lookup<span class="ansi-blue-fg">.</span>cat_name
<span class="ansi-green-intense-fg ansi-bold">    377 </span>        <span class="ansi-green-fg">else</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    378 </span>            gal <span class="ansi-blue-fg">=</span> kwargs<span class="ansi-blue-fg">.</span>get<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">&#39;gal&#39;</span><span class="ansi-blue-fg">,</span> <span class="ansi-green-fg">False</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    379 </span>            name<span class="ansi-blue-fg">=</span><span class="ansi-blue-fg">f&#39;{&#34;fk5&#34; if gal else &#34;gal&#34;} ({pars[0]},{pars[1]}) &#39;</span>
<span class="ansi-green-intense-fg ansi-bold">    380 </span>        self<span class="ansi-blue-fg">.</span>name <span class="ansi-blue-fg">=</span> name
<span class="ansi-green-intense-fg ansi-bold">    381 </span>        gal <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>skycoord<span class="ansi-blue-fg">.</span>galactic
<span class="ansi-green-intense-fg ansi-bold">    382 </span>        self<span class="ansi-blue-fg">.</span>l<span class="ansi-blue-fg">,</span> self<span class="ansi-blue-fg">.</span>b <span class="ansi-blue-fg">=</span> gal<span class="ansi-blue-fg">.</span>l<span class="ansi-blue-fg">.</span>deg<span class="ansi-blue-fg">,</span> gal<span class="ansi-blue-fg">.</span>b<span class="ansi-blue-fg">.</span>deg
<span class="ansi-green-intense-fg ansi-bold">    383 </span>        self<span class="ansi-blue-fg">.</span>cat_name <span class="ansi-blue-fg">=</span> lookup<span class="ansi-blue-fg">.</span>cat_name
<span class="ansi-green-intense-fg ansi-bold">    384 </span>
<span class="ansi-green-intense-fg ansi-bold">    385 </span>        <span class="ansi-green-fg">try</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    386 </span>            self<span class="ansi-blue-fg">.</span>wtman <span class="ansi-blue-fg">=</span> WeightMan<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>config<span class="ansi-blue-fg">,</span> self<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    387 </span>            <span class="ansi-red-fg"># add wtman attribute references</span>
<span class="ansi-green-intense-fg ansi-bold">    388 </span>            self<span class="ansi-blue-fg">.</span>__dict__<span class="ansi-blue-fg">.</span>update<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>wtman<span class="ansi-blue-fg">.</span>__dict__<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    389 </span>        <span class="ansi-green-fg">except</span> Exception <span class="ansi-green-fg">as</span> e<span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    390 </span>            print<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">f&#39;Unexpected Weigthman failure: {e}&#39;</span><span class="ansi-blue-fg">,</span> file<span class="ansi-blue-fg">=</span>sys<span class="ansi-blue-fg">.</span>stderr<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    391 </span>            <span class="ansi-green-fg">raise</span>
<span class="ansi-green-intense-fg ansi-bold">    392 </span>

</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

