---

title: Poisson-like likelihood function


keywords: fastai
sidebar: home_sidebar

summary: "Description of the class `Poisson`, and its helper `PoissonFitter`, which are used to parameterize log likelihood curves."
description: "Description of the class `Poisson`, and its helper `PoissonFitter`, which are used to parameterize log likelihood curves."
nb_path: "nbs/06_poisson.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/06_poisson.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Author(s): Eric Wallace, Matthew Kerr, Toby Burnett</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="Poisson" class="doc_header"><code>class</code> <code>Poisson</code><a href="" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>Poisson</code>(<strong><code>p</code></strong>:<code>array of parameters</code>)</p>
</blockquote>
<p>This is a functor class which returns the log of a three-parameter Poisson-like function used to represent
the flux likelihood. The parameters are, in order:</p>
<p>$s_p$ : flux at peak, the maximum likelihood, if positive; if negative, there is a limit</p>
<p>$e$ : normalization factor to convert flux to equivalent counts. must be &gt;0</p>
<p>$b$  : background flux: must be &gt;=0</p>
<p>This parameterization is equivalent to that described in William Tompkins' thesis
(arxiv: astro-ph/0202141) and Nolan, et al., 2003,  ApJ 597:615:627.
The functional form is that of a Poisson distribution.</p>
<p>The log likelihood expression is for flux $s&gt;=0$
   $$w(s | s_p,e,b) = e\ \big[\  (s_p+b) \ \log( s+b ) - s\ \big] + \mathrm{const}$$
the const is conventionally defined such that $w=0$ at the peak.</p>
<p>for s_p &gt;&gt; b, the solution can be expressed as</p>
$$ s = s_p \pm \sqrt{(s_p+b)/e}$$<p>A slightly more elegant expression, used in the cdf function, is to define
   $\beta = e b$,  $\mu = e s_p + \beta$, and  $x = e s$.</p>
<p>Then the log likelihood is</p>
<p>$$ f(x | \beta) =  \mu \ \log( x + \beta) - x + \mathrm{const}$$</p>
<p>where the peak is at $x=x_p=\max(0, \mu-\beta)$, and the constant is defined so that $f(x_p)=0$.</p>

</div>

</div>

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="Poisson.from_fit" class="doc_header"><code>Poisson.from_fit</code><a href="__main__.py#L177" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>Poisson.from_fit</code>(<strong><code>counts</code></strong>, <strong><code>flux</code></strong>, <strong><code>sig_flux</code></strong>, <strong><code>tol</code></strong>=<em><code>5</code></em>)</p>
</blockquote>
<p>Create a Poisson instance using the fit parameters from an analysis
of a likelihood function.</p>
<ul>
<li>counts -- number of weights</li>
<li>flux -- peak value, in flux units</li>
<li>sig_flux -- its standard deviation, square root of the variance</li>
</ul>
<p>This is relevant if the likelihood is not truncated by the Bayes requirement.</p>
<p>If $s$ and $v$ are the signal rate and its variance, determined by an optimization for $n$ measurements,
so $s$ is large compared with $\sqrt{v}$, then the poisson-like parameters can be determined as follows.</p>
<p>We use the properties of the Poisson distribution
$f(n;\lambda) = \exp(n \log\lambda - \lambda + \mathrm{const})$,
where the parameter $\lambda$ is equal to the expected value of number of occurrences $n$ and
to its variance, and that the function we want is shifted by the background $b$ and scaled by a factor
$k$ so we use $f(k(s-b)| \lambda)$. This implies that for the expected value of $s$, $\lambda = n$,
and $ k(s-b)= k^2 v = n$.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># simple test: for 10K counts the error is 1% if no background </span>
<span class="n">t</span> <span class="o">=</span> <span class="n">Poisson</span><span class="o">.</span><span class="n">from_fit</span><span class="p">(</span><span class="mi">10000</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">0.02</span> <span class="p">)</span>
<span class="k">assert</span> <span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;Poisson: mu,beta= 10000.0, 0.0&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Fail: got </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h3 id="Poisson.__call__" class="doc_header"><code>Poisson.__call__</code><a href="__main__.py#L45" class="source_link" style="float:right">[source]</a></h3><blockquote><p><code>Poisson.__call__</code>(<strong><code>dom</code></strong>)</p>
</blockquote>
<p>Return the value(s) of the fit function for the given domain.</p>

</div>

</div>

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h3 id="Examples">Examples<a class="anchor-link" href="#Examples"> </a></h3><p>Here we generate and plot several instances, all with the $e$ parameter set to one, so the flux is in counts.</p>
<p>The peak ($s_p$) and  background ($b$) parameters are chosen from the following list:</p>
<p style="margin-left: 5%"><samp>[(10, 5), (10, 0), (-5, 5), (-5, 1), (0, 5)]</samp></p><p>The first two, with the peak at 10, show the effect of background. The last two show an example with a
peak less than zero, so that the Bayesian likelihood peaks at zero, and the effect of background on it.</p>
<figure style="margin-left: 5%" title="Figure 1">  <a href="images/poisson_doc_fig_01.png" title="images/poisson_doc_fig_01.png">    <img src="images/poisson_doc_fig_01.png" alt="Figure 1 at images/poisson_doc_fig_01.png" >   </a>  <figcaption><b>Figure 1</b>. Poisson-like plots</figcaption></figure><hr>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="PoissonFitter" class="doc_header"><code>class</code> <code>PoissonFitter</code><a href="https://github.com/tburnett/wtlike/tree/master/wtlike/poisson.py#L219" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>PoissonFitter</code>(<strong><code>func</code></strong>, <strong><code>fmax</code></strong>=<em><code>None</code></em>, <strong><code>scale</code></strong>=<em><code>None</code></em>, <strong><code>tol</code></strong>=<em><code>0.2</code></em>, <strong><code>delta</code></strong>=<em><code>0.0001</code></em>, <strong><code>dd</code></strong>=<em><code>-0.1</code></em>, <strong><code>test_mode</code></strong>=<em><code>False</code></em>)</p>
</blockquote>
<p>Helper class to fit a log likelihood function to the Poisson</p>
<h2 id="parameters">parameters<a class="anchor-link" href="#parameters"> </a></h2><ul>
<li>func : function of one parameter</li>
<li>fmax : position of maximum value, or None
<pre><code> if None, estimate using fmin</code></pre>
</li>
<li>scale: float | None
  estimate for scale to use; if None, estimate from derivatime</li>
<li>tol : float
  absolute tolerance in probability amplitude for fit, within default domain out to delta L of 4</li>
<li>delta : float
  value to calculate numerical derivative at zero flux</li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Tests">Tests<a class="anchor-link" href="#Tests"> </a></h2><h3 id="Study-tail-when-a-limit">Study tail when a limit<a class="anchor-link" href="#Study-tail-when-a-limit"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Check-high-statistics,-no-background">Check high statistics, no background<a class="anchor-link" href="#Check-high-statistics,-no-background"> </a></h3>
</div>
</div>
</div>
</div>
 

