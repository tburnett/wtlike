---

title: Simulation

keywords: fastai
sidebar: home_sidebar

summary: "Generate simulated cells using the weighted likelihood"
description: "Generate simulated cells using the weighted likelihood"
nb_path: "nbs/10_simulation.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/10_simulation.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>For simulation the distribution of weights is required. That can be a histogram or a function, an input to the <code>_WeightGenerator</code> class. The class is a functor, with the argument a number on the range (0,1).  Passing an array of uniform random numbers then creates set of weights distributed according to the model represented by the input weight distribution.</p>
<p>To account for different levels of signal or background than that represented by the full dataset, the <code>_WeightGenerator</code> class accepts <code>alpha</code>($\alpha$) and <code>beta</code> ($\beta$) parameters, which will be used to weight the weight distribution  by a factor</p>
$$ \big(1 + \alpha\ w + \beta \ (1-w)\ \big), $$<p>where $w$ represents an array of weight values.</p>
<p>Generating a cell requires also the expected number of photons. If the average flux and exposure predict a number of events $\mu$, we select the actual number from the Poisson distribution.</p>
<p>This is done by <a href="wtlike/simulation#generate_cell"><code>generate_cell</code></a>, which creates a list of weights depending on $\alpha$, $\beta$, and $\mu$.</p>
<p>Finally, <a href="wtlike/simulation#simulate_cells"><code>simulate_cells</code></a> makes a list of cells, based on the actual exposure of a source.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="_Sampler" class="doc_header"><code>class</code> <code>_Sampler</code><a href="https://github.com/tburnett/wtlike/tree/master/wtlike/simulation.py#L21" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>_Sampler</code>(<strong><code>func</code></strong>, <strong><code>limits</code></strong>=<em><code>(0, 1)</code></em>, <strong><code>n</code></strong>=<em><code>100</code></em>)</p>
</blockquote>
<p>Sample an arbitrary function or histogram</p>
<ul>
<li>func -- a function, a histogram, or a fixed value<br>
  If a function, must be positive definite.<br>
  Assume histogram bins are 0 to 1.</li>
<li>a,b  -- limits (default 0,1)</li>
<li>n    -- table size (ignored if a histogram or value)</li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Gaussian-and-quadratic-example-functions">Gaussian and quadratic example functions<a class="anchor-link" href="#Gaussian-and-quadratic-example-functions"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary data-open="Hide Code" data-close="Show Code"></summary>
        <summary></summary>
        <div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">n</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">sf</span> <span class="o">=</span> <span class="n">_Sampler</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="n">limits</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="p">)</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">sf</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>
<span class="n">tests</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">mean</span><span class="p">()),</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">])</span>
<span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">tests</span><span class="o">&lt;</span><span class="mf">5e-2</span> <span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;Failed Tests: mean </span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">}</span><span class="s1">, std </span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span>

<span class="n">func</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span>
<span class="n">wfun</span> <span class="o">=</span> <span class="n">_Sampler</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>

<span class="n">test2</span> <span class="o">=</span> <span class="n">wfun</span><span class="o">.</span><span class="n">mean</span><span class="p">,</span>  <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">wfun</span><span class="p">(</span><span class="mi">1000</span><span class="p">))</span>
<span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span> <span class="n">test2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">test2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1e-1</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Not almost equal: </span><span class="si">{</span><span class="n">test2</span><span class="si">}</span><span class="s1">&#39;</span>
</pre></div>

    </div>
</div>
</div>

    </details>
</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Use-a--histogram">Use a  histogram<a class="anchor-link" href="#Use-a--histogram"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">wtlike.source_data</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">data_folder</span><span class="o">=</span><span class="s1">&#39;/home/burnett/weekly&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">source</span> <span class="o">=</span> <span class="n">PointSource</span><span class="p">(</span><span class="s1">&#39;Geminga&#39;</span><span class="p">)</span>
<span class="n">sd</span> <span class="o">=</span> <span class="n">SourceData</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">source</span><span class="p">);</span> <span class="n">sd</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>photons and exposure for Geminga: Restoring from cache with key &#34;Geminga_weekly_data&#34;
</pre>
</div>
</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>SourceData: Source Geminga with:
	 data:     2,381,241 photons from   2008-08-04 to 2021-04-22
	 exposure: 3,106,496 intervals from 2008-08-04 to 2021-04-22</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="bp">self</span><span class="o">=</span><span class="n">sd</span>
<span class="n">nbins</span><span class="o">=</span><span class="mi">50</span>
<span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p_df</span><span class="o">.</span><span class="n">weight</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">nbins</span><span class="o">+</span><span class="mi">1</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>array([ 76196,  49374,  36838,  35817,  29239,  27614,  27018,  23363,
        16153,  21891,  20818,  14583,  21031,  12904,  11575,  13903,
        15386,  13518,  13428,  12146,  16433,  11605,  14782,  10378,
        16876,  10088,  10985,   8734,  20185,  20890,  12759,  26453,
        16459,  36519,   9818,  15488,  41751,  12771,  26995,  58443,
        25703,  72872,  66044,  57439,  14731,  69507, 126686,  76965,
       128716,      0])</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">wtlike.weights</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">data_folder</span><span class="o">=</span><span class="s1">&#39;/home/burnett/weekly&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">valid</span><span class="p">:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;font&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">source</span> <span class="o">=</span> <span class="n">PointSource</span><span class="p">(</span><span class="s1">&#39;Geminga&#39;</span><span class="p">)</span>
    <span class="n">photon_data</span> <span class="o">=</span> <span class="n">SourceData</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>
    <span class="n">h</span> <span class="o">=</span> <span class="n">photon_data</span><span class="o">.</span><span class="n">weight_histogram</span><span class="p">()</span>
    <span class="n">sf</span> <span class="o">=</span> <span class="n">_Sampler</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">sf</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>
    <span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">h</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
            <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;simulation with </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="si">}</span><span class="s1"> samples&#39;</span><span class="p">);</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">step</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">h</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([[</span><span class="n">h</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">h</span><span class="p">])</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">h</span><span class="p">)</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">h</span><span class="p">),</span>
           <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;data, source </span><span class="si">{</span><span class="n">source</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">);</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">prop</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">));</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>photons and exposure for Geminga: Restoring from cache with key &#34;Geminga_weekly_data&#34;
</pre>
</div>
</div>

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAd0AAAD9CAYAAAD55q3sAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAALEgAACxIB0t1+/AAAADh0RVh0U29mdHdhcmUAbWF0cGxvdGxpYiB2ZXJzaW9uMy4xLjMsIGh0dHA6Ly9tYXRwbG90bGliLm9yZy+AADFEAAAgAElEQVR4nO3deXxU9b3/8dc3gZBIAgmEgElIwiII3IgXo2WxRa24QJWqIEtBRbButKD0J1EsIrKqqPVSrRYvWDdEXHDhll6hyFJBUEFABAQTMClCgBCWJCw5vz8mzM0yG8zMmcnk/Xw85pFwtvmcL5n5nO/3fM/3ayzLQkRERIIvKtQBiIiI1BdKuiIiIjZR0hUREbGJkq6IiIhNlHRFRERs0iDYb5CcnGxlZWUF+21ERETCxpdffllkWVaLmsuDnnSzsrJYv359sN9GREQkbBhj8l0tV/OyiIiITZR0RUREbKKkKyIiYhMlXREREZsEvSOVJyUlJezbt4+TJ0+GMgwRqaJx48akp6cTFaVrcpFAC1nSLSkp4aeffiItLY24uDiMMaEKRUQqVVRUUFBQQFFRESkpKaEORyTihOxSdt++faSlpXHeeecp4YqEiaioKFq2bMnhw4dDHYpIRApZ0j158iRxcXGhensRcaNhw4acOnUq1GGIRKSQ3rRRDVck/OhzKRI8Ie1IJSIi0mvGMgqKS92uT0uMY3XuVTZGFDxKuj664447SE9PZ8qUKaEORWqYNm0au3btYs6cOaEORUTOQUFxKXkz+rldn5X7iY3RBJeSbhBcccUVDBs2jFGjRoU6lJCZP38+zz77LJs3b6Zx48a0adOG22+/nXvvvTfgzZePPPJIQI8nInVLXaopK+kKAKdPnyY6Ojogx5o1axZPPvkkf/7zn7n22muJj49nw4YNPP3004wcOZJGjRoF5H1ERKBu1ZT19LsbX3/9Nd26dSMhIYFBgwZRVlbmXHfo0CF+9atf0aJFC5KSkvjVr37Fjz/+CMCECRNYuXIlo0ePJj4+ntGjRwMwZswYWrduTZMmTbjkkktYuXKlz7HMnDmTtLQ0EhIS6NixI0uXLgWgvLycsWPHkpqaSmpqKmPHjqW8vByAefPmcfnll1c7jjGG77//HnA0l99777307duXxo0b889//pPS0lLGjRtHZmYmTZs25fLLL6e01HH1uGbNGnr27EliYiJdu3Zl+fLlLmM9fPgwEydO5IUXXmDAgAEkJCRgjOE///M/eeONN5wJt7y8nD/84Q9kZGTQsmVL7rnnHud7LV++nPT0dJ588klSUlI4//zz+eCDD1i8eDEdOnSgWbNmTJs2zfmekyZNYtiwYQDk5eVhjOHVV18lIyOD5ORkpk6d6ty2tLSU22+/naSkJDp16sSTTz5Jenq6c/2MGTNo164dCQkJdO7cmffff9/n/ycREW/Cp6b7P7mwd1Nw36NVNlw/w+tmJ06c4Ne//jVjx45l9OjRLFq0iCFDhjB+/HjAMYDAiBEjWLBgAadPn+bOO+9k9OjRfPDBB0ydOpXVq1fXal6+9NJLmThxIk2bNuVPf/oTAwcOJC8vj9jYWI+xbNu2jdmzZ7Nu3TpSU1PJy8vj9OnTAEydOpU1a9awYcMGjDH079+fKVOm8MQTT/hUHG+++SaLFy/m448/5sSJE4wbN44tW7bwr3/9i1atWrF27VqioqIoKCigX79+vPbaa1x33XUsXbqUW265he+++44WLapPF/n5559TXl5O//79Pb73+PHj2bVrFxs2bKBhw4YMHTqUyZMnM336dAD27t1LWVkZBQUFzJs3j7vuuos+ffrw5Zdfsnv3bi655BIGDx5M27ZtXR5/1apVbNu2je3bt3PZZZdx880306lTJx5//HHy8vLYtWsXx44do2/fvtX2a9euHStXrqRVq1a88847DBs2jO+//57zzz/fpzIVEfFENV0X1qxZw8mTJxk7diwNGzZkwIABXHrppc71zZs355ZbbuG8884jISGBCRMm8Nlnn3k85rBhw2jevDkNGjRg3LhxlJeXs23bNq+xREdHU15ezrfffsvJkyfJysqiXbt2ALzxxhtMnDiRlJQUWrRowWOPPcZrr73m83n279+fXr16ERUVRUxMDP/93//Nn/70J9LS0oiOjqZnz540atSI119/nb59+9K3b1+ioqLo06cPOTk5LF68uNYxi4qKSE5OpkGD/7ueO1NDjouLY8WKFViWxV//+leeffZZmjVrRkJCAo888gjz58937tOwYUMmTJhAw4YNGTx4MEVFRYwZM4aEhAS6dOlCly5d+Oabb9ye22OPPUZcXBxdu3ala9eubNy4EYAFCxbwyCOPkJSURHp6Or///e+r7Tdw4EBS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
"
>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="_WeightGenerator" class="doc_header"><code>class</code> <code>_WeightGenerator</code><a href="https://github.com/tburnett/wtlike/tree/master/wtlike/simulation.py#L74" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>_WeightGenerator</code>(<strong><code>func</code></strong>, <strong><code>alpha</code></strong>=<em><code>0</code></em>, <strong><code>beta</code></strong>=<em><code>0</code></em>, <strong><code>n</code></strong>=<em><code>100</code></em>) :: <code>_Sampler</code></p>
</blockquote>
<p>Generate a set of weights</p>
<ul>
<li><code>func</code> -- nominal weight distribution function, evaluated on (0,1)</li>
<li><code>alpha, beta</code> -- (default 0,0). Values for $\alpha$, $\beta$.</li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Test">Test<a class="anchor-link" href="#Test"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">wg</span> <span class="o">=</span> <span class="n">_WeightGenerator</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
<span class="n">test2</span> <span class="o">=</span> <span class="n">wg</span><span class="o">.</span><span class="n">mean</span><span class="p">,</span>  <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">wg</span><span class="p">(</span><span class="mi">1000</span><span class="p">))</span>
<span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span> <span class="n">test2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">test2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1e-1</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Not almost equal: </span><span class="si">{</span><span class="n">test2</span><span class="si">}</span><span class="s1">&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="generate_cell" class="doc_header"><code>generate_cell</code><a href="https://github.com/tburnett/wtlike/tree/master/wtlike/simulation.py#L91" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>generate_cell</code>(<strong><code>wfun</code></strong>, <strong><code>mu</code></strong>, <strong><code>alpha</code></strong>=<em><code>0</code></em>, <strong><code>beta</code></strong>=<em><code>0</code></em>)</p>
</blockquote>
<p>Generate a cell</p>
<ul>
<li><code>wfun</code> -- weight function, or histogram.
  Defined on (0,1)</li>
<li><code>mu</code> -- number of expected weights, on average</li>
<li><code>alpha</code>, <code>beta</code>  -- default 0,0; values for $\alpha$ and  $\beta$ for this cell</li>
</ul>
<p>Returns a dict with:</p>
<ul>
<li><code>n</code> -- actual generated number of weights, from Poisson</li>
<li><code>w</code> -- array of weights</li>
<li><code>S, B</code> -- expected values for $\sum w$ and $\sum(1-w)$, calulated from wfun</li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Test with a function peaked at both ends, generate equal signal and background</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary data-open="Hide Code" data-close="Show Code"></summary>
        <summary></summary>
        <div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">test_gen</span><span class="p">(</span><span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="n">wfun</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="mf">0.5</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.precision&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">quiet</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Test with alpha=</span><span class="si">{</span><span class="n">alpha</span><span class="si">}</span><span class="s1">, beta=</span><span class="si">{</span><span class="n">beta</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">cell</span> <span class="o">=</span> <span class="n">generate_cell</span><span class="p">(</span> <span class="n">wfun</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span>  <span class="n">alpha</span><span class="p">,</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">beta</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">beta</span><span class="p">)</span>
    <span class="c1">#</span>
    <span class="n">ll</span> <span class="o">=</span> <span class="n">LogLike</span><span class="p">(</span><span class="n">cell</span><span class="p">);</span> 
    <span class="k">if</span> <span class="ow">not</span> <span class="n">quiet</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Generated cell info:</span><span class="se">\n</span><span class="si">{</span> <span class="n">ll</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="n">fit</span> <span class="o">=</span> <span class="n">ll</span><span class="o">.</span><span class="n">fit_info</span><span class="p">(</span><span class="n">beta</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">quiet</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="mi">2</span> <span class="k">if</span> <span class="n">beta</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">1</span><span class="si">}</span><span class="s1">-D fit info:</span><span class="se">\n</span><span class="si">{</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">fit</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">t</span><span class="p">,</span> <span class="n">sigt</span> <span class="o">=</span> <span class="n">fit</span><span class="p">[</span><span class="s1">&#39;flux&#39;</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">alpha</span><span class="p">),</span>  <span class="n">fit</span><span class="p">[</span><span class="s1">&#39;sig_flux&#39;</span><span class="p">]</span>
    <span class="n">check_alpha</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span> <span class="k">if</span>  <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">&lt;</span><span class="n">tol</span><span class="o">*</span><span class="n">sigt</span> <span class="k">else</span> <span class="sa">f</span><span class="s1">&#39;alpha: abs(</span><span class="si">{</span><span class="n">t</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">) &gt; </span><span class="si">{</span><span class="n">tol</span><span class="si">}</span><span class="s1"> * </span><span class="si">{</span><span class="n">sigt</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span>

    <span class="k">if</span> <span class="n">beta</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="nb">bool</span><span class="p">(</span><span class="n">check_alpha</span><span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;Failed: </span><span class="si">{</span><span class="n">check_alpha</span><span class="si">}</span><span class="s1"> &#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">t</span><span class="p">,</span> <span class="n">sigt</span> <span class="o">=</span> <span class="n">fit</span><span class="p">[</span><span class="s1">&#39;beta&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">beta</span><span class="p">,</span> <span class="n">fit</span><span class="p">[</span><span class="s1">&#39;sig_beta&#39;</span><span class="p">]</span>
        <span class="n">check_beta</span> <span class="o">=</span><span class="s1">&#39;&#39;</span> <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">&lt;</span><span class="n">tol</span><span class="o">*</span><span class="n">sigt</span> <span class="k">else</span> <span class="sa">f</span><span class="s1">&#39;beta: abs(</span><span class="si">{</span><span class="n">t</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">) &gt; </span><span class="si">{</span><span class="n">tol</span><span class="si">}</span><span class="s1"> * </span><span class="si">{</span><span class="n">sigt</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span>

        <span class="k">assert</span> <span class="ow">not</span> <span class="p">(</span> <span class="nb">bool</span><span class="p">(</span><span class="n">check_alpha</span><span class="p">)</span>  <span class="ow">or</span> <span class="nb">bool</span><span class="p">(</span><span class="n">check_beta</span><span class="p">)),</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">check_alpha</span><span class="si">}</span><span class="s1">  </span><span class="si">{</span><span class="n">check_beta</span><span class="si">}</span><span class="s1">&#39;</span>
<span class="n">test_gen</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
<span class="n">test_gen</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
<span class="c1">#test_gen(10, 0, tol=5, quiet=False)</span>
<span class="n">test_gen</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">test_gen</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Test with alpha=0.1, beta=None
Generated cell info:
wtlike.loglike.LogLike:  10402 weights, S 4998.5, B 5001.5
1-D fit info:
counts      10402.000
flux            1.092
sig_flux        0.016
dtype: float64
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sd</span> <span class="o">=</span> <span class="n">SourceData</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>photons and exposure for Geminga: Restoring from cache with key &#34;Geminga_weekly_data&#34;
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sd</span><span class="o">.</span><span class="n">binned_exposure</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Time bins: 4643 intervals of 1 days, from MJD 54683.0(2008-08-05) to 59326.0(2021-04-22))
Relative exposure per bin:
count    4643.000
mean        1.000
std         0.353
min         0.000
50%         0.993
max         3.664
dtype: float64
</pre>
</div>
</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(array([1.27925282, 1.23016514, 1.19682299, ..., 1.21707418, 1.1495392 ,
        1.18031339]),
 array([54683., 54684., 54685., ..., 59324., 59325., 59326.]))</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="simulate_cells" class="doc_header"><code>simulate_cells</code><a href="https://github.com/tburnett/wtlike/tree/master/wtlike/simulation.py#L128" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>simulate_cells</code>(<strong><code>source_data</code></strong>, <strong><code>wdist</code></strong>=<em><code>None</code></em>, <strong><code>source_flux</code></strong>=<em><code>'&lt;lambda&gt;'</code></em>)</p>
</blockquote>
<ul>
<li><a href="wtlike/source_data"><code>source_data</code></a> -- a SourceData object, use to get exposure at its position and weight distribution</li>
<li><code>wdist</code>   -- a weight function or histogram; if None, get the source distribution</li>
<li><code>source_flux</code> -- function of MJD time for the counts/day; default 100/day</li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary data-open="Hide Code" data-close="Show Code"></summary>
        <summary></summary>
        <div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">simcells</span> <span class="o">=</span> <span class="n">pfits</span> <span class="o">=</span> <span class="kc">None</span>
<span class="k">def</span> <span class="nf">simulation_test</span><span class="p">(</span><span class="n">N</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">funstr</span><span class="o">=</span><span class="s1">&#39;(x-0.5)**2&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ### Test the cell creation</span>
<span class="sd">    </span>
<span class="sd">    Generate {N:,} cells with mu={mu}, alpha={alpha} using the function {funstr}</span>

<span class="sd">    The deviations from the expected norm divided by each cell&#39;s average error:</span>
<span class="sd">    {fig1}</span>
<span class="sd">    Mean and STD of this distribution: {m:.3f}, {sig:.3f}: for a generated Gaussian distribution these wouild be 0 and 1. </span>
<span class="sd">    </span>
<span class="sd">    A validation of the shape is to evaluate the cumulative probability of the over-all mean</span>
<span class="sd">    for each likelihood function. This uses the `poisson.Poisson.cdf` function.</span>
<span class="sd">    {fig2}</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">simcells</span><span class="p">,</span> <span class="n">pfits</span>

    <span class="n">wfun</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;lambda x: </span><span class="si">{</span><span class="n">funstr</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">simcells</span><span class="p">,</span> <span class="n">pfits</span> <span class="o">=</span>  <span class="n">local_sim_cells</span><span class="p">(</span><span class="n">wfun</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
    <span class="n">flux</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">p</span><span class="o">.</span><span class="n">flux</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">pfits</span><span class="p">]);</span> 
    <span class="n">fmean</span> <span class="o">=</span> <span class="mi">1</span><span class="o">+</span><span class="n">alpha</span>
    <span class="k">def</span> <span class="nf">pull</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
        <span class="n">f</span><span class="p">,</span> <span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>  <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">flux</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">errors</span>
        <span class="n">s</span> <span class="o">=</span> <span class="p">(</span><span class="n">h</span><span class="o">-</span><span class="n">l</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">f</span><span class="o">-</span><span class="n">fmean</span><span class="p">)</span><span class="o">/</span><span class="n">s</span>
    <span class="n">pulls</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">pull</span><span class="p">,</span> <span class="n">pfits</span><span class="p">)))</span>
    
    <span class="n">m</span><span class="p">,</span> <span class="n">sig</span> <span class="o">=</span> <span class="n">pulls</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">pulls</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;font&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
    <span class="n">fig1</span><span class="p">,</span><span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="n">num</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">pulls</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">21</span><span class="p">),</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span><span class="kc">None</span><span class="p">),</span> <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;pull&#39;</span><span class="p">);</span> 
    <span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">fig1</span><span class="o">.</span><span class="n">width</span><span class="o">=</span><span class="mi">300</span>

    <span class="k">class</span> <span class="nc">CDF</span><span class="p">():</span>
        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alpha</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="mi">1</span><span class="o">+</span><span class="n">alpha</span>
        <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">p</span><span class="o">.</span><span class="n">poiss</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">cdf</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">fmean</span><span class="o">=</span><span class="mf">1.1</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">p</span><span class="o">.</span><span class="n">poiss</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">fmean</span><span class="p">)</span>

    <span class="c1">#</span>
    <span class="n">cd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">CDF</span><span class="p">(</span><span class="n">alpha</span><span class="p">),</span> <span class="n">pfits</span><span class="p">)))</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="n">num</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">cd</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">21</span><span class="p">),</span> <span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;probability&#39;</span><span class="p">)</span>
                            
    <span class="n">fig2</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">locals</span><span class="p">()</span>

<span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">valid</span><span class="p">:</span>
    <span class="n">nbdoc</span><span class="p">(</span><span class="n">simulation_test</span><span class="p">,</span><span class="n">mu</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h3 id="Test-the-cell-creation">Test the cell creation<a class="anchor-link" href="#Test-the-cell-creation"> </a></h3><p>Generate 10,000 cells with mu=50, alpha=0 using the function (x-0.5)**2</p>
<p>The deviations from the expected norm divided by each cell's average error:</p>
<div class="nbdoc_image">
<figure style="margin-left: 5%" title="Figure 1">  <a href="images/simulation_test_fig_01.png" title="images/simulation_test_fig_01.png">    <img src="images/simulation_test_fig_01.png" alt="Figure 1 at images/simulation_test_fig_01.png" width=300>   </a> </figure>
</div><p>Mean and STD of this distribution: -0.095, 1.038: for a generated Gaussian distribution these wouild be 0 and 1.</p>
<p>A validation of the shape is to evaluate the cumulative probability of the over-all mean
for each likelihood function. This uses the <code>poisson.Poisson.cdf</code> function.</p>
<div class="nbdoc_image">
<figure style="margin-left: 5%" title="Figure 3">  <a href="images/simulation_test_fig_03.png" title="images/simulation_test_fig_03.png">    <img src="images/simulation_test_fig_03.png" alt="Figure 3 at images/simulation_test_fig_03.png" width=300>   </a> </figure>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Follow-on:-combine-the-cells-and-fit-the-result">Follow-on: combine the cells and fit the result<a class="anchor-link" href="#Follow-on:-combine-the-cells-and-fit-the-result"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary data-open="Hide Code" data-close="Show Code"></summary>
        <summary></summary>
        <div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cells</span><span class="o">=</span><span class="p">[]</span>
<span class="k">def</span> <span class="nf">simulation_lightcurve_demo</span><span class="p">(</span><span class="n">source_data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ### Lightcurve generation test</span>
<span class="sd">    </span>
<span class="sd">    This uses the exposure measured for the source {source_name}, and</span>
<span class="sd">    the default time bins to create a light curve assuming a fixed flux</span>
<span class="sd">    and a histogram of weights from the data.</span>
<span class="sd">    {output}</span>
<span class="sd">    </span>
<span class="sd">    {fig}</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">cells</span>
    
    <span class="k">with</span> <span class="n">capture_print</span><span class="p">(</span><span class="s1">&#39;Print out&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">output</span><span class="p">:</span>
        <span class="n">cells</span> <span class="o">=</span>  <span class="n">simulate_cells</span><span class="p">(</span><span class="n">source_data</span><span class="p">,</span> <span class="n">source_flux</span><span class="o">=</span><span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="mi">100</span><span class="p">)</span>
        <span class="n">fits</span> <span class="o">=</span>  <span class="n">fit_cells</span><span class="p">(</span><span class="n">source_data</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="n">cells</span><span class="p">)</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">flux_plot</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">fits</span><span class="p">),</span> <span class="n">width</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="nb">locals</span><span class="p">()</span>

<span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">valid</span><span class="p">:</span>
    <span class="n">nbdoc</span><span class="p">(</span><span class="n">simulation_lightcurve_demo</span><span class="p">,</span> <span class="n">SourceData</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">PointSource</span><span class="p">(</span><span class="s1">&#39;Geminga&#39;</span><span class="p">)))</span>
</pre></div>

    </div>
</div>
</div>

    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>photons and exposure for Geminga: Restoring from cache with key &#34;Geminga_weekly_data&#34;
</pre>
</div>
</div>

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h3 id="Lightcurve-generation-test">Lightcurve generation test<a class="anchor-link" href="#Lightcurve-generation-test"> </a></h3><p>This uses the exposure measured for the source {source_name}, and
the default time bins to create a light curve assuming a fixed flux
and a histogram of weights from the data.</p>
<p><details  class="nbdoc-description" >  <summary> Print out </summary>  <div style="margin-left: 5%"><pre>Time bins: 4643 intervals of 1 days, from MJD 54683.0(2008-08-05) to 59326.0(2021-04-22))<br>Relative exposure per bin:<br>count    4643.000<br>mean        1.000<br>std         0.353<br>min         0.000<br>50%         0.993<br>max         3.664<br>dtype: float64<br>Loaded 4443 / 4643 cells with exposure &gt; 0.3 for fitting<br></pre></div> </details></p>
<div class="nbdoc_image">
<figure style="margin-left: 5%" title="Figure 1">  <a href="images/simulation_lightcurve_demo_fig_01.png" title="images/simulation_lightcurve_demo_fig_01.png">    <img src="images/simulation_lightcurve_demo_fig_01.png" alt="Figure 1 at images/simulation_lightcurve_demo_fig_01.png" width=500>   </a> </figure>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cd</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

</div>
 

