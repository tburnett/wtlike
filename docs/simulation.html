---

title: Simulation


keywords: fastai
sidebar: home_sidebar

summary: "Generate simulated cells using the weighted likelihood"
description: "Generate simulated cells using the weighted likelihood"
nb_path: "nbs/10_simulation.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/10_simulation.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>For simulation the distribution of weights is required. That can be a histogram or a function, an input to the <code>_WeightGenerator</code> class. The class is a functor, with the argument a number on the range (0,1).  Passing an array of uniform random numbers then creates set of weights distributed according to the model represented by the input weight distribution.</p>
<p>To account for different levels of signal or background than that represented by the full dataset, the <code>_WeightGenerator</code> class accepts <code>alpha</code>($\alpha$) and <code>beta</code> ($\beta$) parameters, which will be used to weight the weight distribution  by a factor
$$ 1 + \alpha\ w + \beta \ (1-w) $$ where $w$ represents the array of weight values.</p>
<p>Generating a cell requires also the expected number of photons. If the average flux and exposure predict a number of events $\mu$, we select the actual number from the Poisson distribution.</p>
<p>This is done by <a href="/wtlikesimulation.html#generate_cell"><code>generate_cell</code></a>, which creates a list of weights depending on $\alpha$, $\beta$, and $\mu$.</p>
<p>Finally, <code>simulate_cells</code> makes a list of cells, based on the actual exposure of a source.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="_Sampler" class="doc_header"><code>class</code> <code>_Sampler</code><a href="https://github.com/tburnett/wtlike/tree/master/wtlike/simulation.py#L20" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>_Sampler</code>(<strong><code>func</code></strong>, <strong><code>limits</code></strong>=<em><code>(0, 1)</code></em>, <strong><code>n</code></strong>=<em><code>100</code></em>)</p>
</blockquote>
<p>Sample an arbitrary function or histogram</p>
<ul>
<li>func -- a function, a histogram, or a fixed value<br>
  If a function, must be positive definite.<br>
  Assume histogram bins are 0 to 1.</li>
<li>a,b  -- limits (default 0,1)</li>
<li>n    -- table size (ignored if a histogram or value)</li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Gaussian-and-quadratic-example-functions">Gaussian and quadratic example functions<a class="anchor-link" href="#Gaussian-and-quadratic-example-functions"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">n</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">sf</span> <span class="o">=</span> <span class="n">_Sampler</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="n">limits</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="p">)</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">sf</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>
<span class="n">tests</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">mean</span><span class="p">()),</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">])</span>
<span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">tests</span><span class="o">&lt;</span><span class="mf">5e-2</span> <span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;Failed Tests: mean </span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">}</span><span class="s1">, std </span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span>

<span class="n">func</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span>
<span class="n">wfun</span> <span class="o">=</span> <span class="n">_Sampler</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>

<span class="n">test2</span> <span class="o">=</span> <span class="n">wfun</span><span class="o">.</span><span class="n">mean</span><span class="p">,</span>  <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">wfun</span><span class="p">(</span><span class="mi">1000</span><span class="p">))</span>
<span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span> <span class="n">test2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">test2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1e-1</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Not almost equal: </span><span class="si">{</span><span class="n">test2</span><span class="si">}</span><span class="s1">&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Test-generating-weights-from-a-source-weight-histogram">Test generating weights from a source weight histogram<a class="anchor-link" href="#Test-generating-weights-from-a-source-weight-histogram"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># if Config().valid:</span>
<span class="c1">#     plt.rc(&#39;font&#39;, size=16)</span>
<span class="c1">#     photon_data = SourceData(&#39;Geminga&#39;)</span>
<span class="c1">#     h = photon_data.weight_histogram()</span>
<span class="c1">#     sf = _Sampler(h)</span>
<span class="c1">#     data = sf(10000)</span>
<span class="c1">#     fig,ax = plt.subplots(figsize=(8,4))</span>
<span class="c1">#     ax.hist(data, np.linspace(0,1, len(h)+1), density=True, </span>
<span class="c1">#             label=f&#39;simulation with {len(data)} samples&#39;);</span>
<span class="c1">#     ax.step( np.linspace(0,1, len(h)+1) , np.concatenate([[h[0]], h])/np.sum(h)*len(h),</span>
<span class="c1">#            label=f&#39;data, source {photon_data.source.name}&#39;);</span>
<span class="c1">#     ax.legend(prop=dict(size=12));</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>SourceData: photons and exposure for Geminga: Saving to cache with key &#34;Geminga_data&#34;
	Assembling photon data and exposure for source Geminga from folder &#34;/home/burnett/wtlike_data/data_files&#34;,
	 with 665 files, last file:  week_674.pkl: loading all files
.........................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................
Load weights from file /mnt/d/wtlike/wtlike_data/weight_files/Geminga_weights.pkl
	Found: PSR J0633+1746 at (195.14, 4.27)
	Applyng weights: 0 / 1414896 photon pixels are outside weight region
	201055 weights set to NaN
SourceData: Source Geminga with:
	 data:     1,213,841 photons from   2008-08-04 to 2021-05-05
	 exposure: 3,117,669 intervals from 2008-08-04 to 2021-05-06
Weight histogram for Geminga: Saving to cache with key &#34;Geminga_weight_hist&#34;
</pre>
</div>
</div>

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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9tprC2zXvn17li1bRvPmzfn000/p168fv/76KyeffLJf51REpDQqQQdg1apVZGdnM2jQIGrVqkXfvn0577zzPMsbN27MzTffzEknnUS9evUYMWIE3377bYn77NevH40bN6ZmzZoMHjyYrKwstm7dWmosNWrUICsri59++ons7Gzatm1L+/btAZg2bRojR46kadOmxMbG8vTTT/PBBx/4/Tn79OnDRRddREREBLVr1+add97h1VdfJS4ujho1atCjRw/q1KnDhx9+yLXXXsu1115LREQEV1xxBd26deOLL74oss+UlBSaNGlCzZr514jukndUVBRLly7FWstbb73Fyy+/TKNGjahXrx7Dhw9n+vTpnm1q1arFiBEjqFWrFrfffjspKSkMHDiQevXq0blzZzp37symTZuK/WxPP/00UVFRdO3ala5du7Jx40YAZsyYwfDhw4mJiaFly5Y89ljBIc1vueUWWrRoQUREBLfddhunnnoqa9as8fucioiUpvKVoP0o2Z4oycnJxMXFFWgP2qZNG8/7o0eP8ve//50vv/ySgwed7sjT09PJzc2lRo0aPvc5YcIEpkyZQnJyMsYY0tLSSElJKTWWDh068MorrzBq1Cji4+O56qqreOmll2jRogXJyckF4mrTpg3Jycl+f85WrVp53qekpJCZmelJ/t527tzJp59+yrx58zzzsrOzufTSS4us27hxY1JSUsjJyfEk6e+++w6Ali1bkpeXx/79+zl69CjnnnuuZztrbYHn4I0bN/acS3eHNs2aNfMsj4qKIiOj+J5mmzdv7nl/0kknedZNTk4u8Lm93wO8//77vPTSSyQkJACQkZHh1+9JRMRfKkEH4OSTTyYpKalAjePExETP+wkTJrB161ZWr15NWloaS5cuBfCsX7ijh2XLljF+/HhmzJjBwYMHOXToEA0aNPC7RvOdd97J8uXL2blzJ8YYz632Fi1asHPnzgIxtmjRAnAGPDh69Khn2Z49e4rs1zvOJk2aEBkZyfbt24us16pVK/r378+hQ4c8ryNHjjB06NAi63bv3p06deowZ86cYj9PkyZNiIqKIj4+3rO/w4cPl5hwg+Xkk0/21BcA2LUrv7+dnTt38uCDDzJx4kQOHDjAoUOH+L//+78KqXkuItWXEnQAunfvTs2aNXnttdfIyclh9uzZBW5zpqenExUVRcOGDUlNTeWZZ54psH2zZs3YsWNHgfVr1qxJbGwsOTk5jB49mrS0/B5ylixZUmzvTVu3buWbb74hKyuLyMhIoqKiPCXLO+64g+eee479+/eTkpLC6NGjPZWlunbtSnx8PBs2bCAzM5NRo0aV+JkjIiK47777ePzxx0lOTiY3N9fzPLlfv37MmzePBQsWkJubS2ZmJkuWLCmQ6NwaNmzI008/zSOPPMLMmTPJyMggLy+PDRs2cOTIEc+xHnzwQf7+97+zb98+AJKSkliwYEGJMQbDrbfeyrhx4zh48CBJSUlMnDjRs+zIkSMYYzzP1d999102b95c4TGJSPWiBB2A2rVrM3v2bKZOnUpMTAyffPIJN910k2f5oEGDOHbsGE2aNOHCCy/k6quvLrD9wIEDmTlzJjExMTz22GNcddVVXHPNNXTs2JE2bdoQGRlZ4Nbqrl276N69u89YsrKyGDp0KE2aNKF58+bs27fPU4P5qaeeolu3bpx55pl06dKFc845x9OZSseOHRk5ciSXX345p556apEa3b68+OKLdOnShfPOO49GjRoxZMgQ8vLyaNWqFXPmzGHs2LHExsbSqlUr/vWvf5GXl+dzP08++SQvvfSSpxZ2s2bNeOihhxg/fjw9evQAnJrpHTp04MILL6R+/fpcfvnlfj2TD9TIkSNp2bIl7dq14/LLL6dv376emuWdOnVi8ODBdO/enWbNmvHjjz9y0UUXVXhMIlK9mHC5LdetWze7bt26IvO3bNnCGWecEYKIws8DDzzALbfcwlVXXRXqUKqdN954g+nTp5daya+60f+nhNSoBs500I/QsHVoYyknY8x6a203X8tUgq5EpkyZouR8gvz++++sWLGCvLw8tm7dyoQJE7jxxhtDHZaIlFVmGmyeVSkH1FCCFvHh+PHjPPTQQ9SrV4/LLruMPn368Mgjj4Q6LBEpq/VTYeZ9zrSSqXzNrEROgDZt2qjil0hVcPxIwWklohK0iIhIGFKCFhERCUNK0CIiImFICVpERCQMKUGLiEi10Hbof0MdQpkoQVeQsWPHFhhGMpguueQSpkyZUq5tExMTiY6OLjDgxInkz/G9x6OW4HGPny0ilUOlbGZV0VdBCc9fF/A+hg8fHoRIAte2bVumTJnC5ZdfDkDr1q1PyGATxSl8/EsuuaTImNhlsXnzZgYPHsz69es5cOBAkQErUlNTuf/++/nqq69o0qQJ48aN48477/QsX7RoEX/7299ITEzkggsuYOrUqZ6Rv6y1DB061HMxdP/99zN+/HhPf+gJCQnce++9rF69mtatWzNx4kTPeRaRMJOWxNCa8ZDaCRq1C3U0flEJWiq1WrVqceutt/L222/7XP63v/2N2rVrs3fvXqZNm8Zf//pX4uPjAWfozJtuuolnn32W1NRUunXrxm233ebZdvLkyXz++eds3LiRTZs2MX/+fP7zn/94lt9xxx2cffbZHDhwgDFjxtC3b1/2799fsR9YRMpny1werjkP1r8b6kj8pgQdoPHjxxMXF0e9evU47bTTWLRoEQCjRo3yjBiVkJCAMYZ3332XVq1aERMTw5tvvsnatWs588wzadiwIQMGDPDs03tb7+1zcnKKHH/79u1cdtllNG7cmCZNmvDnP/+ZQ4cOAdC/f38SExO54YYbiI6O5oUXXiiyr+TkZHr37k2jRo3o0KEDb731VoE4br31Vu666y7q1atH586d8dVfOsDTTz/No48+CjhjQNetW5cnn3wSgGPHjhEZGcnBgwcLHH/EiBEsW7aMAQMGEB0dXeAcLFy4kFNPPZWYmBj+9re/FTuU42mnncb9999P586diyw7cuQIs2bN4tlnnyU6OpqePXvSu3dvPvjgAwBmz55N586dueWWW4iMjGTUqFFs3LiRn3/+GYD33nuPwYMH07JlS+Li4hg8eDBTp04FYNu2bXz//fc888wzREVFcfPNN9OlSxdmzZrlM841a9bQrVs36tevT7NmzXj88cc9y2655RaaN29OgwYNuPjiiz0XEAD33HMPjzzyCNdccw3R0dFcdNFF7Nmzh0GDBhETE8Ppp5/ODz/84Fm/bdu2jBs3jk6dOhETE8O9995LZmamz5iSk5O5+eabiY2NpV27drz22mt+xStSKbm/Q3KzQxtHGShBB2Dr1q1MnDiRtWvXkp6ezoIFC2jbtm2x669evZpffvmFTz75hEGDBjFmzBgWLlxIfHw8M2bMKNdADNZahg0bRnJyMlu2bGHXrl2eISM/+OADWrduzbx588jIyPAkTG933HEHLVu2JDk5mZkzZzJ8+HDPRQbA3Llzuf322zl06BC9e/cukES99erViyVLlgCwdu1amjdv7vk8K1eu5LTTTiMmJqbANmPGjOEPf/gDEydOJCMjo8CQjvPnz2ft2rVs3LiRGTNmlGuIyW3btlGjRg06duzomeceXhMgPj6erl27epbVrVuX9u3bF7u88LannHIK9erV87m8sIEDBzJw4EDS0tLYvn07t956q2fZNddcwy+//MK+ffs455xz+POf/1xg2xkzZvDcc8+RkpJCnTp16N69O+eccw4pKSn07du3SPKcNm0aCxYsYPv27Wzbto3nnnuuSDx5eXnccMMNdO3alaSkJBYtWsQrr7ziOc8lxSsiJ4YSdABq1KhBVlYWP/30E9nZ2bRt25b27dsXu/4///lPIiMjufLKK6lbty533HEHTZs2JS4ujj/84Q8FSkL+6tChA1dccQV16tQhNjaWxx9/3O9Ev2vXLpYvX8748eOJjIzkrLPO4oEHHvCUMAF69uzJtddeS40aNejfvz8bN270ua/u3bvzyy+/cODAAZYuXcr9999PUlISGRkZfPvtt/Tq1atMn2vo0KE0bNiQ1q1bc+mll7Jhw4YybQ+QkZFBgwYNCsxr0KAB6enp5VreoEEDMjIysNaWum1htWrV4tdffyUlJYXo6GguvPBCz7L77ruPevXqUadOHU8p/vDhw57lN954I+eeey6RkZHceOONREZGctddd1GjRg1uu+22In83AwYMoFWrVjRq1IgRI0bw8ccfF4ln7dq17N+/n5EjR1K7dm1OOeUUHnzwQaZPn15qvCJyYihBB6BDhw688sorjBo1iqZNm3L77beTnJxc7PrNmjXzvI+Kiiryc3kqb+3bt4/bb7+duLg46tevT79+/UhJSfFr2+TkZBo1alSgFNimTRuSkpI8Pzdv3tzz/qSTTiIzM9PnrfaoqCi6devGt99+y9KlS+nVqxc9evRgxYoV5UrQhY9bnnMTHR1NWlrBEWzS0tI8n7esy9PS0oiOjsYYU+q2hb399tts27aN008/nfPOO4/58+cDkJuby9ChQ2nfvj3169f33IHx/h2W9e/GewzxNm3a+Pyb3LlzJ8nJyTRs2NDzGjt2LHv37i0xXhE5cZSgA3TnnXeyfPlydu7ciTGGIUOGBLzPunXrcvToUc/Pe/bsKXbdYcOGYYxh06ZNpKWl8eGHHxZ4XuuucexLixYtSE1NLVDqS0xMJC4urlxx9+rVi2+++YYffviB8847j169erFgwQLWrFnDxRdf7HObkuILVMeOHcnJyeGXX37xzNu4caPneXXnzp0L3BE4cuQI27dvL3Z54W137NhR4Nx5Ly/s1FNP5eOPP2bfvn0MGTKEvn37cuTIET766CPmzJnDwoULOXz4MAkJCQDFPnP3x65duzzvExMTadGiRZF1WrVqRbt27Th06JDnlZ6ezhdffFFivCJy4ihBB2Dr1q188803ZGVlERkZSVRUFDVq1Ah4v2eddRZLly4lMTGRw4cPM27cuGLXTU9PJzo6moYNG5KUlMS//vWvAsubNWvGjh07fG7bqlUrevTowbBhw8jMzGTTpk28/fbbRZ6B+qtXr168//77dOrUidq1a3vaa7dr147Y2Fif25QUnz+stWRmZnL8+HEAMjMzycrKApwLnZtuuomRI0dy5MgRVqxYwZw5c+jfvz/g3DrevHkzs2bNIjMzk9GjR3PmmWdy+umnA3DXXXfx0ksvkZSURHJyMhMmTOCee+4BnOR/1lln8cwzz5CZmclnn33Gpk2buPnmm33G+eGHH7J//34iIiJo2LAh4DwiSU9Pp06dOjRu3JijR48GpXne66+/zu7du0lNTWXs2LEFaqa7nX/++dSvX5/x48dz7NgxcnNz2bx5M2vXri0xXhE5cSplO+hgtFMOhqysLIYOHcqWLVuoVasWPXr0YPLkyQHv94orruC2227jzDPPpEmTJgwZMoS5c+f6XPfpp5/mrrvuokGDBnTo0IH+/fvz8ssve5YPGzaMRx99lCeffJKnnnqKvn37Ftj+448/5uGHH6ZFixbExMTwzDPPcMUVV5Qr7h49enDs2DFPablTp05ERkYWW3oGpzLS3XffzRtvvEH//v0L1CT2x86dO2nXLr9NY1RUFG3atPGURCdNmsR9991H06ZNady4MW+88YanlBsbG8usWbMYMGAA/fr144ILLvA8gwV46KGH2LFjB126dAHggQce4KGHHvIsnz59Ovfccw8xMTG0bt2amTNnFnsh8uWXX/L4449z9OhR2rRpw/Tp0z3PkhcsWEBcXByNGjXi2Wef5Y033ijTOSjszjvv5MorryQ5OZk+ffrw1FNPFVmnRo0azJs3j8GDB9OuXTuysrI47bTTPBXKiotXRE4cE8ittGDq1q2b9dWEZ8uWLZxxxhkhiEik8incMU1F0/+nhNQoV0XNQT9Cw9a+11k8Dr59HurUh6w0uPARuLr4u5InmjFmvbW2m69l5brFbYz50hhjjTHPFZofY4yZYoxJMcYcMcYsNMZ0Kc8xREREqrMyJ2hjzB1AVx/zDTAXuBp4FLgZqAUsNsaoA2AREZEyKNMzaGNMQ+Bl4O/AR4UW9wZ6ApdZaxe71l8J/AY8CTwWcLQiUiL3s3cRqfzKWoJ+AYi31hbt+cBJ0Mnu5AxgrT0MzAP6lD9EERGRIHr9Qnjn6lBHUSq/S9DGmJ7AXfi4ve3SGdjsY348cJcxJtpaW65hlPLy8oiIUIswkXASLhVMRcps/5ZQR+AXv7KeMaYW8B/gRWvt1mJWawQc9DE/1TWNKbzAGPMXY8w6Y8y64kYBqlu3LklJSRw/flxfCCJhwlrLgQMH1PRKpAL5W4IeAkQBY0pYxwC+MmixXUVZaycDk8FpZuVrnZYtW5KSksLOnTt9djEpIqERGRlJy5aq/ylSUUpN0MaY1sAI4AGgjjGmjtfiOq6KY+k4JeVGPnbhLjn7Kl2XKiIigqZNm9K0adPybC4iIlIp+XOL+xQgEvgQJ8m6XwD/cL3vgvOs2VdHxJ2AxPI+fxYREamO/LnFvQG41Mf8xThJ+23gV5w20PcaY3pZa78FMMbUB26gaJMsERERKUGpCdpaewhYUni+axSindbaJa6f5wIrgQ+NMU/glKyH4TyDfiFoEYuIiFQDQWu7ZK3NA64HvgYmAZ8BucCl1tpdJW0rIiIiBZV7NCtrbZHa2dbaVOA+10tERETKSb1/iIiIhCElaBERkTCkBC0iIhKGlKBFRETCkBK0iIhIGFKCFhERCUNK0CIiImFICVpERCQMKUGLiIiEISVoERGRMKQELSIiEoaUoEVERMKQErSIiEgYUoIWEREJQ0rQIiIiYUgJWkREJAwpQYuIiIQhJWgREZEwpAQtIiIShpSgRUREwpAStIiISBhSghYREQlDStAiIiJhSAlaREQkDClBi4iIhCElaBERkTCkBC0iIhKGlKBFRETCkBK0iIhIGCo1QRtjrjLGfGOM2WOMyTLG7DbGzDDGdCq0XowxZooxJsUYc8QYs9AY06XiQhcREam6/ClBNwLWAwOAK4FhQGdglTGmDYAxxgBzgauBR4GbgVrAYmNMywqIW0REpEqrWdoK1tqPgY+95xlj1gA/A32BCUBvoCdwmbV2sWudlcBvwJPAY8ENW0REpGor7zPoA65ptmvaG0h2J2cAa+1hYB7Qp/zhiYiIVE9+J2hjTA1jTG1jzKnAf4A9wHTX4s7AZh+bxQOtjTHRAUcqIiJSjZSlBL0ayAK2AWfi3M7e51rWCDjoY5tU1zSm3BGKiIhUQ2VJ0P2BC4E7gTTga2NMW9cyA1gf25iSdmiM+YsxZp0xZt3+/fvLEIqIiEjV5neCttZusdaudlUa+yMQDQx1LU7FKUUX5i45+ypdY62dbK3tZq3tFhsbW4awRUREqrZyVRKz1h4CfgU6uGbF4zyHLqwTkGitzShfeCIiItVTuRK0MaYZcDqw3TVrLhBnjOnltU594AbXMhERESmDUttBG2M+A74HNuE8e+4I/B3IwWkDDU4SXgl8aIx5AueW9jCcZ9AvBD9sERGRqq3UBA2sAm4FBgO1gV3AEmCctTYBwFqbZ4y5HngRmARE4iTsS621u4IftoiISNXmT09i44HxfqyXCtzneomIiEgANJqViIhIGFKCFhERCUNK0CIiImFICVpERCQMKUGLiIiEISVoERGRMKQELSIiEoaUoEVERMKQErSIiEgYUoIWEREJQ0rQIiIiYUgJWkREJAwpQYuIiIQhJWgREZEwpAQtIiIShpSgRUREwpAStIiISBhSghYRkfCWlgxLX4T0vaGO5IRSghYRkfC2fip88yz8OCPUkZxQStAiIhLecrKcaW52aOM4wZSgRUREwpAStIiISBhSghYRkepjzVuhjsBvStAiIlJ95FWe59hK0CIiImFICVpERCQMKUGLiIiEISVoERGRMKQELSIiEoaUoEVERMJQqQnaGNPXGDPLGLPTGHPMGLPVGDPOGFOv0HoxxpgpxpgUY8wRY8xCY0yXigtdRESk6vKnBP0PIBcYDlwNvAH8FfjaGBMBYIwxwFzX8keBm4FawGJjTMsKiFtERKRKq+nHOjdYa/d7/fytMSYVeA+4BPgG6A30BC6z1i4GMMasBH4DngQeC2bQIiIiVV2pJehCydltrWsa55r2BpLdydm13WFgHtAn0CBFRESqm/JWEuvlmm5xTTsDm32sFw+0NsZEl/M4IiIi1VKZE7QxJg4YDSy01q5zzW4EHPSxeqprGlO+8ERERKqnMiVoV0l4DpAD3Ou9CLC+Nillf38xxqwzxqzbv9/XnXQREZHqye8EbYyJxKmpfQpwlbV2t9fiVJxSdGHukrOv0jXW2snW2m7W2m6xsbH+hiIiIlLl+ZWgjTG1gFnA+cC11tofC60Sj/McurBOQKK1NiOgKEVERKoZfzoqiQCmAX8E+lhrV/lYbS4QZ4zp5bVdfeAG1zIREREpA3/aQb8O3AKMAY4YYy70Wrbbdat7LrAS+NAY8wTOLe1hOM+gXwhuyCIiIlWfP7e4r3FNR+AkYe/XAwDW2jzgeuBrYBLwGU7vY5daa3cFOWYRESlsw0fw7nWQUcUr3GZnwsJRkLCi9HWthb2+WgBXDqWWoK21bf3ZkbU2FbjP9RIRkRNp0WhI/x1StkJ0Fa50u+dHWP4ybJ5V+rpJ38PP8ys+pjsXIiwAABlxSURBVAqi0axERKqC3OxQR+Bb5mH4+b9OyTcoXC16/blTkJUWpGOGhhK0iIhUnKUvwvQ74afPQx1JpaMELSIiFeeoq0PJnGCVoKsPJWgREZEwpAQtIiIOayGzcj+3rUqUoEVExLFgBDzfCpI3hDoSQQlaRETcdix2phn7QhtHcbZ9CW9fEeooThglaBERqRz2/RzqCE4oJWgREZEwpAQtIiIShpSgRUREwpAStIiISBhSghYREQlDStAiIiJhSAlaREQkDClBi4iIhCElaBERkTCkBC0iIhKGaoY6ABEREZ/2xkN29R1HWiVoEREJT2/0gCmXATbUkYSEErSIiEgYUoIWEREJQ0rQIiIiYUgJWkREJAwpQYuISGD2b4PfloY6iipHzaxERCQwb10KxzNgSAJExYQ6mipDJWgREQnM8Qxnmpsd2jiqGCVoERGp9NoO/W+oQwg6JWgREan06nA81CEEnRK0iIhUbju/Y2vkPbDspVBHElR+JWhjTEtjzL+NMSuNMUeNMdYY09bHejHGmCnGmBRjzBFjzEJjTJdgBy0iIuKRluRME1eFNo4g87cE3QG4FTgILPO1gjHGAHOBq4FHgZuBWsBiY0zLwEMVETmBrIW8vFBHUTVtng0Jy0MdRdjzN0EvtdY2s9ZeC3xazDq9gZ5Af2vtx9baL13zIoAnAw9VROQEmnI5vHSGk6gleI4fhZn3wtTrQh1J2PMrQVtr/bmM7A0kW2sXe213GJgH9ClfeCIiIZK0DjL2gF9ff+I3nU+/BbOSWGdgs4/58UBrY0x0EI8lIiInSsovsO/nUEdR7QQzQTfCeUZdWKprWqR7GWPMX4wx64wx6/bv3x/EUEREJGgmdoNJF4Q6iuItGh3qCCpEMBO0wfeo2qa4Day1k6213ay13WJjY4MYioiISOUWzASdilOKLsxdcvZVuhYREREfgpmg43GeQxfWCUi01mYE8VgiIiJVWjAT9FwgzhjTyz3DGFMfuMG1TEREqpofZ/q33h5fdYilJH4naGNMX2NMX+Bc16xrXPPcCXkusBL40BhzuzHmKtc8A7wQzKBFRCQM5GTBrPv9W3ftW8640eK3sowHXbiDkkmu6bfAJdbaPGPM9cCLrmWROAn7UmvtroAjFRGR8FJcm+ZjByFjP8R2LDj/eHrFx1SF+J2grbXF1sb2WicVuM/1EhGR6mjqDbD3R3i8DG2nM/bB8lfg7H7QrFPFxVaJaDQrEREJrr0/OtPjR/zfZvs3sOp1WP5yxcRUCSlBi4hI6Ln7PM/JDG0cYUQJWkRE/HP8qDM9mAC52SENpTpQghYRqcqshU0zYO9Pge/r5//C7nXwaleY+1jg+5MSKUGLiFRlB7bD7AdhWt/A9zX7gfx2z7vXBr4/KZEStIhIVZbnuhWdlhSc/a1+Izj7kVIpQYuIhEJeLnw5DOI/C3UkEqaUoEVEQuHQTlg1CT69J/j7zsmCzLSi8xeMgBc7wtHUossk7ChBi4hUNe9cBc+3KtoOeeVEyNgL6b+HJi4pEyVoEQkfu9bAho9CHUXll/yDM3U3i6psjh+FSd1DHUXIlaUvbhGRivXuNZCXA+0vg3rNQx2NhMrRFNgXhGZhlZxK0CISPvJyCk5PtKTvIX1PaI7tD2vh2KFQR+G/zbNgw4ehjqLSUoIWEQFI+x3euhSmXhfqSIr37XgY3wZ+Wxa8fX49Eqb/GfKKGZkqfW/5971kbPm3FSVoEQlzuTnw+SOw7p2KPU6263ntgV8r9jiB2L3OmWb4SJrGNeDgxo/Lts8Vr8LP8yHnWP68j26BxNXO+53Lyx6nBIUStIiEt4w9sGEazP978PZZXDOkymj7Ytj3M7Q4x/k5+1jJ6/tLt6ZDTglaRKqeb55zbt0Wp7hmSIE4mgpfDneeY1eExFXw69dFj/nBn2DKH6H2SUE+oCl9lY9vD/IxxZsStIhUPUv/5dy6LU5FNENKXOmMZ7zomeDt01vqjqLz3CNKHc8I/vG+fw/SkkteZ8cS3/NjTw96ONWRErSIhNbPXzilw3CyeVbZt3GPZ5zlR7I8uBM+6V9w3pLnYf7j+fs50X5dWLQGu/uZt7/ct9ejGgUnpmpOCVpEQic7E6bf4dxyDidzHq3Y/e9aDXs35/+84SNYMg7Wve300e2Lv91z+nNx4WvoyRl3wbEAuwDd9Elg20sBStAiEjq2mKY9oZYdxGfT/vj8ryUvP5wEX40I/Dh1Y53pzhWB78uXcP19VlJK0CIi4e7YweDsp1lnZxpRIzj7qwi52aG7zR9mlKBFpOy2fwNf/RNyjpdtu9wcp0mQry/gpS8GJ7aSjv3jTDiUWLHHCTc/+GgutXl2+PbTve1/zu12UYIWP1mrIeoKS99Tfc/JrAfhu9fK3l/yipdh0gUQP7vosm+eDU5s3lJ3OBWX8nJh91qYdT98Vsrt5MLSf4cD230vy0r3r1IYwIrXYFQDePWs4LVV9oe7pndct/x5x1Jhy9zgH2v3WnjxNEj8LrD9/L4hOPFUckrQ4p8FI+CFdrBrbeD72jgdvn/fef/9B8HttvBEycuDCafBv88p+7bxnzs1divzbbyjKa43ZfwMh3Y508zDQQ0HgE2fwhdPFKxk9ctCGNMc3u8Dua7Svq/mSiV5/ULn95yTVXTZhNPhlf8rfR95efD1P533B3+DowfKFkMwFG4n7evzBGr/VqdjGQkKJWjxT+JKZ3pkX+D7+uwhmPsoHDkAcwfAe9cHvk+A7ybC822cL4mySP3NvxLN9sXw38FOicldGaY8zwY/vdupsXtkv3/rfzfRSQSpv5X9WNbCtq+cSka+ZB6GLfMKfv70PU7TJ3eiyz4GM++HDWXsQvJEm/0ArJkMh3flz3OX1BMCuAg8nu5MfQ3gcTzD+RvIzYb9W8p/jPIqT3OwyiyrAi7swpgSdLjLyw2v0Wt2rYHP/xZYB/putpjmJL58ORy+eLLkdTZ+DJmH4GCC7+U5WUUT8f5t8NpZ/j3zmj8I1k6BPZv8CrlU/pag10x2brMedCXorAx47wZY/Z/St9272elX+ZN+RY+9/GVnP5/0c0r1bp8/4jR92uXqizn1N9g8Ez5/2L94g2nrl87dG7eDO0vf5khK/nv3hWVFWzLO6b3Mber18FKn4gegCFZnJu47EQ1aB2d/4apWsHtJqxyUoMPd7Aed0WtKuS3Xduh/T0w8K15x+ugNRjONb8f7v+6q12GNHwmpJJMuhBdOKZgY3V9wO74tsnqRc1oRF0r7foaUX3wvO5ICH98BhwolpUOJ8NtS+F8pFyyQfxtzz4/OdNMMp4LQ4V2wcBT8vtG1Xmb+Nu7BIrznFcf9fLOs5v/dv+f3n94NP3ldPBTXTnfj9Pz3U/5YvphKYy28/yfn7k9hhe9uJCyDtCTIK+f5KavIBr7nH/wt8P+bcFCjVqgjCAkl6HC3Zb4zPVLyM6tPa4+CKVeUff/ZmZC+lzuHjy++IowvaUlweHfZj+dt7ZSi86x1agh792i04rXAjuOWuiN/xKLcHOeW7cFy3DYuzoy74dN783/Oziy5r+f5g5wKUxO7+V6+dzNs/SL/5w9u9K/WdFY6zBsIoxsXvbCb/SDMvBde6VL6fkpSo44zXevqWGPP5vxb4plp+V1EHt4N6971fR5++YpSn2H7c5HgjqOi5WXDjsX59Sf8sWtN/v8wkGXLkGi2zIPv/l2GAH1ICPORqIp79CKAEnR42r0+f6g3P50XsQ12ryl9xZzjBUfxmdYXJnTko9pj4Z2r/T/gV0/By53LFGOJNnzkHH/7IicRed9ydleuKc7RVKdE6W8nCUnrIWmdc8v2s4eceblZ8N9/5Jfq0vfyUa3nYGMxPSP5Khn99HnB2smTLoDx7fJL7Mk/OM+D3byTr1tmWsm3vrPSC/786llOcydvE8+H9VOdZ6aBXEQd2A4rX/f9fL5tT2daszaseQvevMg5JsCUy+GlM5zP8nJn50Lk03vh66ed/p3dPnvIGYe4JDFtS15ubXAq2+VmO49HSlKeGvvvXQ+f/BlWTQJgP8WUdH35pJ/zfxasNtC+FNdrmb9qRgW2/az7A9u+igtqgjbGtDLGzDTGHDbGpBljZhtjqvjDkeDx3FKdchm8c2XpGxw/UrTv3NK8d70zio/7i9678oyvCmDpe8v/BZGb45QAdizhh5Hnwuy/OCUtXxY96zwvdN9y/b0Mz3k/e9h5llq4yU/Oced41jrPMt2m/DH/1qx3Ul/7llN6B/juNXrU+Cl/iMPtiwt+gZfUNeW71zm3zA8mOInfXblo8iXO8+Di7Frj/G4WjXZKoMtf8b2ed8Wgg785zZ0SlueXltO9Bjj4aU7++18XFn9scM5R0vf5t9T/9yQsGO67gpV3Rxfuym7uBJbiqqSX7dXO9pcFzuORwnYsLjmmhm2KzlvzlnN7Pi/PqTz37rUl78Pt/d7O1Pv8ZB5yKuG9fgG8dVnJ27/Z07/j+FJCL2D/zvlTydtWVG3/eY+VPOKXPxrEBbb9vhBUrKtEagZrR8aYk4BvgCzgbpx7V88Bi40xZ1prT3DfeUGWvhfq1MtvqmCt8yVfs3bp26b97nxpteuVP6g6OLf+vvs39JsJjU5hdM134X9L/Y/pnaudCktDEvzfxl3xJyvD+fItbEwLuHM6tLvY+XwTOkJ0c6jfwvf+DmyHhq0LPiM6muqUUpN/gMVjADg7Atj0a/F99bqTmPsfNueYs+/G7Yv/LNY6xyjun3zhKOfZ9R2fwGd/KbisuM4qZt0Pp14BxnXt6u556YNCX6LuCwlwPq/3l/vO5fC+163F93rDlaW08R3lVbJa/pLzKo6vJkpTr4PoZvCPbYXi9GpP+uHNxe9z/qCi89wXL6VV5quI56w2z3lunuvjlv4X/3CmFw1ymvQE0qzn5//Cwqf9Wze7UMce/rZ/9pJrI/waxbGArf+Dk7uW+VhA6cNprpxYvv3KCRG0BA08CJwCnGat/RXAGLMJ+AV4CCjhGydEMvY5X+7tLi6YOK11KsosGg0168Clw+G1s6FOA+fLe8+PTgI5lAh3z4d2fyi435ws52o7ZRv88WmnQ4DkH+CRVdD0jPz1Vv8HUrdDyq9wUmPuqvk1rC403qvbzhXQ6jwnGRw76Iwy465NXMwXxeXD/sPCx7rDb9/CmbdDdGzBFXw9S8s+4sTd7uL8pFnSl+C/z4HzHoTrXL1AbVsAH93qe92S1D/ZKcH/5nWB8u9z4LTrwNRwkkTNSK84M52LDXepyNuuNdDxqvzKTgnLiia1OY8UH4v3urvXOF+Q3pZNKPjz1/8s+Vl24nfBq7j0+vnF12jNCELN+tIsGAHn3J3/c15u/rCOpqyZpwTbFuQn4orkb3L2xXssZO87FQC16+U3z/LyaW4v/hHxadmOM+cReLiUSpl7f3Rehf04o2zHKqPt+4/QXg9KK0wwE3RvYJU7OQNYa38zxqwA+nAiE3ReHnzQB04+C869Bxqd4tQYTt0Bl49ySoQ/z4cZruHerhzjfKEfz3D+0TIPw7p38vfnLkVlHXaam3h773q4ay6segN6PQFx58K2L50kBwWbU2Tsc57TdfoTtOme/4VW3G3PJV61nBc+7XR0X1JiASdZf/8efD2ShXVywF2BM2k9XPyE14ol3DZb8xZ0utH/AeD3xjtf1K+dXbTGsb8atXdKpd7PxwG2etWkzsl0nsvdOBne6FF8Ulz2IlzwcP4QhmUtJbx2NpxySf7PhQelL3yr2FdXihXlaErJyxeP87zdb+sTa9JKWLkcVk4seD43TMt/730BBYF13ZlVTNyFn8F7qZDPWxLvZ/N+NhnM8+ep4vGM4mtlF1ZaJbpK3BeOBDdBdwbm+JgfD5Tw4K2C/LbUeX1XqAawr1usX40oeaSYhaNKPpa7FLftf/6tt/rNktdzWzK24M/FJedvn89//+7V+U1qvMV/5rzcPr2n+OPu/xn+dYpzy9Qfid/B6ADHf3VXrsoppcOQLfMgZlzpta83TCt/pwZ5OWXv7KScnsx+kBdqvRW8HXr9LUR4fzsHchu6vD1OrQ3gcxXXfnh3EHqyC5bi7hgcPeCz9Oy38W3g/EKPZLwfqbglrff9XL8qqB3tXKhUc8YGqQKCMeY48JK1dmih+c8BQ621JV4MdOvWza5bV8bBwUuyfXHR54ZeZuf2pE/ECmqYynmJuSS3K5fU8PFPW073Hf8H79Su4MEKvHyZex6XRXxPbeNfyePr3HO5osb6Co7qxMqxEXTI+pBzzDZm1xkV9P2f8BJljdrOy8cX68a8U+gaUcYuNn2JqJV/sVGrboFhIffZhjQ1J6hTn9rRrue7Zfv+GJt9B8NrFeyR7dWcGxlY87NitnDx/tyQ38wttwwXT+56FWUZErI8xylJzSgnDu/hPGtHu46RXfxxCn/+krj3B87Fdkl3GbzX9Vffd5w7rkFijFlvrfXZ1jLYCXqCtXZYofljgCG+ErQx5i+A+1LxNCDYxZYmQCn3BKUUOoeB0zkMnM5h4HQOgyPY57GNtTbW14Jg3uI+CPi6zxnjWlaEtXYyMDmIMRRgjFlX3JWJ+EfnMHA6h4HTOQyczmFwnMjzGMz6d/E4z6EL6wSUcUw6ERGR6i2YCXoucKEx5hT3DGNMW+Ai1zIRERHxUzAT9FtAAjDHGNPHGNMbp1b3LvIb+5xoFXb7vBrROQyczmHgdA4Dp3MYHCfsPAatkhiAq1vPl4ErcPrLWQQMstYmBO0gIiIi1UBQE7SIiIgER6XrpC2QATmMMZHGmH8ZY343xhwzxqw0xlxc0TGHm/KeQ2NMN2PMZGPMz8aYo8aYRGPMNGNMuxMRdzgJ1sAwxphhxhhrjAnzcQErRqDn0RhzhjHmU2NMiut/eqsxZmBFxhxuAvxObG2Mec/1v3zUGLPNGPOcMaZuRccdTowxLY0x/3blhKOu/8m2fm5bYXmlUiVorwE5TscZkKM/cCrOgBz+/EG9jdNn+EjgeuB3YIEx5qyKiTj8BHgOb8epqf8acA0wFDgHWGeMaVVhQYeZIPwduvdzCjAC8DGMWNUX6Hk0xnQDVgN1gAeAa4EJQI2StqtKAjmHruULgYuBfwLXAVOAwcA7JWxaFXUAbsVpEuxj+LYSVVxesdZWmhcwEMgFOnjNawfkAI+Xsm1XnG5/7vWaVxOnc5S5of5sleQcxvqY1wbIA0aH+rNVhnNYaD8LcCpQLgGWh/pzVabziFO4iAc+C/XnqMTn8ErXd+KVheY/79r+pFB/vhN4HiO83j/gOi9t/diuQvNKpSpBU8yAHIB7QI7Sts0GPJ1xW2tzgOnAVcaYOsEPNyyV+xxaa/f7mLcT2A8EODBspRLI3yEAxpg7ce4+DCtt3SoskPN4CU4fC+E3St6JFcg5dI+VW7g/2EM4F0BBHJ4svFlblv5PC6jQvFLZEnRnYLOP+fE4/6ylbfubtbbQoK7E4/yhdgg8vEohkHNYhDHmDKApUJ1GXg/oHBpjYnBaOzxprU0NcmyVSSDnsadrGmmMWWWMyTbG7DPGvGaMiQpqlOEtkHO4EGc44PHGmE7GmGhjzGU4pfI3rbWlDCYtVHBeqWwJuhG+uw1NxelStLzbupdXB4GcwwKMMTWBN3FK0G8HHlqlEeg5/BewDZgaxJgqo0DOYwvX9BPgK5ymnS/g3J78KFgBVgLlPofW2kycCx3344J0nKax84EBwQ2zyqrQvBLMvrhPFF/twvy5FWMC2LaqCdZ5mAj0AK6z1vrsb70KK9c5NMb8AbgLOMe6HlhVc+X9W3QXLj601o50vV9ijKkBPG+M6WStrS5dDJf3bzES5wKnKU7lskTgfJzKTjnAX4MYY1VVoXmlsiXoMg/I4SUV8NX0IMZreXUQyDn0MMaMwxmJ7G5r7VdBiq2yCOQc/gfnbsNuY0xD17yaQA3Xz8estUEa2y/sBXIeD7imXxea/xVOJaezqB5jAARyDu/HeZbfwVq73TVvqTHmMDDZGPOmtTZ4Y9pWTRWaVyrbLe5ABuSIB9q5miUU3vY48GvRTaqkgAc1McaMwGliNdBa+0EQY6ssAjmHZwAP43x5ul8XARe63lenUkug/89QtPTiLrmUt9JPZRPIOewCHPRKzm5rXNMzAoytOqjQvFLZEnQgA3LMBWoBt3htWxO4DfiqGpVaAhrUxBjzGPAcMMJa++8KijHcBXIOL/Xx2ohT0edSYGbwww1bgZzH/wFZwNWF5l/lmq4LTohhL5BzuAeIMcYUrsh0gWuaFKQYq7KKzSuhbn9WxrZqdXGuSH7EaULQG+fLbQcQ7bVeG5xnKCMLbT8dp5TyAPBHnC/DTJzngSH/fOF+DnE6KsnD+XK8sNCrU6g/W2U4h8XsbwnVsx10oP/PT7vmjwUux7mrcwyYGurPVhnOIdAWp4nVNpxOTi4FnnDNW4dX2+Dq8AL6ul5v4NyZ+avr516l/B1WWF4J+Ukpx0lsDcxy/RGlA59TqEG56w/PAqMKzY/CaTe5x3UCVwOXhPozVZZziFPr2BbzWhLqz1UZzmEx+6qWCTrQ84hzO/txV4I6DuwERgO1Qv25KtE57ATMwBl18JgrWb8IxIT6c4XgPJb43RaKvKLBMkRERMJQZXsGLSIiUi0oQYuIiIQhJWgREZEwpAQtIiIShpSgRUREwpAStIiISBhSghYREQlDStAiIiJhSAlaREQkDP0/V7DY4kmj5AQAAAAASUVORK5CYII=
"
>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="_WeightGenerator" class="doc_header"><code>class</code> <code>_WeightGenerator</code><a href="https://github.com/tburnett/wtlike/tree/master/wtlike/simulation.py#L73" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>_WeightGenerator</code>(<strong><code>func</code></strong>, <strong><code>alpha</code></strong>=<em><code>0</code></em>, <strong><code>beta</code></strong>=<em><code>0</code></em>, <strong><code>n</code></strong>=<em><code>100</code></em>) :: <code>_Sampler</code></p>
</blockquote>
<p>Generate a set of weights</p>
<ul>
<li><code>func</code> -- nominal weight distribution function, evaluated on (0,1)</li>
<li><code>alpha, beta</code> -- (default 0,0). Values for $\alpha$, $\beta$.</li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Test">Test<a class="anchor-link" href="#Test"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">wg</span> <span class="o">=</span> <span class="n">_WeightGenerator</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
<span class="n">test2</span> <span class="o">=</span> <span class="n">wg</span><span class="o">.</span><span class="n">mean</span><span class="p">,</span>  <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">wg</span><span class="p">(</span><span class="mi">1000</span><span class="p">))</span>
<span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span> <span class="n">test2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">test2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1e-1</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Not almost equal: </span><span class="si">{</span><span class="n">test2</span><span class="si">}</span><span class="s1">&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="generate_cell" class="doc_header"><code>generate_cell</code><a href="https://github.com/tburnett/wtlike/tree/master/wtlike/simulation.py#L89" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>generate_cell</code>(<strong><code>wfun</code></strong>, <strong><code>mu</code></strong>, <strong><code>alpha</code></strong>=<em><code>0</code></em>, <strong><code>beta</code></strong>=<em><code>0</code></em>)</p>
</blockquote>
<p>Generate a cell</p>
<ul>
<li><code>wfun</code> -- weight function, or histogram.
  Defined on (0,1)</li>
<li><code>mu</code> -- number of expected weights, on average</li>
<li><code>alpha</code>, <code>beta</code>  -- default 0,0; values for $\alpha$ and  $\beta$ for this cell</li>
</ul>
<p>Returns a dict with:</p>
<ul>
<li><code>n</code> -- actual generated number of weights, from Poisson</li>
<li><code>w</code> -- array of weights</li>
<li><code>S, B</code> -- expected values for $\sum w$ and $\sum(1-w)$, calulated from wfun</li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Test with a function peaked at both ends, generate equal signal and background</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">test_gen</span><span class="p">(</span><span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="n">wfun</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="mf">0.5</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.precision&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">quiet</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Test with alpha=</span><span class="si">{</span><span class="n">alpha</span><span class="si">}</span><span class="s1">, beta=</span><span class="si">{</span><span class="n">beta</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">cell</span> <span class="o">=</span> <span class="n">generate_cell</span><span class="p">(</span> <span class="n">wfun</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span>  <span class="n">alpha</span><span class="p">,</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">beta</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">beta</span><span class="p">)</span>
    <span class="c1">#</span>
    <span class="n">ll</span> <span class="o">=</span> <span class="n">LogLike</span><span class="p">(</span><span class="n">cell</span><span class="p">);</span> 
    <span class="k">if</span> <span class="ow">not</span> <span class="n">quiet</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Generated cell info:</span><span class="se">\n</span><span class="si">{</span> <span class="n">ll</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="n">fit</span> <span class="o">=</span> <span class="n">ll</span><span class="o">.</span><span class="n">fit_info</span><span class="p">(</span><span class="n">beta</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">quiet</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="mi">2</span> <span class="k">if</span> <span class="n">beta</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">1</span><span class="si">}</span><span class="s1">-D fit info:</span><span class="se">\n</span><span class="si">{</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">fit</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">t</span><span class="p">,</span> <span class="n">sigt</span> <span class="o">=</span> <span class="n">fit</span><span class="p">[</span><span class="s1">&#39;flux&#39;</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">alpha</span><span class="p">),</span>  <span class="n">fit</span><span class="p">[</span><span class="s1">&#39;sig_flux&#39;</span><span class="p">]</span>
    <span class="n">check_alpha</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span> <span class="k">if</span>  <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">&lt;</span><span class="n">tol</span><span class="o">*</span><span class="n">sigt</span> <span class="k">else</span> <span class="sa">f</span><span class="s1">&#39;alpha: abs(</span><span class="si">{</span><span class="n">t</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">) &gt; </span><span class="si">{</span><span class="n">tol</span><span class="si">}</span><span class="s1"> * </span><span class="si">{</span><span class="n">sigt</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span>

    <span class="k">if</span> <span class="n">beta</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="nb">bool</span><span class="p">(</span><span class="n">check_alpha</span><span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;Failed: </span><span class="si">{</span><span class="n">check_alpha</span><span class="si">}</span><span class="s1"> &#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">t</span><span class="p">,</span> <span class="n">sigt</span> <span class="o">=</span> <span class="n">fit</span><span class="p">[</span><span class="s1">&#39;beta&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">beta</span><span class="p">,</span> <span class="n">fit</span><span class="p">[</span><span class="s1">&#39;sig_beta&#39;</span><span class="p">]</span>
        <span class="n">check_beta</span> <span class="o">=</span><span class="s1">&#39;&#39;</span> <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">&lt;</span><span class="n">tol</span><span class="o">*</span><span class="n">sigt</span> <span class="k">else</span> <span class="sa">f</span><span class="s1">&#39;beta: abs(</span><span class="si">{</span><span class="n">t</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">) &gt; </span><span class="si">{</span><span class="n">tol</span><span class="si">}</span><span class="s1"> * </span><span class="si">{</span><span class="n">sigt</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span>

        <span class="k">assert</span> <span class="ow">not</span> <span class="p">(</span> <span class="nb">bool</span><span class="p">(</span><span class="n">check_alpha</span><span class="p">)</span>  <span class="ow">or</span> <span class="nb">bool</span><span class="p">(</span><span class="n">check_beta</span><span class="p">)),</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">check_alpha</span><span class="si">}</span><span class="s1">  </span><span class="si">{</span><span class="n">check_beta</span><span class="si">}</span><span class="s1">&#39;</span>
<span class="n">test_gen</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
<span class="n">test_gen</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
<span class="c1">#test_gen(10, 0, tol=5, quiet=False)</span>
<span class="n">test_gen</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">test_gen</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Test with alpha=0.1, beta=None
Generated cell info:
wtlike.loglike.LogLike:  10365 weights, S 4998.5, B 5001.5
1-D fit info:
counts      10365.000
flux            1.084
sig_flux        0.016
dtype: float64
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">simcells</span> <span class="o">=</span> <span class="n">pfits</span> <span class="o">=</span> <span class="kc">None</span>

<span class="k">def</span> <span class="nf">local_sim_cells</span><span class="p">(</span><span class="n">wfun</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">N</span><span class="p">):</span>
    <span class="n">sims</span> <span class="o">=</span> <span class="p">[</span><span class="n">generate_cell</span><span class="p">(</span> <span class="n">wfun</span><span class="p">,</span> <span class="n">mu</span> <span class="p">,</span><span class="n">alpha</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)]</span>
    <span class="n">fits</span> <span class="o">=</span> <span class="p">[</span><span class="n">PoissonRep</span><span class="p">(</span><span class="n">LogLike</span><span class="p">(</span><span class="n">cell</span> <span class="p">))</span> <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">sims</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">sims</span><span class="p">,</span> <span class="n">fits</span>

<span class="k">def</span> <span class="nf">simulation_test</span><span class="p">(</span><span class="n">N</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">funstr</span><span class="o">=</span><span class="s1">&#39;(x-0.5)**2&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ### Test the cell creation</span>
<span class="sd">    </span>
<span class="sd">    Generate {N:,} cells with mu={mu}, alpha={alpha} using the function {funstr}</span>

<span class="sd">    The deviations from the expected norm divided by each cell&#39;s average error:</span>
<span class="sd">    {fig1}</span>
<span class="sd">    Mean and STD of this distribution: {m:.3f}, {sig:.3f}: for a generated Gaussian distribution these wouild be 0 and 1. </span>
<span class="sd">    </span>
<span class="sd">    A validation of the shape is to evaluate the cumulative probability of the over-all mean</span>
<span class="sd">    for each likelihood function. This uses the `poisson.Poisson.cdf` function.</span>
<span class="sd">    {fig2}</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">simcells</span><span class="p">,</span> <span class="n">pfits</span>

    <span class="n">wfun</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;lambda x: </span><span class="si">{</span><span class="n">funstr</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">simcells</span><span class="p">,</span> <span class="n">pfits</span> <span class="o">=</span>  <span class="n">local_sim_cells</span><span class="p">(</span><span class="n">wfun</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
    <span class="n">flux</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">p</span><span class="o">.</span><span class="n">flux</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">pfits</span><span class="p">]);</span> 
    <span class="n">fmean</span> <span class="o">=</span> <span class="mi">1</span><span class="o">+</span><span class="n">alpha</span>
    <span class="k">def</span> <span class="nf">pull</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
        <span class="n">f</span><span class="p">,</span> <span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>  <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">flux</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">errors</span>
        <span class="n">s</span> <span class="o">=</span> <span class="p">(</span><span class="n">h</span><span class="o">-</span><span class="n">l</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">f</span><span class="o">-</span><span class="n">fmean</span><span class="p">)</span><span class="o">/</span><span class="n">s</span>
    <span class="n">pulls</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">pull</span><span class="p">,</span> <span class="n">pfits</span><span class="p">)))</span>
    
    <span class="n">m</span><span class="p">,</span> <span class="n">sig</span> <span class="o">=</span> <span class="n">pulls</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">pulls</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;font&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
    <span class="n">fig1</span><span class="p">,</span><span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="n">num</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">pulls</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">21</span><span class="p">),</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span><span class="kc">None</span><span class="p">),</span> <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;pull&#39;</span><span class="p">);</span> 
    <span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">fig1</span><span class="o">.</span><span class="n">width</span><span class="o">=</span><span class="mi">300</span>

    <span class="k">class</span> <span class="nc">CDF</span><span class="p">():</span>
        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alpha</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="mi">1</span><span class="o">+</span><span class="n">alpha</span>
        <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">p</span><span class="o">.</span><span class="n">poiss</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">cdf</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">fmean</span><span class="o">=</span><span class="mf">1.1</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">p</span><span class="o">.</span><span class="n">poiss</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">fmean</span><span class="p">)</span>

    <span class="c1">#</span>
    <span class="n">cd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">CDF</span><span class="p">(</span><span class="n">alpha</span><span class="p">),</span> <span class="n">pfits</span><span class="p">)))</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="n">num</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">cd</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">21</span><span class="p">),</span> <span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;probability&#39;</span><span class="p">)</span>
                            
    <span class="n">fig2</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">locals</span><span class="p">()</span>

<span class="k">if</span> <span class="n">Config</span><span class="p">()</span><span class="o">.</span><span class="n">valid</span><span class="p">:</span>
    <span class="n">nbdoc</span><span class="p">(</span><span class="n">simulation_test</span><span class="p">,</span><span class="n">mu</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h3 id="Test-the-cell-creation">Test the cell creation<a class="anchor-link" href="#Test-the-cell-creation"> </a></h3><p>Generate 10,000 cells with mu=50, alpha=0 using the function (x-0.5)**2</p>
<p>The deviations from the expected norm divided by each cell's average error:</p>
<div class="nbdoc_image">
<figure style="margin-left: 5%" title="Figure 1">  <a href="images/simulation_test_fig_01.png" title="images/simulation_test_fig_01.png">    <img src="images/simulation_test_fig_01.png" alt="Figure 1 at images/simulation_test_fig_01.png" width=300>   </a> </figure>
</div><p>Mean and STD of this distribution: -0.093, 1.031: for a generated Gaussian distribution these wouild be 0 and 1.</p>
<p>A validation of the shape is to evaluate the cumulative probability of the over-all mean
for each likelihood function. This uses the <code>poisson.Poisson.cdf</code> function.</p>
<div class="nbdoc_image">
<figure style="margin-left: 5%" title="Figure 3">  <a href="images/simulation_test_fig_03.png" title="images/simulation_test_fig_03.png">    <img src="images/simulation_test_fig_03.png" alt="Figure 3 at images/simulation_test_fig_03.png" width=300>   </a> </figure>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Follow-on:-combine-the-cells-and-fit-the-result">Follow-on: combine the cells and fit the result<a class="anchor-link" href="#Follow-on:-combine-the-cells-and-fit-the-result"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># need to fix simulate_cells</span>
<span class="c1"># cells=[]</span>
<span class="c1"># def simulation_lightcurve_demo(source_data):</span>
<span class="c1">#     &quot;&quot;&quot;</span>
<span class="c1">#     ### Lightcurve generation test</span>
    
<span class="c1">#     This uses the exposure measured for the source {source_name}, and</span>
<span class="c1">#     the default time bins to create a light curve assuming a fixed flux</span>
<span class="c1">#     and a histogram of weights from the data.</span>
<span class="c1">#     {output}</span>
    
<span class="c1">#     {fig}</span>
<span class="c1">#     &quot;&quot;&quot;</span>
<span class="c1">#     global cells</span>
    
<span class="c1">#     with capture_print(&#39;Print out&#39;) as output:</span>
<span class="c1">#         cells =  simulate_cells(source_data, source_flux=lambda t: 100)</span>
<span class="c1">#         fits =  fit_cells(source_data.config, cells)</span>
<span class="c1">#     fig = figure(flux_plot(config, fits), width=500)</span>
    
<span class="c1">#     return locals()</span>

<span class="c1"># if Config().valid:</span>
<span class="c1">#     nbdoc(simulation_lightcurve_demo, SourceData(&#39;Geminga&#39;))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

</div>
 

