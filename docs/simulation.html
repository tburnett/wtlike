---

title: Simulation


keywords: fastai
sidebar: home_sidebar

summary: "Generate simulated cells using the weighted likelihood"
description: "Generate simulated cells using the weighted likelihood"
nb_path: "nbs/10_simulation.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/10_simulation.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>For simulation the distribution of weights is required. That can be a histogram or a function, an input to the <code>_WeightGenerator</code> class. The class is a functor, with the argument a number on the range (0,1).  Passing an array of uniform random numbers then creates set of weights distributed according to the model represented by the input weight distribution.</p>
<p>To account for different levels of signal or background than that represented by the full dataset, the <code>_WeightGenerator</code> class accepts <code>alpha</code> and <code>beta</code> parmeters, which will be used to weight the weight distribution  by a factor</p>
<p>{% raw %}
$$ \big(1 + \alpha w + \beta \ (1-w)\ \big) $$
{% endraw %}</p>
<p>Generating a cell requires also the expected number of photons. If the average flux and exposure predict a number of events $\mu$, we select the actual number from the Poisson distribution.</p>
<p>This is done by <a href="/simulation.html#generate_cell"><code>generate_cell</code></a>, which creates a list of weights depending on $\alpha$, $\beta$, and $\mu$.</p>
<p>Finally, <a href="/simulation.html#simulate_cells"><code>simulate_cells</code></a> makes a list of cells, based on the actual exposure of a source.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="_Sampler" class="doc_header"><code>class</code> <code>_Sampler</code><a href="https://github.com/tburnett/wtlike/tree/master/wtlike/simulation.py#L21" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>_Sampler</code>(<strong><code>func</code></strong>, <strong><code>limits</code></strong>=<em><code>(0, 1)</code></em>, <strong><code>n</code></strong>=<em><code>100</code></em>)</p>
</blockquote>
<p>Sample an arbitrary function or histogram</p>
<ul>
<li>func -- a function, a histogram, or a fixed value<br>
  If a function, must be positive definite.<br>
  Assume histogram bins are 0 to 1.</li>
<li>a,b  -- limits (default 0,1)</li>
<li>n    -- table size (ignored if a histogram or value)</li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Gaussian-and-quadratic-example-functions">Gaussian and quadratic example functions<a class="anchor-link" href="#Gaussian-and-quadratic-example-functions"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">n</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">sf</span> <span class="o">=</span> <span class="n">_Sampler</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="n">limits</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="p">)</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">sf</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>
<span class="n">tests</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">mean</span><span class="p">()),</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">])</span>
<span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">tests</span><span class="o">&lt;</span><span class="mf">5e-2</span> <span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;Failed Tests: mean </span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">}</span><span class="s1">, std </span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span>

<span class="n">func</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span>
<span class="n">wfun</span> <span class="o">=</span> <span class="n">_Sampler</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>

<span class="n">test2</span> <span class="o">=</span> <span class="n">wfun</span><span class="o">.</span><span class="n">mean</span><span class="p">,</span>  <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">wfun</span><span class="p">(</span><span class="mi">1000</span><span class="p">))</span>
<span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span> <span class="n">test2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">test2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1e-1</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Not almost equal: </span><span class="si">{</span><span class="n">test2</span><span class="si">}</span><span class="s1">&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Use-a--histogram">Use a  histogram<a class="anchor-link" href="#Use-a--histogram"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">wtlike.weights</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>
<span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">valid</span><span class="p">:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;font&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">source</span> <span class="o">=</span> <span class="n">PointSource</span><span class="p">(</span><span class="s1">&#39;Geminga&#39;</span><span class="p">)</span>
    <span class="n">h</span> <span class="o">=</span> <span class="n">get_weight_hist</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>
    <span class="n">sf</span> <span class="o">=</span> <span class="n">_Sampler</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">sf</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>
    <span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">h</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
            <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;simulation with </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="si">}</span><span class="s1"> samples&#39;</span><span class="p">);</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">step</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">h</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([[</span><span class="n">h</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">h</span><span class="p">])</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">h</span><span class="p">)</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">h</span><span class="p">),</span>
           <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;data, source </span><span class="si">{</span><span class="n">source</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">);</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">prop</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">));</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Weight histogram for Geminga: Restoring from cache with key &#34;weight_hist_Geminga&#34;
</pre>
</div>
</div>

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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ZzvrWUTEHzUq6eYfKnY/7DsA0tzcxyU1T/369bnjjjt46KGH+NWvfnVO+cMPP0xERAQ//fQTa9eupU+fPnTu3JlOnTpRWFhI3759efXVV7nlllt44okn6N+/PytXOqaRmzNnDh999BHr1q3DGEOvXr1o3bo1DzzwAOBYSKJbt24sWrSIRYsWkZmZybZt26iN84iLSM2i7mU3Zs6cSVJSEjExMbRv354lS5YAMHHiROdKPjk5ORhjyM7OpmXLlsTFxfHnP/+Z1atXc8kllxAbG1thisHyx5Y//tSpU+e8/o4dO7juuuto2rQp8fHx/OY3v+HQoUMADBkyhLy8PG655Raio6N5+umnzzlXQUEBt956K02aNKFt27b85S9/qRDHHXfcwZ133ulcFN7V/NjgWAz+t7/9LeBYQ7dhw4Y89thjABQXFxMZGcnBgwcrvP748eNZvnw5I0aMIDo6ukIdfPbZZ1x00UXExcXx8MMPu102r3379gwbNoxOnTqdU3bs2DHef/99nnrqKaKjo+nRowe33norb7zxBgAffPABnTp1ol+/fkRGRjJx4kTWrVvHDz/8AMDrr7/O6NGjSU5OJikpidGjRzN37lwAtm7dyrfffsukSZOIiori9ttvJz09nffff99lnF9//TUZGRk0atSIFi1a8OijjzrL+vXrR0JCAo0bN+bqq69m48aNzrK7776bhx56iJtvvpno6GiuvPJK9uzZw6hRo4iLi+Piiy/mu+++c+6flpbG9OnT6dixI3FxcQwdOpSSkhKXMRUUFHD77bfTrFkzWrVqxYsvvuhTvCISfEq6LmzZsoXZs2ezevVqjhw5wuLFi0lLS3O7/6pVq9i2bRvvvvsuo0aNYurUqXz22Wds3LiR+fPnV2kyfcuyGDt2LAUFBWzevJndu3c7l+d74403SElJ4ZNPPuHo0aPOJFjewIEDSU5OpqCggAULFjBu3DjnBweAjz/+mAEDBnDo0CFuvfVWt/MP9+zZk6VLlwKwevVqEhISnO/nq6++on379sTFxVU4ZurUqVx11VXMnj2bo0ePVlg+79NPP2X16tWsW7eO+fPnV2k5v61btxIeHk67du2c284uZQiwceNGOnfu7Cxr2LAhbdq0cVte+djWrVsTExPjsryykSNHMnLkSIqKitixYwd33HGHs+zmm29m27Zt7N27ly5duvCb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
"
>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="_WeightGenerator" class="doc_header"><code>class</code> <code>_WeightGenerator</code><a href="https://github.com/tburnett/wtlike/tree/master/wtlike/simulation.py#L74" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>_WeightGenerator</code>(<strong><code>func</code></strong>, <strong><code>alpha</code></strong>=<em><code>0</code></em>, <strong><code>beta</code></strong>=<em><code>0</code></em>, <strong><code>n</code></strong>=<em><code>100</code></em>) :: <code>_Sampler</code></p>
</blockquote>
<p>Generate a set of weights</p>
<ul>
<li><code>func</code> -- nominal weight distribution function, evaluated on (0,1)</li>
<li><code>alpha, beta</code> -- (default 0,0). Values for $\alpha$, $\beta$.</li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Test">Test<a class="anchor-link" href="#Test"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span>      
<span class="n">wg</span> <span class="o">=</span> <span class="n">_WeightGenerator</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
<span class="n">test2</span> <span class="o">=</span> <span class="n">wg</span><span class="o">.</span><span class="n">mean</span><span class="p">,</span>  <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">wg</span><span class="p">(</span><span class="mi">1000</span><span class="p">))</span>
<span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span> <span class="n">test2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">test2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1e-1</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Not almost equal: </span><span class="si">{</span><span class="n">test2</span><span class="si">}</span><span class="s1">&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="generate_cell" class="doc_header"><code>generate_cell</code><a href="https://github.com/tburnett/wtlike/tree/master/wtlike/simulation.py#L91" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>generate_cell</code>(<strong><code>wfun</code></strong>, <strong><code>mu</code></strong>, <strong><code>alpha</code></strong>=<em><code>0</code></em>, <strong><code>beta</code></strong>=<em><code>0</code></em>)</p>
</blockquote>
<p>Generate a cell</p>
<ul>
<li><code>wfun</code> -- weight function, or histogram.
  Defined on (0,1)</li>
<li><code>mu</code> -- number of expected weights, on average</li>
<li><code>alpha</code>, <code>beta</code>  -- default 0,0; values for $\alpha$ and  $\beta$ for this cell</li>
</ul>
<p>Returns a dict with:</p>
<ul>
<li><code>n</code> -- actual generated number of weights, from Poisson</li>
<li><code>w</code> -- array of weights</li>
<li><code>S, B</code> -- expected values for $\sum w$ and $\sum(1-w)$, calulated from wfun</li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Test with a function peaked at both ends, generate equal signal and background</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary data-open="Hide Code" data-close="Show Code"></summary>
        <summary></summary>
        <div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">test_gen</span><span class="p">(</span><span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="n">wfun</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="mf">0.5</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.precision&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">quiet</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Test with alpha=</span><span class="si">{</span><span class="n">alpha</span><span class="si">}</span><span class="s1">, beta=</span><span class="si">{</span><span class="n">beta</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">cell</span> <span class="o">=</span> <span class="n">generate_cell</span><span class="p">(</span> <span class="n">wfun</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span>  <span class="n">alpha</span><span class="p">,</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">beta</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">beta</span><span class="p">)</span>
    <span class="c1">#</span>
    <span class="n">ll</span> <span class="o">=</span> <span class="n">LogLike</span><span class="p">(</span><span class="n">cell</span><span class="p">);</span> 
    <span class="k">if</span> <span class="ow">not</span> <span class="n">quiet</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Generated cell info:</span><span class="se">\n</span><span class="si">{</span> <span class="n">ll</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="n">fit</span> <span class="o">=</span> <span class="n">ll</span><span class="o">.</span><span class="n">fit_info</span><span class="p">(</span><span class="n">beta</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">quiet</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="mi">2</span> <span class="k">if</span> <span class="n">beta</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">1</span><span class="si">}</span><span class="s1">-D fit info:</span><span class="se">\n</span><span class="si">{</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">fit</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">t</span><span class="p">,</span> <span class="n">sigt</span> <span class="o">=</span> <span class="n">fit</span><span class="p">[</span><span class="s1">&#39;flux&#39;</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">alpha</span><span class="p">),</span>  <span class="n">fit</span><span class="p">[</span><span class="s1">&#39;sig_flux&#39;</span><span class="p">]</span>
    <span class="n">check_alpha</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span> <span class="k">if</span>  <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">&lt;</span><span class="n">tol</span><span class="o">*</span><span class="n">sigt</span> <span class="k">else</span> <span class="sa">f</span><span class="s1">&#39;alpha: abs(</span><span class="si">{</span><span class="n">t</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">) &gt; </span><span class="si">{</span><span class="n">tol</span><span class="si">}</span><span class="s1"> * </span><span class="si">{</span><span class="n">sigt</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span>

    <span class="k">if</span> <span class="n">beta</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="nb">bool</span><span class="p">(</span><span class="n">check_alpha</span><span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;Failed: </span><span class="si">{</span><span class="n">check_alpha</span><span class="si">}</span><span class="s1"> &#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">t</span><span class="p">,</span> <span class="n">sigt</span> <span class="o">=</span> <span class="n">fit</span><span class="p">[</span><span class="s1">&#39;beta&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">beta</span><span class="p">,</span> <span class="n">fit</span><span class="p">[</span><span class="s1">&#39;sig_beta&#39;</span><span class="p">]</span>
        <span class="n">check_beta</span> <span class="o">=</span><span class="s1">&#39;&#39;</span> <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">&lt;</span><span class="n">tol</span><span class="o">*</span><span class="n">sigt</span> <span class="k">else</span> <span class="sa">f</span><span class="s1">&#39;beta: abs(</span><span class="si">{</span><span class="n">t</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">) &gt; </span><span class="si">{</span><span class="n">tol</span><span class="si">}</span><span class="s1"> * </span><span class="si">{</span><span class="n">sigt</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span>

        <span class="k">assert</span> <span class="ow">not</span> <span class="p">(</span> <span class="nb">bool</span><span class="p">(</span><span class="n">check_alpha</span><span class="p">)</span>  <span class="ow">or</span> <span class="nb">bool</span><span class="p">(</span><span class="n">check_beta</span><span class="p">)),</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">check_alpha</span><span class="si">}</span><span class="s1">  </span><span class="si">{</span><span class="n">check_beta</span><span class="si">}</span><span class="s1">&#39;</span>
<span class="n">test_gen</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
<span class="n">test_gen</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
<span class="c1">#test_gen(10, 0, tol=5, quiet=False)</span>
<span class="n">test_gen</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">test_gen</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Test with alpha=0.1, beta=None
Generated cell info:
wtlike.loglike.LogLike:  10422 weights, S 4998.5, B 5001.5
1-D fit info:
counts      10422.000
flux            1.095
sig_flux        0.016
dtype: float64
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="simulate_cells" class="doc_header"><code>simulate_cells</code><a href="https://github.com/tburnett/wtlike/tree/master/wtlike/simulation.py#L128" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>simulate_cells</code>(<strong><code>config</code></strong>, <strong><code>source</code></strong>, <strong><code>wdist</code></strong>=<em><code>None</code></em>, <strong><code>source_flux</code></strong>=<em><code>&lt;lambda&gt;</code></em>)</p>
</blockquote>
<ul>
<li><code>source</code> -- a PointSource object, use to get exposure at its position and weight distribution</li>
<li><code>wdist</code>   -- a weight function or histogram; if None, get the source distribution</li>
<li><code>source_flux</code> -- function of MJD time for the counts/day; default 100/day</li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary data-open="Hide Code" data-close="Show Code"></summary>
        <summary></summary>
        <div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">simcells</span> <span class="o">=</span> <span class="n">pfits</span> <span class="o">=</span> <span class="kc">None</span>
<span class="k">def</span> <span class="nf">simulation_test</span><span class="p">(</span><span class="n">N</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">funstr</span><span class="o">=</span><span class="s1">&#39;(x-0.5)**2&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ### Test the cell creation</span>
<span class="sd">    </span>
<span class="sd">    Generate {N:,} cells with mu={mu}, alpha={alpha} using the function {funstr}</span>

<span class="sd">    The deviations from the expected norm divided by each cell&#39;s average error:</span>
<span class="sd">    {fig1}</span>
<span class="sd">    Mean and STD of this distribution: {m:.3f}, {sig:.3f}: for a generated Gaussian distribution these wouild be 0 and 1. </span>
<span class="sd">    </span>
<span class="sd">    A validation of the shape is to evaluate the cumulative probability of the over-all mean</span>
<span class="sd">    for each likelihood function. This uses the `poisson.Poisson.cdf` function.</span>
<span class="sd">    {fig2}</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">simcells</span><span class="p">,</span> <span class="n">pfits</span>

    <span class="n">wfun</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;lambda x: </span><span class="si">{</span><span class="n">funstr</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">simcells</span><span class="p">,</span> <span class="n">pfits</span> <span class="o">=</span>  <span class="n">local_sim_cells</span><span class="p">(</span><span class="n">wfun</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
    <span class="n">flux</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">p</span><span class="o">.</span><span class="n">flux</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">pfits</span><span class="p">]);</span> 
    <span class="n">fmean</span> <span class="o">=</span> <span class="mi">1</span><span class="o">+</span><span class="n">alpha</span>
    <span class="k">def</span> <span class="nf">pull</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
        <span class="n">f</span><span class="p">,</span> <span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>  <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">flux</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">errors</span>
        <span class="n">s</span> <span class="o">=</span> <span class="p">(</span><span class="n">h</span><span class="o">-</span><span class="n">l</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">f</span><span class="o">-</span><span class="n">fmean</span><span class="p">)</span><span class="o">/</span><span class="n">s</span>
    <span class="n">pulls</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">pull</span><span class="p">,</span> <span class="n">pfits</span><span class="p">)))</span>
    
    <span class="n">m</span><span class="p">,</span> <span class="n">sig</span> <span class="o">=</span> <span class="n">pulls</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">pulls</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;font&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
    <span class="n">fig1</span><span class="p">,</span><span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="n">num</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">pulls</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">21</span><span class="p">),</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span><span class="kc">None</span><span class="p">),</span> <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;pull&#39;</span><span class="p">);</span> 
    <span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">fig1</span><span class="o">.</span><span class="n">width</span><span class="o">=</span><span class="mi">300</span>

    <span class="k">class</span> <span class="nc">CDF</span><span class="p">():</span>
        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alpha</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="mi">1</span><span class="o">+</span><span class="n">alpha</span>
        <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">p</span><span class="o">.</span><span class="n">poiss</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">cdf</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">fmean</span><span class="o">=</span><span class="mf">1.1</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">p</span><span class="o">.</span><span class="n">poiss</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">fmean</span><span class="p">)</span>

    <span class="c1">#</span>
    <span class="n">cd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">CDF</span><span class="p">(</span><span class="n">alpha</span><span class="p">),</span> <span class="n">pfits</span><span class="p">)))</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="n">num</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">cd</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">21</span><span class="p">),</span> <span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;probability&#39;</span><span class="p">)</span>
                            
    <span class="n">fig2</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">locals</span><span class="p">()</span>

<span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">valid</span><span class="p">:</span>
    <span class="n">nbdoc</span><span class="p">(</span><span class="n">simulation_test</span><span class="p">,</span><span class="n">mu</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h3 id="Test-the-cell-creation">Test the cell creation<a class="anchor-link" href="#Test-the-cell-creation"> </a></h3><p>Generate 10,000 cells with mu=50, alpha=0 using the function (x-0.5)**2</p>
<p>The deviations from the expected norm divided by each cell's average error:</p>
<div class="nbdoc_image">
<figure style="margin-left: 5%" title="Figure 1">  <a href="images/simulation_test_fig_01.png" title="images/simulation_test_fig_01.png">    <img src="images/simulation_test_fig_01.png" alt="Figure 1 at images/simulation_test_fig_01.png" width=300>   </a> </figure>
</div><p>Mean and STD of this distribution: -0.093, 1.045: for a generated Gaussian distribution these wouild be 0 and 1.</p>
<p>A validation of the shape is to evaluate the cumulative probability of the over-all mean
for each likelihood function. This uses the <code>poisson.Poisson.cdf</code> function.</p>
<div class="nbdoc_image">
<figure style="margin-left: 5%" title="Figure 3">  <a href="images/simulation_test_fig_03.png" title="images/simulation_test_fig_03.png">    <img src="images/simulation_test_fig_03.png" alt="Figure 3 at images/simulation_test_fig_03.png" width=300>   </a> </figure>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Follow-on:-combine-the-cells-and-fit-the-result">Follow-on: combine the cells and fit the result<a class="anchor-link" href="#Follow-on:-combine-the-cells-and-fit-the-result"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary data-open="Hide Code" data-close="Show Code"></summary>
        <summary></summary>
        <div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cells</span><span class="o">=</span><span class="p">[]</span>
<span class="k">def</span> <span class="nf">simulation_lightcurve_demo</span><span class="p">(</span><span class="n">source_name</span><span class="o">=</span><span class="s1">&#39;Geminga&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ### Lightcurve generation test</span>
<span class="sd">    </span>
<span class="sd">    This uses the exposure measured for the source {source_name}, and</span>
<span class="sd">    the default time bins to create a light curve assuming a fixed flux</span>
<span class="sd">    and a histogram of weights from the data.</span>
<span class="sd">    {output}</span>
<span class="sd">    </span>
<span class="sd">    {fig}</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">cells</span>
    <span class="n">source</span> <span class="o">=</span> <span class="n">PointSource</span><span class="p">(</span><span class="s1">&#39;Geminga&#39;</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">capture_print</span><span class="p">(</span><span class="s1">&#39;Print out&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">output</span><span class="p">:</span>
        <span class="n">cells</span> <span class="o">=</span>  <span class="n">simulate_cells</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">source_flux</span><span class="o">=</span><span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="mi">100</span><span class="p">)</span>
        <span class="n">fits</span> <span class="o">=</span> <span class="n">fit_cells</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">cells</span><span class="p">)</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">flux_plot</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">fits</span><span class="p">),</span> <span class="n">width</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="nb">locals</span><span class="p">()</span>

<span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">valid</span><span class="p">:</span>
    <span class="n">nbdoc</span><span class="p">(</span><span class="n">simulation_lightcurve_demo</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h3 id="Lightcurve-generation-test">Lightcurve generation test<a class="anchor-link" href="#Lightcurve-generation-test"> </a></h3><p>This uses the exposure measured for the source Geminga, and
the default time bins to create a light curve assuming a fixed flux
and a histogram of weights from the data.</p>
<p><details  class="nbdoc-description" >  <summary> Print out </summary>  <div style="margin-left: 5%"><pre>binned exposure for source Geminga: Restoring from cache with key "binned_exposure_Geminga"<br>Weight histogram for Geminga: Restoring from cache with key "weight_hist_Geminga"<br>Loaded 3873 / 4015 cells with exposure &gt; 0.3 for fitting<br></pre></div> </details></p>
<div class="nbdoc_image">
<figure style="margin-left: 5%" title="Figure 1">  <a href="images/simulation_lightcurve_demo_fig_01.png" title="images/simulation_lightcurve_demo_fig_01.png">    <img src="images/simulation_lightcurve_demo_fig_01.png" alt="Figure 1 at images/simulation_lightcurve_demo_fig_01.png" width=500>   </a> </figure>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

