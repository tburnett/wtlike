---

title: Simulation

keywords: fastai
sidebar: home_sidebar

summary: "Generate simulated cells using the weighted likelihood"
description: "Generate simulated cells using the weighted likelihood"
nb_path: "nbs/10_simulation.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/10_simulation.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>For simulation the distribution of weights is required. That can be a histogram or a function, an input to the <code>_WeightGenerator</code> class. The class is a functor, with the argument a number on the range (0,1).  Passing an array of uniform random numbers then creates set of weights distributed according to the model represented by the input weight distribution.</p>
<p>To account for different levels of signal or background than that represented by the full dataset, the <code>_WeightGenerator</code> class accepts <code>alpha</code>($\alpha$) and <code>beta</code> ($\beta$) parameters, which will be used to weight the weight distribution  by a factor</p>
$$ \big(1 + \alpha\ w + \beta \ (1-w)\ \big), $$<p>where $w$ represents an array of weight values.</p>
<p>Generating a cell requires also the expected number of photons. If the average flux and exposure predict a number of events $\mu$, we select the actual number from the Poisson distribution.</p>
<p>This is done by <a href="wtlike/simulation#generate_cell"><code>generate_cell</code></a>, which creates a list of weights depending on $\alpha$, $\beta$, and $\mu$.</p>
<p>Finally, <a href="wtlike/simulation#simulate_cells"><code>simulate_cells</code></a> makes a list of cells, based on the actual exposure of a source.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="_Sampler" class="doc_header"><code>class</code> <code>_Sampler</code><a href="https://github.com/tburnett/wtlike/tree/master/wtlike/simulation.py#L20" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>_Sampler</code>(<strong><code>func</code></strong>, <strong><code>limits</code></strong>=<em><code>(0, 1)</code></em>, <strong><code>n</code></strong>=<em><code>100</code></em>)</p>
</blockquote>
<p>Sample an arbitrary function or histogram</p>
<ul>
<li>func -- a function, a histogram, or a fixed value<br>
  If a function, must be positive definite.<br>
  Assume histogram bins are 0 to 1.</li>
<li>a,b  -- limits (default 0,1)</li>
<li>n    -- table size (ignored if a histogram or value)</li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Gaussian-and-quadratic-example-functions">Gaussian and quadratic example functions<a class="anchor-link" href="#Gaussian-and-quadratic-example-functions"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary data-open="Hide Code" data-close="Show Code"></summary>
        <summary></summary>
        <div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">n</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">sf</span> <span class="o">=</span> <span class="n">_Sampler</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="n">limits</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="p">)</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">sf</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>
<span class="n">tests</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">mean</span><span class="p">()),</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">])</span>
<span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">tests</span><span class="o">&lt;</span><span class="mf">5e-2</span> <span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;Failed Tests: mean </span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">}</span><span class="s1">, std </span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span>

<span class="n">func</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span>
<span class="n">wfun</span> <span class="o">=</span> <span class="n">_Sampler</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>

<span class="n">test2</span> <span class="o">=</span> <span class="n">wfun</span><span class="o">.</span><span class="n">mean</span><span class="p">,</span>  <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">wfun</span><span class="p">(</span><span class="mi">1000</span><span class="p">))</span>
<span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span> <span class="n">test2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">test2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1e-1</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Not almost equal: </span><span class="si">{</span><span class="n">test2</span><span class="si">}</span><span class="s1">&#39;</span>
</pre></div>

    </div>
</div>
</div>

    </details>
</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Test-generating-weights-from-a-source-weight-histogram">Test generating weights from a source weight histogram<a class="anchor-link" href="#Test-generating-weights-from-a-source-weight-histogram"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary data-open="Hide Code" data-close="Show Code"></summary>
        <summary></summary>
        <div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#from wtlike.weights import *</span>
<span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">data_folder</span><span class="o">=</span><span class="s1">&#39;/home/burnett/weekly&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">valid</span><span class="p">:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;font&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">source</span> <span class="o">=</span> <span class="n">PointSource</span><span class="p">(</span><span class="s1">&#39;Geminga&#39;</span><span class="p">)</span>
    <span class="n">photon_data</span> <span class="o">=</span> <span class="n">SourceData</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>
    <span class="n">h</span> <span class="o">=</span> <span class="n">photon_data</span><span class="o">.</span><span class="n">weight_histogram</span><span class="p">()</span>
    <span class="n">sf</span> <span class="o">=</span> <span class="n">_Sampler</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">sf</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>
    <span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">h</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
            <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;simulation with </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="si">}</span><span class="s1"> samples&#39;</span><span class="p">);</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">step</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">h</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([[</span><span class="n">h</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">h</span><span class="p">])</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">h</span><span class="p">)</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">h</span><span class="p">),</span>
           <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;data, source </span><span class="si">{</span><span class="n">source</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">);</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">prop</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">));</span>
</pre></div>

    </div>
</div>
</div>

    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>photons and exposure for Geminga: Restoring from cache with key &#34;Geminga_weekly_data&#34;
Weight histogram for Geminga: Restoring from cache with key &#34;Geminga_weight_hist&#34;
</pre>
</div>
</div>

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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7uDBBx/kpz/9aa39Dz30EDExMfzwww9s3ryZgQMH0q1bN7p27UpJSQmDBw/m5Zdf5tZbb+W3v/0tQ4cOZf162zRwL730Eu+//z5btmzBGEO/fv1o164d999/P2BbSKJnz54sX76c5cuXk5OTw65du9BELyLiLTUvOzFv3jzS0tJISEigU6dOrFy5EoBp06bZV/LJz8/HGMOiRYto3bo1SUlJ/OEPf2Djxo1cccUVJCYmVpti8MJzLzz/zJkztZ5/z5493HDDDTRv3pzk5GR+/vOfU1paCsCoUaMoLCzk1ltvJT4+nieffLLWtYqLi7ntttto1qwZHTp04I9//GO1OO644w7uvPNO+6LwjubHBtti8L/85S8B2xq6jRs35pFHHgGgvLyc2NhYjhw5Uu35p0yZwtq1axk3bhzx8fHVyuDjjz/msssuIykpiYceesjpsnmdOnVizJgxdO3atda+EydO8M477/DEE08QHx9Pnz59uO2223jttdcAePfdd+natStDhgwhNjaWadOmsWXLFr799lsAXn31VSZOnEh6ejppaWlMnDiRxYsXA7Bz506++OILpk+fTlxcHLfffjtZWVm88847DuP87LPPyM7OpkmTJrRq1YqHH/73AlxDhgwhJSWFpk2bcu2117J9+3b7vrvvvpsHH3yQW265hfj4eHr37s3+/fuZMGECSUlJXH755Xz55Zf24zMzM5kzZw5dunQhKSmJ0aNHU1FR4TCm4uJibr/9dlq0aEHbtm15/vnnPYpXRPxPSdeBHTt2sGDBAjZu3MixY8dYsWIFmZmZTo/fsGEDu3bt4q233mLChAnMmjWLjz/+mO3bt7NkyZI6TaZvWRaPPvooxcXFfPPNN+zbt8++PN9rr71GmzZt+PDDDzl+/Lg9CV5o+PDhpKenU1xczNKlS5k8ebL9iwPABx98wLBhwygtLeW2225zOv9w3759Wb16NQAbN24kJSXF/nr++c9/0qlTJ5KSkqqdM2vWLK655hoWLFjA8ePHqy2f99FHH7Fx40a2bNnCkiVL6rSc386dO4mOjqZjx472beeXMgTYvn073br9e8nnxo0b0759e6f7a57brl07EhISHO6vafz48YwfP56ysjL27NnDHXfcYd93yy23sGvXLg4cOED37t35+c9/Xu3cJUuWMHPmTEpKSmjUqBE9e/ake/fulJSU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
"
>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="_WeightGenerator" class="doc_header"><code>class</code> <code>_WeightGenerator</code><a href="https://github.com/tburnett/wtlike/tree/master/wtlike/simulation.py#L73" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>_WeightGenerator</code>(<strong><code>func</code></strong>, <strong><code>alpha</code></strong>=<em><code>0</code></em>, <strong><code>beta</code></strong>=<em><code>0</code></em>, <strong><code>n</code></strong>=<em><code>100</code></em>) :: <code>_Sampler</code></p>
</blockquote>
<p>Generate a set of weights</p>
<ul>
<li><code>func</code> -- nominal weight distribution function, evaluated on (0,1)</li>
<li><code>alpha, beta</code> -- (default 0,0). Values for $\alpha$, $\beta$.</li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Test">Test<a class="anchor-link" href="#Test"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">wg</span> <span class="o">=</span> <span class="n">_WeightGenerator</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
<span class="n">test2</span> <span class="o">=</span> <span class="n">wg</span><span class="o">.</span><span class="n">mean</span><span class="p">,</span>  <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">wg</span><span class="p">(</span><span class="mi">1000</span><span class="p">))</span>
<span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span> <span class="n">test2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">test2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1e-1</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Not almost equal: </span><span class="si">{</span><span class="n">test2</span><span class="si">}</span><span class="s1">&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="generate_cell" class="doc_header"><code>generate_cell</code><a href="https://github.com/tburnett/wtlike/tree/master/wtlike/simulation.py#L89" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>generate_cell</code>(<strong><code>wfun</code></strong>, <strong><code>mu</code></strong>, <strong><code>alpha</code></strong>=<em><code>0</code></em>, <strong><code>beta</code></strong>=<em><code>0</code></em>)</p>
</blockquote>
<p>Generate a cell</p>
<ul>
<li><code>wfun</code> -- weight function, or histogram.
  Defined on (0,1)</li>
<li><code>mu</code> -- number of expected weights, on average</li>
<li><code>alpha</code>, <code>beta</code>  -- default 0,0; values for $\alpha$ and  $\beta$ for this cell</li>
</ul>
<p>Returns a dict with:</p>
<ul>
<li><code>n</code> -- actual generated number of weights, from Poisson</li>
<li><code>w</code> -- array of weights</li>
<li><code>S, B</code> -- expected values for $\sum w$ and $\sum(1-w)$, calulated from wfun</li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Test with a function peaked at both ends, generate equal signal and background</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary data-open="Hide Code" data-close="Show Code"></summary>
        <summary></summary>
        <div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">test_gen</span><span class="p">(</span><span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="n">wfun</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="mf">0.5</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.precision&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">quiet</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Test with alpha=</span><span class="si">{</span><span class="n">alpha</span><span class="si">}</span><span class="s1">, beta=</span><span class="si">{</span><span class="n">beta</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">cell</span> <span class="o">=</span> <span class="n">generate_cell</span><span class="p">(</span> <span class="n">wfun</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span>  <span class="n">alpha</span><span class="p">,</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">beta</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">beta</span><span class="p">)</span>
    <span class="c1">#</span>
    <span class="n">ll</span> <span class="o">=</span> <span class="n">LogLike</span><span class="p">(</span><span class="n">cell</span><span class="p">);</span> 
    <span class="k">if</span> <span class="ow">not</span> <span class="n">quiet</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Generated cell info:</span><span class="se">\n</span><span class="si">{</span> <span class="n">ll</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="n">fit</span> <span class="o">=</span> <span class="n">ll</span><span class="o">.</span><span class="n">fit_info</span><span class="p">(</span><span class="n">beta</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">quiet</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="mi">2</span> <span class="k">if</span> <span class="n">beta</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">1</span><span class="si">}</span><span class="s1">-D fit info:</span><span class="se">\n</span><span class="si">{</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">fit</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">t</span><span class="p">,</span> <span class="n">sigt</span> <span class="o">=</span> <span class="n">fit</span><span class="p">[</span><span class="s1">&#39;flux&#39;</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">alpha</span><span class="p">),</span>  <span class="n">fit</span><span class="p">[</span><span class="s1">&#39;sig_flux&#39;</span><span class="p">]</span>
    <span class="n">check_alpha</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span> <span class="k">if</span>  <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">&lt;</span><span class="n">tol</span><span class="o">*</span><span class="n">sigt</span> <span class="k">else</span> <span class="sa">f</span><span class="s1">&#39;alpha: abs(</span><span class="si">{</span><span class="n">t</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">) &gt; </span><span class="si">{</span><span class="n">tol</span><span class="si">}</span><span class="s1"> * </span><span class="si">{</span><span class="n">sigt</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span>

    <span class="k">if</span> <span class="n">beta</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="nb">bool</span><span class="p">(</span><span class="n">check_alpha</span><span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;Failed: </span><span class="si">{</span><span class="n">check_alpha</span><span class="si">}</span><span class="s1"> &#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">t</span><span class="p">,</span> <span class="n">sigt</span> <span class="o">=</span> <span class="n">fit</span><span class="p">[</span><span class="s1">&#39;beta&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">beta</span><span class="p">,</span> <span class="n">fit</span><span class="p">[</span><span class="s1">&#39;sig_beta&#39;</span><span class="p">]</span>
        <span class="n">check_beta</span> <span class="o">=</span><span class="s1">&#39;&#39;</span> <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">&lt;</span><span class="n">tol</span><span class="o">*</span><span class="n">sigt</span> <span class="k">else</span> <span class="sa">f</span><span class="s1">&#39;beta: abs(</span><span class="si">{</span><span class="n">t</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">) &gt; </span><span class="si">{</span><span class="n">tol</span><span class="si">}</span><span class="s1"> * </span><span class="si">{</span><span class="n">sigt</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span>

        <span class="k">assert</span> <span class="ow">not</span> <span class="p">(</span> <span class="nb">bool</span><span class="p">(</span><span class="n">check_alpha</span><span class="p">)</span>  <span class="ow">or</span> <span class="nb">bool</span><span class="p">(</span><span class="n">check_beta</span><span class="p">)),</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">check_alpha</span><span class="si">}</span><span class="s1">  </span><span class="si">{</span><span class="n">check_beta</span><span class="si">}</span><span class="s1">&#39;</span>
<span class="n">test_gen</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
<span class="n">test_gen</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
<span class="c1">#test_gen(10, 0, tol=5, quiet=False)</span>
<span class="n">test_gen</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">test_gen</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Test with alpha=0.1, beta=None
Generated cell info:
wtlike.loglike.LogLike:  10484 weights, S 4998.5, B 5001.5
1-D fit info:
counts      10484.000
flux            1.101
sig_flux        0.017
dtype: float64
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="simulate_cells" class="doc_header"><code>simulate_cells</code><a href="https://github.com/tburnett/wtlike/tree/master/wtlike/simulation.py#L126" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>simulate_cells</code>(<strong><code>source_data</code></strong>, <strong><code>wdist</code></strong>=<em><code>None</code></em>, <strong><code>source_flux</code></strong>=<em><code>'&lt;lambda&gt;'</code></em>)</p>
</blockquote>
<ul>
<li><a href="wtlike/source_data"><code>source_data</code></a> -- a SourceData object, use to get exposure at its position and weight distribution</li>
<li><code>wdist</code>   -- a weight function or histogram; if None, get the source distribution</li>
<li><code>source_flux</code> -- function of MJD time for the counts/day; default 100/day</li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary data-open="Hide Code" data-close="Show Code"></summary>
        <summary></summary>
        <div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">simcells</span> <span class="o">=</span> <span class="n">pfits</span> <span class="o">=</span> <span class="kc">None</span>

<span class="k">def</span> <span class="nf">local_sim_cells</span><span class="p">(</span><span class="n">wfun</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">N</span><span class="p">):</span>
    <span class="n">sims</span> <span class="o">=</span> <span class="p">[</span><span class="n">generate_cell</span><span class="p">(</span> <span class="n">wfun</span><span class="p">,</span> <span class="n">mu</span> <span class="p">,</span><span class="n">alpha</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)]</span>
    <span class="n">fits</span> <span class="o">=</span> <span class="p">[</span><span class="n">PoissonRep</span><span class="p">(</span><span class="n">LogLike</span><span class="p">(</span><span class="n">cell</span> <span class="p">))</span> <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">sims</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">sims</span><span class="p">,</span> <span class="n">fits</span>

<span class="k">def</span> <span class="nf">simulation_test</span><span class="p">(</span><span class="n">N</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">funstr</span><span class="o">=</span><span class="s1">&#39;(x-0.5)**2&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ### Test the cell creation</span>
<span class="sd">    </span>
<span class="sd">    Generate {N:,} cells with mu={mu}, alpha={alpha} using the function {funstr}</span>

<span class="sd">    The deviations from the expected norm divided by each cell&#39;s average error:</span>
<span class="sd">    {fig1}</span>
<span class="sd">    Mean and STD of this distribution: {m:.3f}, {sig:.3f}: for a generated Gaussian distribution these wouild be 0 and 1. </span>
<span class="sd">    </span>
<span class="sd">    A validation of the shape is to evaluate the cumulative probability of the over-all mean</span>
<span class="sd">    for each likelihood function. This uses the `poisson.Poisson.cdf` function.</span>
<span class="sd">    {fig2}</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">simcells</span><span class="p">,</span> <span class="n">pfits</span>

    <span class="n">wfun</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;lambda x: </span><span class="si">{</span><span class="n">funstr</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">simcells</span><span class="p">,</span> <span class="n">pfits</span> <span class="o">=</span>  <span class="n">local_sim_cells</span><span class="p">(</span><span class="n">wfun</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
    <span class="n">flux</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">p</span><span class="o">.</span><span class="n">flux</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">pfits</span><span class="p">]);</span> 
    <span class="n">fmean</span> <span class="o">=</span> <span class="mi">1</span><span class="o">+</span><span class="n">alpha</span>
    <span class="k">def</span> <span class="nf">pull</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
        <span class="n">f</span><span class="p">,</span> <span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>  <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">flux</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">errors</span>
        <span class="n">s</span> <span class="o">=</span> <span class="p">(</span><span class="n">h</span><span class="o">-</span><span class="n">l</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">f</span><span class="o">-</span><span class="n">fmean</span><span class="p">)</span><span class="o">/</span><span class="n">s</span>
    <span class="n">pulls</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">pull</span><span class="p">,</span> <span class="n">pfits</span><span class="p">)))</span>
    
    <span class="n">m</span><span class="p">,</span> <span class="n">sig</span> <span class="o">=</span> <span class="n">pulls</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">pulls</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;font&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
    <span class="n">fig1</span><span class="p">,</span><span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="n">num</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">pulls</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">21</span><span class="p">),</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span><span class="kc">None</span><span class="p">),</span> <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;pull&#39;</span><span class="p">);</span> 
    <span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">fig1</span><span class="o">.</span><span class="n">width</span><span class="o">=</span><span class="mi">300</span>

    <span class="k">class</span> <span class="nc">CDF</span><span class="p">():</span>
        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alpha</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="mi">1</span><span class="o">+</span><span class="n">alpha</span>
        <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">p</span><span class="o">.</span><span class="n">poiss</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">cdf</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">fmean</span><span class="o">=</span><span class="mf">1.1</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">p</span><span class="o">.</span><span class="n">poiss</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">fmean</span><span class="p">)</span>

    <span class="c1">#</span>
    <span class="n">cd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">CDF</span><span class="p">(</span><span class="n">alpha</span><span class="p">),</span> <span class="n">pfits</span><span class="p">)))</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="n">num</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">cd</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">21</span><span class="p">),</span> <span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;probability&#39;</span><span class="p">)</span>
                            
    <span class="n">fig2</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">locals</span><span class="p">()</span>

<span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">valid</span><span class="p">:</span>
    <span class="n">nbdoc</span><span class="p">(</span><span class="n">simulation_test</span><span class="p">,</span><span class="n">mu</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h3 id="Test-the-cell-creation">Test the cell creation<a class="anchor-link" href="#Test-the-cell-creation"> </a></h3><p>Generate 10,000 cells with mu=50, alpha=0 using the function (x-0.5)**2</p>
<p>The deviations from the expected norm divided by each cell's average error:</p>
<div class="nbdoc_image">
<figure style="margin-left: 5%" title="Figure 1">  <a href="images/simulation_test_fig_01.png" title="images/simulation_test_fig_01.png">    <img src="images/simulation_test_fig_01.png" alt="Figure 1 at images/simulation_test_fig_01.png" width=300>   </a> </figure>
</div><p>Mean and STD of this distribution: -0.092, 1.043: for a generated Gaussian distribution these wouild be 0 and 1.</p>
<p>A validation of the shape is to evaluate the cumulative probability of the over-all mean
for each likelihood function. This uses the <code>poisson.Poisson.cdf</code> function.</p>
<div class="nbdoc_image">
<figure style="margin-left: 5%" title="Figure 3">  <a href="images/simulation_test_fig_03.png" title="images/simulation_test_fig_03.png">    <img src="images/simulation_test_fig_03.png" alt="Figure 3 at images/simulation_test_fig_03.png" width=300>   </a> </figure>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Follow-on:-combine-the-cells-and-fit-the-result">Follow-on: combine the cells and fit the result<a class="anchor-link" href="#Follow-on:-combine-the-cells-and-fit-the-result"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary data-open="Hide Code" data-close="Show Code"></summary>
        <summary></summary>
        <div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cells</span><span class="o">=</span><span class="p">[]</span>
<span class="k">def</span> <span class="nf">simulation_lightcurve_demo</span><span class="p">(</span><span class="n">source_data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ### Lightcurve generation test</span>
<span class="sd">    </span>
<span class="sd">    This uses the exposure measured for the source {source_name}, and</span>
<span class="sd">    the default time bins to create a light curve assuming a fixed flux</span>
<span class="sd">    and a histogram of weights from the data.</span>
<span class="sd">    {output}</span>
<span class="sd">    </span>
<span class="sd">    {fig}</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">cells</span>
    
    <span class="k">with</span> <span class="n">capture_print</span><span class="p">(</span><span class="s1">&#39;Print out&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">output</span><span class="p">:</span>
        <span class="n">cells</span> <span class="o">=</span>  <span class="n">simulate_cells</span><span class="p">(</span><span class="n">source_data</span><span class="p">,</span> <span class="n">source_flux</span><span class="o">=</span><span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="mi">100</span><span class="p">)</span>
        <span class="n">fits</span> <span class="o">=</span>  <span class="n">fit_cells</span><span class="p">(</span><span class="n">source_data</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="n">cells</span><span class="p">)</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">flux_plot</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">fits</span><span class="p">),</span> <span class="n">width</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="nb">locals</span><span class="p">()</span>

<span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">valid</span><span class="p">:</span>
    <span class="n">nbdoc</span><span class="p">(</span><span class="n">simulation_lightcurve_demo</span><span class="p">,</span> <span class="n">SourceData</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">PointSource</span><span class="p">(</span><span class="s1">&#39;Geminga&#39;</span><span class="p">)))</span>
</pre></div>

    </div>
</div>
</div>

    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>photons and exposure for Geminga: Restoring from cache with key &#34;Geminga_weekly_data&#34;
</pre>
</div>
</div>

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h3 id="Lightcurve-generation-test">Lightcurve generation test<a class="anchor-link" href="#Lightcurve-generation-test"> </a></h3><p>This uses the exposure measured for the source {source_name}, and
the default time bins to create a light curve assuming a fixed flux
and a histogram of weights from the data.</p>
<p><details  class="nbdoc-description" >  <summary> Print out </summary>  <div style="margin-left: 5%"><pre>Time bins: 4643 intervals of 1 days, from MJD 54683.0(2008-08-05) to 59326.0(2021-04-22))<br>Relative exposure per bin:<br>count    4643.000<br>mean        1.000<br>std         0.353<br>min         0.000<br>50%         0.993<br>max         3.664<br>dtype: float64<br>Weight histogram for Geminga: Restoring from cache with key "Geminga_weight_hist"<br>Loaded 4443 / 4643 cells with exposure &gt; 0.3 for fitting<br></pre></div> </details></p>
<div class="nbdoc_image">
<figure style="margin-left: 5%" title="Figure 1">  <a href="images/simulation_lightcurve_demo_fig_01.png" title="images/simulation_lightcurve_demo_fig_01.png">    <img src="images/simulation_lightcurve_demo_fig_01.png" alt="Figure 1 at images/simulation_lightcurve_demo_fig_01.png" width=500>   </a> </figure>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

