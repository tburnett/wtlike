---

title: Simulation

keywords: fastai
sidebar: home_sidebar

summary: "Generate simulated cells using the weighted likelihood"
description: "Generate simulated cells using the weighted likelihood"
nb_path: "nbs/10_simulation.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/10_simulation.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>For simulation the distribution of weights is required. That can be a histogram or a function, an input to the <code>_WeightGenerator</code> class. The class is a functor, with the argument a number on the range (0,1).  Passing an array of uniform random numbers then creates set of weights distributed according to the model represented by the input weight distribution.</p>
<p>To account for different levels of signal or background than that represented by the full dataset, the <code>_WeightGenerator</code> class accepts <code>alpha</code>($\alpha$) and <code>beta</code> ($\beta$) parameters, which will be used to weight the weight distribution  by a factor
$$ 1 + \alpha\ w + \beta \ (1-w) $$ where $w$ represents the array of weight values.</p>
<p>Generating a cell requires also the expected number of photons. If the average flux and exposure predict a number of events $\mu$, we select the actual number from the Poisson distribution.</p>
<p>This is done by <a href="/wtlikesimulation#generate_cell"><code>generate_cell</code></a>, which creates a list of weights depending on $\alpha$, $\beta$, and $\mu$.</p>
<p>Finally, <code>simulate_cells</code> makes a list of cells, based on the actual exposure of a source.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="_Sampler" class="doc_header"><code>class</code> <code>_Sampler</code><a href="https://github.com/tburnett/wtlike/tree/master/wtlike/simulation.py#L20" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>_Sampler</code>(<strong><code>func</code></strong>, <strong><code>limits</code></strong>=<em><code>(0, 1)</code></em>, <strong><code>n</code></strong>=<em><code>100</code></em>)</p>
</blockquote>
<p>Sample an arbitrary function or histogram</p>
<ul>
<li>func -- a function, a histogram, or a fixed value<br>
  If a function, must be positive definite.<br>
  Assume histogram bins are 0 to 1.</li>
<li>a,b  -- limits (default 0,1)</li>
<li>n    -- table size (ignored if a histogram or value)</li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Gaussian-and-quadratic-example-functions">Gaussian and quadratic example functions<a class="anchor-link" href="#Gaussian-and-quadratic-example-functions"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary data-open="Hide Code" data-close="Show Code"></summary>
        <summary></summary>
        <div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">n</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">sf</span> <span class="o">=</span> <span class="n">_Sampler</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="n">limits</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="p">)</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">sf</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>
<span class="n">tests</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">mean</span><span class="p">()),</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">])</span>
<span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">tests</span><span class="o">&lt;</span><span class="mf">5e-2</span> <span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;Failed Tests: mean </span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">}</span><span class="s1">, std </span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span>

<span class="n">func</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span>
<span class="n">wfun</span> <span class="o">=</span> <span class="n">_Sampler</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>

<span class="n">test2</span> <span class="o">=</span> <span class="n">wfun</span><span class="o">.</span><span class="n">mean</span><span class="p">,</span>  <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">wfun</span><span class="p">(</span><span class="mi">1000</span><span class="p">))</span>
<span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span> <span class="n">test2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">test2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1e-1</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Not almost equal: </span><span class="si">{</span><span class="n">test2</span><span class="si">}</span><span class="s1">&#39;</span>
</pre></div>

    </div>
</div>
</div>

    </details>
</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Test-generating-weights-from-a-source-weight-histogram">Test generating weights from a source weight histogram<a class="anchor-link" href="#Test-generating-weights-from-a-source-weight-histogram"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary data-open="Hide Code" data-close="Show Code"></summary>
        <summary></summary>
        <div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">if</span> <span class="n">Config</span><span class="p">()</span><span class="o">.</span><span class="n">valid</span><span class="p">:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;font&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">photon_data</span> <span class="o">=</span> <span class="n">SourceData</span><span class="p">(</span><span class="s1">&#39;Geminga&#39;</span><span class="p">)</span>
    <span class="n">h</span> <span class="o">=</span> <span class="n">photon_data</span><span class="o">.</span><span class="n">weight_histogram</span><span class="p">()</span>
    <span class="n">sf</span> <span class="o">=</span> <span class="n">_Sampler</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">sf</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>
    <span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">h</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
            <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;simulation with </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="si">}</span><span class="s1"> samples&#39;</span><span class="p">);</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">step</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">h</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([[</span><span class="n">h</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">h</span><span class="p">])</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">h</span><span class="p">)</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">h</span><span class="p">),</span>
           <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;data, source </span><span class="si">{</span><span class="n">photon_data</span><span class="o">.</span><span class="n">source</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">);</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">prop</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">));</span>
</pre></div>

    </div>
</div>
</div>

    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>photons and exposure for Geminga: Restoring from cache with key &#34;Geminga__data&#34;
SourceData: Source Geminga with:
	 data:     1,211,364 photons from   2008-08-04 to 2021-04-28
	 exposure: 3,112,161 intervals from 2008-08-04 to 2021-04-28
Weight histogram for Geminga: Restoring from cache with key &#34;Geminga_weight_hist&#34;
</pre>
</div>
</div>

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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Y8eOrFq1ipYtW/LNN99wxx13sG/fPk455RSX9qlSSlVEa9AeWLduHbm5uYwcOZKgoCAGDRrEueee65jfpEkTbrzxRurVq0d4eDjjxo1jxYoV5a7zjjvuoEmTJtSpU4dRo0aRnZ3N7t27K4wlMDCQ7Oxs/vrrL3Jzc2nfvj0dO3YE4IsvvmD8+PE0b96cZs2aMWHCBD7//HOXP+fAgQO58MILCQgIIDg4mI8//pj//e9/REZGEhgYSO/evalbty6zZs2if//+9O/fn4CAAPr160fPnj1ZtGhRqXUmJCTQtGlT6tQpPEYsqHmHhoaycuVKjDF8+OGHvP766zRu3Jjw8HCefvppZs+e7VgmKCiIcePGERQUxC233EJCQgIjRowgPDycbt260a1bN7Zt21bmZ5swYQKhoaH06NGDHj16sHXrVgDmzJnD008/TUREBK1bt+axx4oPaX7TTTfRqlUrAgICGDx4MKeddhobNmxweZ8qpVRFql8N2oWa7ckSFxdHZGRksftB27Vr53idkZHB448/zs8//8yJE1Z35KmpqdhsNgIDA52uc9q0acyYMYO4uDhEhJSUFBISEiqMpVOnTrzxxhtMnDiRqKgorrzySl577TVatWpFXFxcsbjatWtHXFycy5+zTZs2jtcJCQlkZWU5kn9RBw8e5JtvvmHhwoWOabm5uVx66aWlyjZp0oSEhATy8vIcSfr3338HoHXr1uTn53Ps2DEyMjI455xzHMsZY4pdB2/SpIljXxZ0aNOiRQvH/NDQUNLSyu5ptmXLlo7X9erVc5SNi4sr9rmLvgb47LPPeO2114iOjgYgLS3Npb+TUkq5SmvQHjjllFOIjY0t1uI4JibG8XratGns3r2b9evXk5KSwsqVKwEc5Ut29LBq1SqmTp3KnDlzOHHiBElJSTRs2NDlFs233XYbq1ev5uDBg4iI41R7q1atOHjwYLEYW7VqBVgDHmRkZDjmHTlypNR6i8bZtGlTQkJC2L9/f6lybdq0YciQISQlJTke6enpjBkzplTZXr16UbduXebPn1/m52natCmhoaFERUU51pecnFxuwvWWU045xdFeAODQocL+dg4ePMh9993H9OnTOX78OElJSfzf//1flbQ8V0rVXpqgPdCrVy/q1KnDm2++SV5eHt9++22x05ypqamEhobSqFEjEhMTee6554ot36JFCw4cOFCsfJ06dWjWrBl5eXk8//zzpKQU9pCzfPnyMntv2r17N7/99hvZ2dmEhIQQGhrqqFneeuutvPjiixw7doyEhASef/55R2OpHj16EBUVxZYtW8jKymLixInlfuaAgACGDh3KE088QVxcHDabzXE9+Y477mDhwoUsXrwYm81GVlYWy5cvL5boCjRq1IgJEybw8MMPM3fuXNLS0sjPz2fLli2kp6c7tnXffffx+OOPEx8fD0BsbCyLFy8uN0ZvuPnmm5kyZQonTpwgNjaW6dOnO+alp6cjIo7r6p988gk7duyo8piUUrWLJmgPBAcH8+233zJz5kwiIiL4+uuvueGGGxzzR44cSWZmJk2bNuWCCy7gqquuKrb8iBEjmDt3LhERETz22GNceeWVXH311XTu3Jl27doREhJS7NTqoUOH6NWrl9NYsrOzGTNmDE2bNqVly5bEx8c7WjA/88wz9OzZkzPPPJPu3btz9tlnOzpT6dy5M+PHj+fyyy/ntNNOK9Wi25lXX32V7t27c+6559K4cWNGjx5Nfn4+bdq0Yf78+UyePJlmzZrRpk0bXnnlFfLz852u56mnnuK1115ztMJu0aIFDzzwAFOnTqV3796A1TK9U6dOXHDBBTRo0IDLL7/cpWvynho/fjytW7emQ4cOXH755QwaNMjRsrxr166MGjWKXr160aJFC7Zv386FF15Y5TEppWoX8ZfTcj179jSbNm0qNX3nzp2cccYZPojI/wwbNoybbrqJK6+80teh1Drvvvsus2fPrrCRX22j/5/KpyY2tJ5HbodGbX0bSyWJyB/GmJ7O5mkNuhqZMWOGJueT5J9//mHNmjXk5+eze/dupk2bxvXXX+/rsJRS7sq3QfxO67ma0QStlBM5OTk88MADhIeHc9lllzFw4EAefvhhX4ellHLXpo/hnQus52qm+t1mpdRJ0K5dO234pVRNkJ5Q/Lka0Rq0Ukop5Yc0QSullFJ+SBO0UkqpGi89J4/2Y34k5nhGxYX9hCZopZRSNV5mjtWKOz41q4KS/kMTtFJKKeWHNEFXkcmTJxcbRtKbLrnkEmbMmFGpZWNiYggLCys24MTJ5Mr2i45HrbynYPxspVT1UC1vs7rwpd+ITcqssvVHNgplzZjLPFrH008/7aVoPNO+fXtmzJjB5ZdfDkDbtm1PymATZSm5/UsuuaTUmNju2LFjB6NGjeKPP/7g+PHjpQasSExM5N577+WXX36hadOmTJkyhdtuu80xf+nSpTzyyCPExMRw/vnnM3PmTMfIX8YYxowZ4zgYuvfee5k6daqjP/To6Gjuuece1q9fT9u2bZk+fbpjPyul/EtATgqDA5dRJ6sL0NjX4bikWibo2KRMol+6psrW337Mj1W2buVdQUFB3HzzzTz88MP85z//KTX/kUceITg4mKNHj7JlyxauueYaevToQbdu3UhISOCGG25gxowZXHfddTz77LMMHjyYdevWAfDBBx/w/fffs3XrVkSEfv36ceqpp/Lggw8C1iAkvXr1YtGiRSxatIhBgwaxd+9exyAaSinfM8YgQIO93zM16Dhxf9WF0yf5OiyX6CluD02dOpXIyEjCw8Pp0qULS5cuBWDixImOEaOio6MRET755BPatGlDREQE7733Hhs3buTMM8+kUaNGDB8+3LHOossWXT4vL6/U9vfv389ll11GkyZNaNq0KbfffjtJSUkADBkyhJiYGK677jrCwsJ4+eWXS60rLi6OAQMG0LhxYzp16sSHH35YLI6bb76ZO++8k/DwcLp164az/tIBJkyYwKOPPgpYY0DXr1+fp556CoDMzExCQkI4ceJEse2PGzeOVatWMXz4cMLCwortgyVLlnDaaacRERHBI488UuZQjl26dOHee++lW7dupealp6czb948XnjhBcLCwujTpw8DBgzg888/B+Dbb7+lW7du3HTTTYSEhDBx4kS2bt3Krl27APj0008ZNWoUrVu3JjIyklGjRjFz5kwA9uzZw59//slzzz1HaGgoN954I927d2fevHlO49ywYQM9e/akQYMGtGjRgieeeMIx76abbqJly5Y0bNiQiy++mKioKMe8u+++m4cffpirr76asLAwLrzwQo4cOcLIkSOJiIjg9NNPZ/PmzY7y7du3Z8qUKXTt2pWIiAjuuecesrKcN4qJi4vjxhtvpFmzZnTo0IE333zTpXiVqk7iU7MBMHnWc2CetuKuFXbv3s306dPZuHEjqampLF68mPbt25dZfv369ezdu5evv/6akSNHMmnSJJYsWUJUVBRz5syp1EAMxhjGjh1LXFwcO3fu5NChQ44hIz///HPatm3LwoULSUtLcyTMom699VZat25NXFwcc+fO5emnn3YcZAAsWLCAW265haSkJAYM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
"
>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="_WeightGenerator" class="doc_header"><code>class</code> <code>_WeightGenerator</code><a href="https://github.com/tburnett/wtlike/tree/master/wtlike/simulation.py#L73" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>_WeightGenerator</code>(<strong><code>func</code></strong>, <strong><code>alpha</code></strong>=<em><code>0</code></em>, <strong><code>beta</code></strong>=<em><code>0</code></em>, <strong><code>n</code></strong>=<em><code>100</code></em>) :: <code>_Sampler</code></p>
</blockquote>
<p>Generate a set of weights</p>
<ul>
<li><code>func</code> -- nominal weight distribution function, evaluated on (0,1)</li>
<li><code>alpha, beta</code> -- (default 0,0). Values for $\alpha$, $\beta$.</li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Test">Test<a class="anchor-link" href="#Test"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">wg</span> <span class="o">=</span> <span class="n">_WeightGenerator</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
<span class="n">test2</span> <span class="o">=</span> <span class="n">wg</span><span class="o">.</span><span class="n">mean</span><span class="p">,</span>  <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">wg</span><span class="p">(</span><span class="mi">1000</span><span class="p">))</span>
<span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span> <span class="n">test2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">test2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1e-1</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Not almost equal: </span><span class="si">{</span><span class="n">test2</span><span class="si">}</span><span class="s1">&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="generate_cell" class="doc_header"><code>generate_cell</code><a href="https://github.com/tburnett/wtlike/tree/master/wtlike/simulation.py#L89" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>generate_cell</code>(<strong><code>wfun</code></strong>, <strong><code>mu</code></strong>, <strong><code>alpha</code></strong>=<em><code>0</code></em>, <strong><code>beta</code></strong>=<em><code>0</code></em>)</p>
</blockquote>
<p>Generate a cell</p>
<ul>
<li><code>wfun</code> -- weight function, or histogram.
  Defined on (0,1)</li>
<li><code>mu</code> -- number of expected weights, on average</li>
<li><code>alpha</code>, <code>beta</code>  -- default 0,0; values for $\alpha$ and  $\beta$ for this cell</li>
</ul>
<p>Returns a dict with:</p>
<ul>
<li><code>n</code> -- actual generated number of weights, from Poisson</li>
<li><code>w</code> -- array of weights</li>
<li><code>S, B</code> -- expected values for $\sum w$ and $\sum(1-w)$, calulated from wfun</li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Test with a function peaked at both ends, generate equal signal and background</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary data-open="Hide Code" data-close="Show Code"></summary>
        <summary></summary>
        <div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">test_gen</span><span class="p">(</span><span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="n">wfun</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="mf">0.5</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.precision&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">quiet</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Test with alpha=</span><span class="si">{</span><span class="n">alpha</span><span class="si">}</span><span class="s1">, beta=</span><span class="si">{</span><span class="n">beta</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">cell</span> <span class="o">=</span> <span class="n">generate_cell</span><span class="p">(</span> <span class="n">wfun</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span>  <span class="n">alpha</span><span class="p">,</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">beta</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">beta</span><span class="p">)</span>
    <span class="c1">#</span>
    <span class="n">ll</span> <span class="o">=</span> <span class="n">LogLike</span><span class="p">(</span><span class="n">cell</span><span class="p">);</span> 
    <span class="k">if</span> <span class="ow">not</span> <span class="n">quiet</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Generated cell info:</span><span class="se">\n</span><span class="si">{</span> <span class="n">ll</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="n">fit</span> <span class="o">=</span> <span class="n">ll</span><span class="o">.</span><span class="n">fit_info</span><span class="p">(</span><span class="n">beta</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">quiet</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="mi">2</span> <span class="k">if</span> <span class="n">beta</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">1</span><span class="si">}</span><span class="s1">-D fit info:</span><span class="se">\n</span><span class="si">{</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">fit</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">t</span><span class="p">,</span> <span class="n">sigt</span> <span class="o">=</span> <span class="n">fit</span><span class="p">[</span><span class="s1">&#39;flux&#39;</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">alpha</span><span class="p">),</span>  <span class="n">fit</span><span class="p">[</span><span class="s1">&#39;sig_flux&#39;</span><span class="p">]</span>
    <span class="n">check_alpha</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span> <span class="k">if</span>  <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">&lt;</span><span class="n">tol</span><span class="o">*</span><span class="n">sigt</span> <span class="k">else</span> <span class="sa">f</span><span class="s1">&#39;alpha: abs(</span><span class="si">{</span><span class="n">t</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">) &gt; </span><span class="si">{</span><span class="n">tol</span><span class="si">}</span><span class="s1"> * </span><span class="si">{</span><span class="n">sigt</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span>

    <span class="k">if</span> <span class="n">beta</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="nb">bool</span><span class="p">(</span><span class="n">check_alpha</span><span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;Failed: </span><span class="si">{</span><span class="n">check_alpha</span><span class="si">}</span><span class="s1"> &#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">t</span><span class="p">,</span> <span class="n">sigt</span> <span class="o">=</span> <span class="n">fit</span><span class="p">[</span><span class="s1">&#39;beta&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">beta</span><span class="p">,</span> <span class="n">fit</span><span class="p">[</span><span class="s1">&#39;sig_beta&#39;</span><span class="p">]</span>
        <span class="n">check_beta</span> <span class="o">=</span><span class="s1">&#39;&#39;</span> <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">&lt;</span><span class="n">tol</span><span class="o">*</span><span class="n">sigt</span> <span class="k">else</span> <span class="sa">f</span><span class="s1">&#39;beta: abs(</span><span class="si">{</span><span class="n">t</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">) &gt; </span><span class="si">{</span><span class="n">tol</span><span class="si">}</span><span class="s1"> * </span><span class="si">{</span><span class="n">sigt</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span>

        <span class="k">assert</span> <span class="ow">not</span> <span class="p">(</span> <span class="nb">bool</span><span class="p">(</span><span class="n">check_alpha</span><span class="p">)</span>  <span class="ow">or</span> <span class="nb">bool</span><span class="p">(</span><span class="n">check_beta</span><span class="p">)),</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">check_alpha</span><span class="si">}</span><span class="s1">  </span><span class="si">{</span><span class="n">check_beta</span><span class="si">}</span><span class="s1">&#39;</span>
<span class="n">test_gen</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
<span class="n">test_gen</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
<span class="c1">#test_gen(10, 0, tol=5, quiet=False)</span>
<span class="n">test_gen</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">test_gen</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Test with alpha=0.1, beta=None
Generated cell info:
wtlike.loglike.LogLike:  10392 weights, S 4998.5, B 5001.5
1-D fit info:
counts      10392.000
flux            1.087
sig_flux        0.016
dtype: float64
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary data-open="Hide Code" data-close="Show Code"></summary>
        <summary></summary>
        <div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">simcells</span> <span class="o">=</span> <span class="n">pfits</span> <span class="o">=</span> <span class="kc">None</span>

<span class="k">def</span> <span class="nf">local_sim_cells</span><span class="p">(</span><span class="n">wfun</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">N</span><span class="p">):</span>
    <span class="n">sims</span> <span class="o">=</span> <span class="p">[</span><span class="n">generate_cell</span><span class="p">(</span> <span class="n">wfun</span><span class="p">,</span> <span class="n">mu</span> <span class="p">,</span><span class="n">alpha</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)]</span>
    <span class="n">fits</span> <span class="o">=</span> <span class="p">[</span><span class="n">PoissonRep</span><span class="p">(</span><span class="n">LogLike</span><span class="p">(</span><span class="n">cell</span> <span class="p">))</span> <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">sims</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">sims</span><span class="p">,</span> <span class="n">fits</span>

<span class="k">def</span> <span class="nf">simulation_test</span><span class="p">(</span><span class="n">N</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">funstr</span><span class="o">=</span><span class="s1">&#39;(x-0.5)**2&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ### Test the cell creation</span>
<span class="sd">    </span>
<span class="sd">    Generate {N:,} cells with mu={mu}, alpha={alpha} using the function {funstr}</span>

<span class="sd">    The deviations from the expected norm divided by each cell&#39;s average error:</span>
<span class="sd">    {fig1}</span>
<span class="sd">    Mean and STD of this distribution: {m:.3f}, {sig:.3f}: for a generated Gaussian distribution these wouild be 0 and 1. </span>
<span class="sd">    </span>
<span class="sd">    A validation of the shape is to evaluate the cumulative probability of the over-all mean</span>
<span class="sd">    for each likelihood function. This uses the `poisson.Poisson.cdf` function.</span>
<span class="sd">    {fig2}</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">simcells</span><span class="p">,</span> <span class="n">pfits</span>

    <span class="n">wfun</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;lambda x: </span><span class="si">{</span><span class="n">funstr</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">simcells</span><span class="p">,</span> <span class="n">pfits</span> <span class="o">=</span>  <span class="n">local_sim_cells</span><span class="p">(</span><span class="n">wfun</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
    <span class="n">flux</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">p</span><span class="o">.</span><span class="n">flux</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">pfits</span><span class="p">]);</span> 
    <span class="n">fmean</span> <span class="o">=</span> <span class="mi">1</span><span class="o">+</span><span class="n">alpha</span>
    <span class="k">def</span> <span class="nf">pull</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
        <span class="n">f</span><span class="p">,</span> <span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>  <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">flux</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">errors</span>
        <span class="n">s</span> <span class="o">=</span> <span class="p">(</span><span class="n">h</span><span class="o">-</span><span class="n">l</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">f</span><span class="o">-</span><span class="n">fmean</span><span class="p">)</span><span class="o">/</span><span class="n">s</span>
    <span class="n">pulls</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">pull</span><span class="p">,</span> <span class="n">pfits</span><span class="p">)))</span>
    
    <span class="n">m</span><span class="p">,</span> <span class="n">sig</span> <span class="o">=</span> <span class="n">pulls</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">pulls</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;font&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
    <span class="n">fig1</span><span class="p">,</span><span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="n">num</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">pulls</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">21</span><span class="p">),</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span><span class="kc">None</span><span class="p">),</span> <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;pull&#39;</span><span class="p">);</span> 
    <span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">fig1</span><span class="o">.</span><span class="n">width</span><span class="o">=</span><span class="mi">300</span>

    <span class="k">class</span> <span class="nc">CDF</span><span class="p">():</span>
        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alpha</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="mi">1</span><span class="o">+</span><span class="n">alpha</span>
        <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">p</span><span class="o">.</span><span class="n">poiss</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">cdf</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">fmean</span><span class="o">=</span><span class="mf">1.1</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">p</span><span class="o">.</span><span class="n">poiss</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">fmean</span><span class="p">)</span>

    <span class="c1">#</span>
    <span class="n">cd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">CDF</span><span class="p">(</span><span class="n">alpha</span><span class="p">),</span> <span class="n">pfits</span><span class="p">)))</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="n">num</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">cd</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">21</span><span class="p">),</span> <span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;probability&#39;</span><span class="p">)</span>
                            
    <span class="n">fig2</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">locals</span><span class="p">()</span>

<span class="k">if</span> <span class="n">Config</span><span class="p">()</span><span class="o">.</span><span class="n">valid</span><span class="p">:</span>
    <span class="n">nbdoc</span><span class="p">(</span><span class="n">simulation_test</span><span class="p">,</span><span class="n">mu</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h3 id="Test-the-cell-creation">Test the cell creation<a class="anchor-link" href="#Test-the-cell-creation"> </a></h3><p>Generate 10,000 cells with mu=50, alpha=0 using the function (x-0.5)**2</p>
<p>The deviations from the expected norm divided by each cell's average error:</p>
<div class="nbdoc_image">
<figure style="margin-left: 5%" title="Figure 1">  <a href="images/simulation_test_fig_01.png" title="images/simulation_test_fig_01.png">    <img src="images/simulation_test_fig_01.png" alt="Figure 1 at images/simulation_test_fig_01.png" width=300>   </a> </figure>
</div><p>Mean and STD of this distribution: -0.094, 1.064: for a generated Gaussian distribution these wouild be 0 and 1.</p>
<p>A validation of the shape is to evaluate the cumulative probability of the over-all mean
for each likelihood function. This uses the <code>poisson.Poisson.cdf</code> function.</p>
<div class="nbdoc_image">
<figure style="margin-left: 5%" title="Figure 3">  <a href="images/simulation_test_fig_03.png" title="images/simulation_test_fig_03.png">    <img src="images/simulation_test_fig_03.png" alt="Figure 3 at images/simulation_test_fig_03.png" width=300>   </a> </figure>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Follow-on:-combine-the-cells-and-fit-the-result">Follow-on: combine the cells and fit the result<a class="anchor-link" href="#Follow-on:-combine-the-cells-and-fit-the-result"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># need to fix simulate_cells</span>
<span class="c1"># cells=[]</span>
<span class="c1"># def simulation_lightcurve_demo(source_data):</span>
<span class="c1">#     &quot;&quot;&quot;</span>
<span class="c1">#     ### Lightcurve generation test</span>
    
<span class="c1">#     This uses the exposure measured for the source {source_name}, and</span>
<span class="c1">#     the default time bins to create a light curve assuming a fixed flux</span>
<span class="c1">#     and a histogram of weights from the data.</span>
<span class="c1">#     {output}</span>
    
<span class="c1">#     {fig}</span>
<span class="c1">#     &quot;&quot;&quot;</span>
<span class="c1">#     global cells</span>
    
<span class="c1">#     with capture_print(&#39;Print out&#39;) as output:</span>
<span class="c1">#         cells =  simulate_cells(source_data, source_flux=lambda t: 100)</span>
<span class="c1">#         fits =  fit_cells(source_data.config, cells)</span>
<span class="c1">#     fig = figure(flux_plot(config, fits), width=500)</span>
    
<span class="c1">#     return locals()</span>

<span class="c1"># if Config().valid:</span>
<span class="c1">#     nbdoc(simulation_lightcurve_demo, SourceData(&#39;Geminga&#39;))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

</div>
 

