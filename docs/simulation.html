---

title: Simulation

keywords: fastai
sidebar: home_sidebar

summary: "Generate simulated cells using the weighted likelihood"
description: "Generate simulated cells using the weighted likelihood"
nb_path: "nbs/10_simulation.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/10_simulation.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>For simulation the distribution of weights is required. That can be a histogram or a function, an input to the <code>_WeightGenerator</code> class. The class is a functor, with the argument a number on the range (0,1).  Passing an array of uniform random numbers then creates set of weights distributed according to the model represented by the input weight distribution.</p>
<p>To account for different levels of signal or background than that represented by the full dataset, the <code>_WeightGenerator</code> class accepts <code>alpha</code>($\alpha$) and <code>beta</code> ($\beta$) parameters, which will be used to weight the weight distribution  by a factor</p>
$$ \big(1 + \alpha\ w + \beta \ (1-w)\ \big), $$<p>where $w$ represents an array of weight values.</p>
<p>Generating a cell requires also the expected number of photons. If the average flux and exposure predict a number of events $\mu$, we select the actual number from the Poisson distribution.</p>
<p>This is done by <a href="wtlike/simulation#generate_cell"><code>generate_cell</code></a>, which creates a list of weights depending on $\alpha$, $\beta$, and $\mu$.</p>
<p>Finally, <a href="wtlike/simulation#simulate_cells"><code>simulate_cells</code></a> makes a list of cells, based on the actual exposure of a source.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="_Sampler" class="doc_header"><code>class</code> <code>_Sampler</code><a href="https://github.com/tburnett/wtlike/tree/master/wtlike/simulation.py#L20" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>_Sampler</code>(<strong><code>func</code></strong>, <strong><code>limits</code></strong>=<em><code>(0, 1)</code></em>, <strong><code>n</code></strong>=<em><code>100</code></em>)</p>
</blockquote>
<p>Sample an arbitrary function or histogram</p>
<ul>
<li>func -- a function, a histogram, or a fixed value<br>
  If a function, must be positive definite.<br>
  Assume histogram bins are 0 to 1.</li>
<li>a,b  -- limits (default 0,1)</li>
<li>n    -- table size (ignored if a histogram or value)</li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Gaussian-and-quadratic-example-functions">Gaussian and quadratic example functions<a class="anchor-link" href="#Gaussian-and-quadratic-example-functions"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary data-open="Hide Code" data-close="Show Code"></summary>
        <summary></summary>
        <div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">n</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">sf</span> <span class="o">=</span> <span class="n">_Sampler</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="n">limits</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="p">)</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">sf</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>
<span class="n">tests</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">mean</span><span class="p">()),</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">])</span>
<span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">tests</span><span class="o">&lt;</span><span class="mf">5e-2</span> <span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;Failed Tests: mean </span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">}</span><span class="s1">, std </span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span>

<span class="n">func</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span>
<span class="n">wfun</span> <span class="o">=</span> <span class="n">_Sampler</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>

<span class="n">test2</span> <span class="o">=</span> <span class="n">wfun</span><span class="o">.</span><span class="n">mean</span><span class="p">,</span>  <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">wfun</span><span class="p">(</span><span class="mi">1000</span><span class="p">))</span>
<span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span> <span class="n">test2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">test2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1e-1</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Not almost equal: </span><span class="si">{</span><span class="n">test2</span><span class="si">}</span><span class="s1">&#39;</span>
</pre></div>

    </div>
</div>
</div>

    </details>
</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Test-generating-weights-from-a-source-weight-histogram">Test generating weights from a source weight histogram<a class="anchor-link" href="#Test-generating-weights-from-a-source-weight-histogram"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary data-open="Hide Code" data-close="Show Code"></summary>
        <summary></summary>
        <div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">data_folder</span><span class="o">=</span><span class="s1">&#39;/home/burnett/weekly&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">valid</span><span class="p">:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;font&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">source</span> <span class="o">=</span> <span class="n">PointSource</span><span class="p">(</span><span class="s1">&#39;Geminga&#39;</span><span class="p">)</span>
    <span class="n">photon_data</span> <span class="o">=</span> <span class="n">SourceData</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>
    <span class="n">h</span> <span class="o">=</span> <span class="n">photon_data</span><span class="o">.</span><span class="n">weight_histogram</span><span class="p">()</span>
    <span class="n">sf</span> <span class="o">=</span> <span class="n">_Sampler</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">sf</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>
    <span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">h</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
            <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;simulation with </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="si">}</span><span class="s1"> samples&#39;</span><span class="p">);</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">step</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">h</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([[</span><span class="n">h</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">h</span><span class="p">])</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">h</span><span class="p">)</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">h</span><span class="p">),</span>
           <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;data, source </span><span class="si">{</span><span class="n">source</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">);</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">prop</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">));</span>
</pre></div>

    </div>
</div>
</div>

    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>photons and exposure for Geminga: Restoring from cache with key &#34;Geminga_weekly_data&#34;
Weight histogram for Geminga: Restoring from cache with key &#34;Geminga_weight_hist&#34;
</pre>
</div>
</div>

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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
"
>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="_WeightGenerator" class="doc_header"><code>class</code> <code>_WeightGenerator</code><a href="https://github.com/tburnett/wtlike/tree/master/wtlike/simulation.py#L73" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>_WeightGenerator</code>(<strong><code>func</code></strong>, <strong><code>alpha</code></strong>=<em><code>0</code></em>, <strong><code>beta</code></strong>=<em><code>0</code></em>, <strong><code>n</code></strong>=<em><code>100</code></em>) :: <code>_Sampler</code></p>
</blockquote>
<p>Generate a set of weights</p>
<ul>
<li><code>func</code> -- nominal weight distribution function, evaluated on (0,1)</li>
<li><code>alpha, beta</code> -- (default 0,0). Values for $\alpha$, $\beta$.</li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Test">Test<a class="anchor-link" href="#Test"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">wg</span> <span class="o">=</span> <span class="n">_WeightGenerator</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
<span class="n">test2</span> <span class="o">=</span> <span class="n">wg</span><span class="o">.</span><span class="n">mean</span><span class="p">,</span>  <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">wg</span><span class="p">(</span><span class="mi">1000</span><span class="p">))</span>
<span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span> <span class="n">test2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">test2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1e-1</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Not almost equal: </span><span class="si">{</span><span class="n">test2</span><span class="si">}</span><span class="s1">&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="generate_cell" class="doc_header"><code>generate_cell</code><a href="https://github.com/tburnett/wtlike/tree/master/wtlike/simulation.py#L89" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>generate_cell</code>(<strong><code>wfun</code></strong>, <strong><code>mu</code></strong>, <strong><code>alpha</code></strong>=<em><code>0</code></em>, <strong><code>beta</code></strong>=<em><code>0</code></em>)</p>
</blockquote>
<p>Generate a cell</p>
<ul>
<li><code>wfun</code> -- weight function, or histogram.
  Defined on (0,1)</li>
<li><code>mu</code> -- number of expected weights, on average</li>
<li><code>alpha</code>, <code>beta</code>  -- default 0,0; values for $\alpha$ and  $\beta$ for this cell</li>
</ul>
<p>Returns a dict with:</p>
<ul>
<li><code>n</code> -- actual generated number of weights, from Poisson</li>
<li><code>w</code> -- array of weights</li>
<li><code>S, B</code> -- expected values for $\sum w$ and $\sum(1-w)$, calulated from wfun</li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Test with a function peaked at both ends, generate equal signal and background</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary data-open="Hide Code" data-close="Show Code"></summary>
        <summary></summary>
        <div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">test_gen</span><span class="p">(</span><span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="n">wfun</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="mf">0.5</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.precision&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">quiet</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Test with alpha=</span><span class="si">{</span><span class="n">alpha</span><span class="si">}</span><span class="s1">, beta=</span><span class="si">{</span><span class="n">beta</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">cell</span> <span class="o">=</span> <span class="n">generate_cell</span><span class="p">(</span> <span class="n">wfun</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span>  <span class="n">alpha</span><span class="p">,</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">beta</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">beta</span><span class="p">)</span>
    <span class="c1">#</span>
    <span class="n">ll</span> <span class="o">=</span> <span class="n">LogLike</span><span class="p">(</span><span class="n">cell</span><span class="p">);</span> 
    <span class="k">if</span> <span class="ow">not</span> <span class="n">quiet</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Generated cell info:</span><span class="se">\n</span><span class="si">{</span> <span class="n">ll</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="n">fit</span> <span class="o">=</span> <span class="n">ll</span><span class="o">.</span><span class="n">fit_info</span><span class="p">(</span><span class="n">beta</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">quiet</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="mi">2</span> <span class="k">if</span> <span class="n">beta</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">1</span><span class="si">}</span><span class="s1">-D fit info:</span><span class="se">\n</span><span class="si">{</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">fit</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">t</span><span class="p">,</span> <span class="n">sigt</span> <span class="o">=</span> <span class="n">fit</span><span class="p">[</span><span class="s1">&#39;flux&#39;</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">alpha</span><span class="p">),</span>  <span class="n">fit</span><span class="p">[</span><span class="s1">&#39;sig_flux&#39;</span><span class="p">]</span>
    <span class="n">check_alpha</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span> <span class="k">if</span>  <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">&lt;</span><span class="n">tol</span><span class="o">*</span><span class="n">sigt</span> <span class="k">else</span> <span class="sa">f</span><span class="s1">&#39;alpha: abs(</span><span class="si">{</span><span class="n">t</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">) &gt; </span><span class="si">{</span><span class="n">tol</span><span class="si">}</span><span class="s1"> * </span><span class="si">{</span><span class="n">sigt</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span>

    <span class="k">if</span> <span class="n">beta</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="nb">bool</span><span class="p">(</span><span class="n">check_alpha</span><span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;Failed: </span><span class="si">{</span><span class="n">check_alpha</span><span class="si">}</span><span class="s1"> &#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">t</span><span class="p">,</span> <span class="n">sigt</span> <span class="o">=</span> <span class="n">fit</span><span class="p">[</span><span class="s1">&#39;beta&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">beta</span><span class="p">,</span> <span class="n">fit</span><span class="p">[</span><span class="s1">&#39;sig_beta&#39;</span><span class="p">]</span>
        <span class="n">check_beta</span> <span class="o">=</span><span class="s1">&#39;&#39;</span> <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">&lt;</span><span class="n">tol</span><span class="o">*</span><span class="n">sigt</span> <span class="k">else</span> <span class="sa">f</span><span class="s1">&#39;beta: abs(</span><span class="si">{</span><span class="n">t</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">) &gt; </span><span class="si">{</span><span class="n">tol</span><span class="si">}</span><span class="s1"> * </span><span class="si">{</span><span class="n">sigt</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span>

        <span class="k">assert</span> <span class="ow">not</span> <span class="p">(</span> <span class="nb">bool</span><span class="p">(</span><span class="n">check_alpha</span><span class="p">)</span>  <span class="ow">or</span> <span class="nb">bool</span><span class="p">(</span><span class="n">check_beta</span><span class="p">)),</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">check_alpha</span><span class="si">}</span><span class="s1">  </span><span class="si">{</span><span class="n">check_beta</span><span class="si">}</span><span class="s1">&#39;</span>
<span class="n">test_gen</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
<span class="n">test_gen</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
<span class="c1">#test_gen(10, 0, tol=5, quiet=False)</span>
<span class="n">test_gen</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">test_gen</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Test with alpha=0.1, beta=None
Generated cell info:
wtlike.loglike.LogLike:  10416 weights, S 4998.5, B 5001.5
1-D fit info:
counts      10416.000
flux            1.090
sig_flux        0.016
dtype: float64
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="simulate_cells" class="doc_header"><code>simulate_cells</code><a href="https://github.com/tburnett/wtlike/tree/master/wtlike/simulation.py#L126" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>simulate_cells</code>(<strong><code>source_data</code></strong>, <strong><code>wdist</code></strong>=<em><code>None</code></em>, <strong><code>source_flux</code></strong>=<em><code>'&lt;lambda&gt;'</code></em>)</p>
</blockquote>
<ul>
<li><a href="wtlike/source_data"><code>source_data</code></a> -- a SourceData object, use to get exposure at its position and weight distribution</li>
<li><code>wdist</code>   -- a weight function or histogram; if None, get the source distribution</li>
<li><code>source_flux</code> -- function of MJD time for the counts/day; default 100/day</li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary data-open="Hide Code" data-close="Show Code"></summary>
        <summary></summary>
        <div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">simcells</span> <span class="o">=</span> <span class="n">pfits</span> <span class="o">=</span> <span class="kc">None</span>

<span class="k">def</span> <span class="nf">local_sim_cells</span><span class="p">(</span><span class="n">wfun</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">N</span><span class="p">):</span>
    <span class="n">sims</span> <span class="o">=</span> <span class="p">[</span><span class="n">generate_cell</span><span class="p">(</span> <span class="n">wfun</span><span class="p">,</span> <span class="n">mu</span> <span class="p">,</span><span class="n">alpha</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)]</span>
    <span class="n">fits</span> <span class="o">=</span> <span class="p">[</span><span class="n">PoissonRep</span><span class="p">(</span><span class="n">LogLike</span><span class="p">(</span><span class="n">cell</span> <span class="p">))</span> <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">sims</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">sims</span><span class="p">,</span> <span class="n">fits</span>

<span class="k">def</span> <span class="nf">simulation_test</span><span class="p">(</span><span class="n">N</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">funstr</span><span class="o">=</span><span class="s1">&#39;(x-0.5)**2&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ### Test the cell creation</span>
<span class="sd">    </span>
<span class="sd">    Generate {N:,} cells with mu={mu}, alpha={alpha} using the function {funstr}</span>

<span class="sd">    The deviations from the expected norm divided by each cell&#39;s average error:</span>
<span class="sd">    {fig1}</span>
<span class="sd">    Mean and STD of this distribution: {m:.3f}, {sig:.3f}: for a generated Gaussian distribution these wouild be 0 and 1. </span>
<span class="sd">    </span>
<span class="sd">    A validation of the shape is to evaluate the cumulative probability of the over-all mean</span>
<span class="sd">    for each likelihood function. This uses the `poisson.Poisson.cdf` function.</span>
<span class="sd">    {fig2}</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">simcells</span><span class="p">,</span> <span class="n">pfits</span>

    <span class="n">wfun</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;lambda x: </span><span class="si">{</span><span class="n">funstr</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">simcells</span><span class="p">,</span> <span class="n">pfits</span> <span class="o">=</span>  <span class="n">local_sim_cells</span><span class="p">(</span><span class="n">wfun</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
    <span class="n">flux</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">p</span><span class="o">.</span><span class="n">flux</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">pfits</span><span class="p">]);</span> 
    <span class="n">fmean</span> <span class="o">=</span> <span class="mi">1</span><span class="o">+</span><span class="n">alpha</span>
    <span class="k">def</span> <span class="nf">pull</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
        <span class="n">f</span><span class="p">,</span> <span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>  <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">flux</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">errors</span>
        <span class="n">s</span> <span class="o">=</span> <span class="p">(</span><span class="n">h</span><span class="o">-</span><span class="n">l</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">f</span><span class="o">-</span><span class="n">fmean</span><span class="p">)</span><span class="o">/</span><span class="n">s</span>
    <span class="n">pulls</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">pull</span><span class="p">,</span> <span class="n">pfits</span><span class="p">)))</span>
    
    <span class="n">m</span><span class="p">,</span> <span class="n">sig</span> <span class="o">=</span> <span class="n">pulls</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">pulls</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;font&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
    <span class="n">fig1</span><span class="p">,</span><span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="n">num</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">pulls</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">21</span><span class="p">),</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span><span class="kc">None</span><span class="p">),</span> <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;pull&#39;</span><span class="p">);</span> 
    <span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">fig1</span><span class="o">.</span><span class="n">width</span><span class="o">=</span><span class="mi">300</span>

    <span class="k">class</span> <span class="nc">CDF</span><span class="p">():</span>
        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alpha</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="mi">1</span><span class="o">+</span><span class="n">alpha</span>
        <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">p</span><span class="o">.</span><span class="n">poiss</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">cdf</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">fmean</span><span class="o">=</span><span class="mf">1.1</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">p</span><span class="o">.</span><span class="n">poiss</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">fmean</span><span class="p">)</span>

    <span class="c1">#</span>
    <span class="n">cd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">CDF</span><span class="p">(</span><span class="n">alpha</span><span class="p">),</span> <span class="n">pfits</span><span class="p">)))</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="n">num</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">cd</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">21</span><span class="p">),</span> <span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;probability&#39;</span><span class="p">)</span>
                            
    <span class="n">fig2</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">locals</span><span class="p">()</span>

<span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">valid</span><span class="p">:</span>
    <span class="n">nbdoc</span><span class="p">(</span><span class="n">simulation_test</span><span class="p">,</span><span class="n">mu</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h3 id="Test-the-cell-creation">Test the cell creation<a class="anchor-link" href="#Test-the-cell-creation"> </a></h3><p>Generate 10,000 cells with mu=50, alpha=0 using the function (x-0.5)**2</p>
<p>The deviations from the expected norm divided by each cell's average error:</p>
<div class="nbdoc_image">
<figure style="margin-left: 5%" title="Figure 1">  <a href="images/simulation_test_fig_01.png" title="images/simulation_test_fig_01.png">    <img src="images/simulation_test_fig_01.png" alt="Figure 1 at images/simulation_test_fig_01.png" width=300>   </a> </figure>
</div><p>Mean and STD of this distribution: -0.111, 1.045: for a generated Gaussian distribution these wouild be 0 and 1.</p>
<p>A validation of the shape is to evaluate the cumulative probability of the over-all mean
for each likelihood function. This uses the <code>poisson.Poisson.cdf</code> function.</p>
<div class="nbdoc_image">
<figure style="margin-left: 5%" title="Figure 3">  <a href="images/simulation_test_fig_03.png" title="images/simulation_test_fig_03.png">    <img src="images/simulation_test_fig_03.png" alt="Figure 3 at images/simulation_test_fig_03.png" width=300>   </a> </figure>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Follow-on:-combine-the-cells-and-fit-the-result">Follow-on: combine the cells and fit the result<a class="anchor-link" href="#Follow-on:-combine-the-cells-and-fit-the-result"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary data-open="Hide Code" data-close="Show Code"></summary>
        <summary></summary>
        <div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cells</span><span class="o">=</span><span class="p">[]</span>
<span class="k">def</span> <span class="nf">simulation_lightcurve_demo</span><span class="p">(</span><span class="n">source_data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ### Lightcurve generation test</span>
<span class="sd">    </span>
<span class="sd">    This uses the exposure measured for the source {source_name}, and</span>
<span class="sd">    the default time bins to create a light curve assuming a fixed flux</span>
<span class="sd">    and a histogram of weights from the data.</span>
<span class="sd">    {output}</span>
<span class="sd">    </span>
<span class="sd">    {fig}</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">cells</span>
    
    <span class="k">with</span> <span class="n">capture_print</span><span class="p">(</span><span class="s1">&#39;Print out&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">output</span><span class="p">:</span>
        <span class="n">cells</span> <span class="o">=</span>  <span class="n">simulate_cells</span><span class="p">(</span><span class="n">source_data</span><span class="p">,</span> <span class="n">source_flux</span><span class="o">=</span><span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="mi">100</span><span class="p">)</span>
        <span class="n">fits</span> <span class="o">=</span>  <span class="n">fit_cells</span><span class="p">(</span><span class="n">source_data</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="n">cells</span><span class="p">)</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">flux_plot</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">fits</span><span class="p">),</span> <span class="n">width</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="nb">locals</span><span class="p">()</span>

<span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">valid</span><span class="p">:</span>
    <span class="n">nbdoc</span><span class="p">(</span><span class="n">simulation_lightcurve_demo</span><span class="p">,</span> <span class="n">SourceData</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">PointSource</span><span class="p">(</span><span class="s1">&#39;Geminga&#39;</span><span class="p">)))</span>
</pre></div>

    </div>
</div>
</div>

    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>photons and exposure for Geminga: Restoring from cache with key &#34;Geminga_weekly_data&#34;
</pre>
</div>
</div>

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h3 id="Lightcurve-generation-test">Lightcurve generation test<a class="anchor-link" href="#Lightcurve-generation-test"> </a></h3><p>This uses the exposure measured for the source {source_name}, and
the default time bins to create a light curve assuming a fixed flux
and a histogram of weights from the data.</p>
<p><details  class="nbdoc-description" >  <summary> Print out </summary>  <div style="margin-left: 5%"><pre>Time bins: 4643 intervals of 1 days, from MJD 54683.0(2008-08-05) to 59326.0(2021-04-22))<br>Relative exposure per bin:<br>count    4643.000<br>mean        1.000<br>std         0.353<br>min         0.000<br>50%         0.993<br>max         3.664<br>dtype: float64<br>Weight histogram for Geminga: Restoring from cache with key "Geminga_weight_hist"<br>Loaded 4443 / 4643 cells with exposure &gt; 0.3 for fitting<br></pre></div> </details></p>
<div class="nbdoc_image">
<figure style="margin-left: 5%" title="Figure 1">  <a href="images/simulation_lightcurve_demo_fig_01.png" title="images/simulation_lightcurve_demo_fig_01.png">    <img src="images/simulation_lightcurve_demo_fig_01.png" alt="Figure 1 at images/simulation_lightcurve_demo_fig_01.png" width=500>   </a> </figure>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

