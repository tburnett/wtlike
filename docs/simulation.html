---

title: Simulation

keywords: fastai
sidebar: home_sidebar

summary: "Generate simulated cells using the weighted likelihood"
description: "Generate simulated cells using the weighted likelihood"
nb_path: "nbs/10_simulation.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/10_simulation.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>For simulation the distribution of weights is required. That can be a histogram or a function, an input to the <code>_WeightGenerator</code> class. The class is a functor, with the argument a number on the range (0,1).  Passing an array of uniform random numbers then creates set of weights distributed according to the model represented by the input weight distribution.</p>
<p>To account for different levels of signal or background than that represented by the full dataset, the <code>_WeightGenerator</code> class accepts <code>alpha</code> and <code>beta</code> parmeters, which will be used to weight the weight distribution  by a factor</p>
<p>{% raw %}
$$ \big(1 + \alpha w + \beta \ (1-w)\ \big) $$
{% endraw %}</p>
<p>Generating a cell requires also the expected number of photons. If the average flux and exposure predict a number of events $\mu$, we select the actual number from the Poisson distribution.</p>
<p>This is done by <a href="/simulation#generate_cell"><code>generate_cell</code></a>, which creates a list of weights depending on $\alpha$, $\beta$, and $\mu$.</p>
<p>Finally, <a href="/simulation#simulate_cells"><code>simulate_cells</code></a> makes a list of cells, based on the actual exposure of a source.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="_Sampler" class="doc_header"><code>class</code> <code>_Sampler</code><a href="https://github.com/tburnett/wtlike/tree/master/wtlike/simulation.py#L21" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>_Sampler</code>(<strong><code>func</code></strong>, <strong><code>limits</code></strong>=<em><code>(0, 1)</code></em>, <strong><code>n</code></strong>=<em><code>100</code></em>)</p>
</blockquote>
<p>Sample an arbitrary function or histogram</p>
<ul>
<li>func -- a function, a histogram, or a fixed value<br>
  If a function, must be positive definite.<br>
  Assume histogram bins are 0 to 1.</li>
<li>a,b  -- limits (default 0,1)</li>
<li>n    -- table size (ignored if a histogram or value)</li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Gaussian-and-quadratic-example-functions">Gaussian and quadratic example functions<a class="anchor-link" href="#Gaussian-and-quadratic-example-functions"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">n</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">sf</span> <span class="o">=</span> <span class="n">_Sampler</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="n">limits</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="p">)</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">sf</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>
<span class="n">tests</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">mean</span><span class="p">()),</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">])</span>
<span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">tests</span><span class="o">&lt;</span><span class="mf">5e-2</span> <span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;Failed Tests: mean </span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">}</span><span class="s1">, std </span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span>

<span class="n">func</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span>
<span class="n">wfun</span> <span class="o">=</span> <span class="n">_Sampler</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>

<span class="n">test2</span> <span class="o">=</span> <span class="n">wfun</span><span class="o">.</span><span class="n">mean</span><span class="p">,</span>  <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">wfun</span><span class="p">(</span><span class="mi">1000</span><span class="p">))</span>
<span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span> <span class="n">test2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">test2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1e-1</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Not almost equal: </span><span class="si">{</span><span class="n">test2</span><span class="si">}</span><span class="s1">&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Use-a--histogram">Use a  histogram<a class="anchor-link" href="#Use-a--histogram"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">wtlike.weights</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>
<span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">valid</span><span class="p">:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;font&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">source</span> <span class="o">=</span> <span class="n">PointSource</span><span class="p">(</span><span class="s1">&#39;Geminga&#39;</span><span class="p">)</span>
    <span class="n">h</span> <span class="o">=</span> <span class="n">get_weight_hist</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>
    <span class="n">sf</span> <span class="o">=</span> <span class="n">_Sampler</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">sf</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>
    <span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">h</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
            <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;simulation with </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="si">}</span><span class="s1"> samples&#39;</span><span class="p">);</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">step</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">h</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([[</span><span class="n">h</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">h</span><span class="p">])</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">h</span><span class="p">)</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">h</span><span class="p">),</span>
           <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;data, source </span><span class="si">{</span><span class="n">source</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">);</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">prop</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">));</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Weight histogram for Geminga: Restoring from cache with key &#34;weight_hist_Geminga&#34;
</pre>
</div>
</div>

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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BgwYQPfu3enWrRsFBQXcdNNNvPTSS9xwww384Q9/YPDgwWzY4JgGbv78+bz//vts2bIFYwz9+vWjffv23HvvvYBjIYlevXqxbNkyli1bRmZmJt99951zIQQRkZpS87Ibc+bMISkpibi4ODp37syKFY5VLqZMmeJcySc7OxtjDAsWLKBt27YkJCTw5z//mY0bN3LRRRcRHx9faYrBiudWPP/06dPVnn/Pnj1cffXVNG/enMTERH77299SWFgIwIgRI9i3bx833HADsbGxPPHEE9WulZeXx4033kizZs3o2LEjf/nLXyrFccstt3Drrbc6F4V3NT82OBaD/93vfgc41tBt3LgxjzzyCADFxcVER0dz+PDhSs8/adIk1q5dy+jRo4mNja1UBp988gkXXHABCQkJPPDAA26XzevcuTN33nkn3bp1q7bv+PHjvPPOOzz++OPExsZy5ZVXcuONN/Lqq68C8O6779KtWzcGDRpEdHQ0U6ZMYcuWLXz77bcAvPLKK4wbN47k5GSSkpIYN24cCxcuBGDXrl18+eWXTJ06lZiYGG6++WbS09N55513XMb5+eefk5GRQZMmTWjVqhUPP/ywc9+gQYNo3bo1TZs25Re/+AXbt2937rv99tu5//77uf7664mNjeWKK64gPz+fsWPHkpCQwIUXXshXX33lPD4tLY1Zs2bRtWtXEhISGDlyJCUlJS5jysvL4+abb6ZFixa0a9eO5557zqd4RST4lHRd2LlzJ/PmzWPjxo0cPXqU5cuXk5aW5vb4zz77jO+++4633nqLsWPHMmPGDD755BO2b9/O4sWLazSZvmVZTJgwgby8PHbs2MH+/fudy/O9+uqrpKSk8OGHH3Ls2DFnEqxo6NChJCcnk5eXx5IlS5g4caLzgwPABx98wJAhQygsLOTGG290O/9wnz59WLVqFQAbN26kdevWztfz6aef0rlzZxISEiqdM2PGDH7+858zb948jh07Vmn5vI8++oiNGzeyZcsWFi9eXKPl/Hbt2kVkZCSdOnVybju7lCHA9u3b6d69u3Nf48aN6dChg9v9Vc9t3749cXFxLvdXNWbMGMaMGUNRURF79uzhlltuce67/vrr+e677zhw4AA9evTgt7/9baVzFy9ezPTp0ykoKKBRo0b06tWLHj16UFBQQGZmZrWE+Prrr7N8+XL27NnDrl27mD59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
"
>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="_WeightGenerator" class="doc_header"><code>class</code> <code>_WeightGenerator</code><a href="https://github.com/tburnett/wtlike/tree/master/wtlike/simulation.py#L74" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>_WeightGenerator</code>(<strong><code>func</code></strong>, <strong><code>alpha</code></strong>=<em><code>0</code></em>, <strong><code>beta</code></strong>=<em><code>0</code></em>, <strong><code>n</code></strong>=<em><code>100</code></em>) :: <code>_Sampler</code></p>
</blockquote>
<p>Generate a set of weights</p>
<ul>
<li><code>func</code> -- nominal weight distribution function, evaluated on (0,1)</li>
<li><code>alpha, beta</code> -- (default 0,0). Values for $\alpha$, $\beta$.</li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Test">Test<a class="anchor-link" href="#Test"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span>      
<span class="n">wg</span> <span class="o">=</span> <span class="n">_WeightGenerator</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
<span class="n">test2</span> <span class="o">=</span> <span class="n">wg</span><span class="o">.</span><span class="n">mean</span><span class="p">,</span>  <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">wg</span><span class="p">(</span><span class="mi">1000</span><span class="p">))</span>
<span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span> <span class="n">test2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">test2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1e-1</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Not almost equal: </span><span class="si">{</span><span class="n">test2</span><span class="si">}</span><span class="s1">&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="generate_cell" class="doc_header"><code>generate_cell</code><a href="https://github.com/tburnett/wtlike/tree/master/wtlike/simulation.py#L91" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>generate_cell</code>(<strong><code>wfun</code></strong>, <strong><code>mu</code></strong>, <strong><code>alpha</code></strong>=<em><code>0</code></em>, <strong><code>beta</code></strong>=<em><code>0</code></em>)</p>
</blockquote>
<p>Generate a cell</p>
<ul>
<li><code>wfun</code> -- weight function, or histogram.
  Defined on (0,1)</li>
<li><code>mu</code> -- number of expected weights, on average</li>
<li><code>alpha</code>, <code>beta</code>  -- default 0,0; values for $\alpha$ and  $\beta$ for this cell</li>
</ul>
<p>Returns a dict with:</p>
<ul>
<li><code>n</code> -- actual generated number of weights, from Poisson</li>
<li><code>w</code> -- array of weights</li>
<li><code>S, B</code> -- expected values for $\sum w$ and $\sum(1-w)$, calulated from wfun</li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Test with a function peaked at both ends, generate equal signal and background</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary data-open="Hide Code" data-close="Show Code"></summary>
        <summary></summary>
        <div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">test_gen</span><span class="p">(</span><span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="n">wfun</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="mf">0.5</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.precision&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">quiet</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Test with alpha=</span><span class="si">{</span><span class="n">alpha</span><span class="si">}</span><span class="s1">, beta=</span><span class="si">{</span><span class="n">beta</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">cell</span> <span class="o">=</span> <span class="n">generate_cell</span><span class="p">(</span> <span class="n">wfun</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span>  <span class="n">alpha</span><span class="p">,</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">beta</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">beta</span><span class="p">)</span>
    <span class="c1">#</span>
    <span class="n">ll</span> <span class="o">=</span> <span class="n">LogLike</span><span class="p">(</span><span class="n">cell</span><span class="p">);</span> 
    <span class="k">if</span> <span class="ow">not</span> <span class="n">quiet</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Generated cell info:</span><span class="se">\n</span><span class="si">{</span> <span class="n">ll</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="n">fit</span> <span class="o">=</span> <span class="n">ll</span><span class="o">.</span><span class="n">fit_info</span><span class="p">(</span><span class="n">beta</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">quiet</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="mi">2</span> <span class="k">if</span> <span class="n">beta</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">1</span><span class="si">}</span><span class="s1">-D fit info:</span><span class="se">\n</span><span class="si">{</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">fit</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">t</span><span class="p">,</span> <span class="n">sigt</span> <span class="o">=</span> <span class="n">fit</span><span class="p">[</span><span class="s1">&#39;flux&#39;</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">alpha</span><span class="p">),</span>  <span class="n">fit</span><span class="p">[</span><span class="s1">&#39;sig_flux&#39;</span><span class="p">]</span>
    <span class="n">check_alpha</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span> <span class="k">if</span>  <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">&lt;</span><span class="n">tol</span><span class="o">*</span><span class="n">sigt</span> <span class="k">else</span> <span class="sa">f</span><span class="s1">&#39;alpha: abs(</span><span class="si">{</span><span class="n">t</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">) &gt; </span><span class="si">{</span><span class="n">tol</span><span class="si">}</span><span class="s1"> * </span><span class="si">{</span><span class="n">sigt</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span>

    <span class="k">if</span> <span class="n">beta</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="nb">bool</span><span class="p">(</span><span class="n">check_alpha</span><span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;Failed: </span><span class="si">{</span><span class="n">check_alpha</span><span class="si">}</span><span class="s1"> &#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">t</span><span class="p">,</span> <span class="n">sigt</span> <span class="o">=</span> <span class="n">fit</span><span class="p">[</span><span class="s1">&#39;beta&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">beta</span><span class="p">,</span> <span class="n">fit</span><span class="p">[</span><span class="s1">&#39;sig_beta&#39;</span><span class="p">]</span>
        <span class="n">check_beta</span> <span class="o">=</span><span class="s1">&#39;&#39;</span> <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">&lt;</span><span class="n">tol</span><span class="o">*</span><span class="n">sigt</span> <span class="k">else</span> <span class="sa">f</span><span class="s1">&#39;beta: abs(</span><span class="si">{</span><span class="n">t</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">) &gt; </span><span class="si">{</span><span class="n">tol</span><span class="si">}</span><span class="s1"> * </span><span class="si">{</span><span class="n">sigt</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span>

        <span class="k">assert</span> <span class="ow">not</span> <span class="p">(</span> <span class="nb">bool</span><span class="p">(</span><span class="n">check_alpha</span><span class="p">)</span>  <span class="ow">or</span> <span class="nb">bool</span><span class="p">(</span><span class="n">check_beta</span><span class="p">)),</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">check_alpha</span><span class="si">}</span><span class="s1">  </span><span class="si">{</span><span class="n">check_beta</span><span class="si">}</span><span class="s1">&#39;</span>
<span class="n">test_gen</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
<span class="n">test_gen</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
<span class="c1">#test_gen(10, 0, tol=5, quiet=False)</span>
<span class="n">test_gen</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">test_gen</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Test with alpha=0.1, beta=None
Generated cell info:
wtlike.loglike.LogLike:  10422 weights, S 4998.5, B 5001.5
1-D fit info:
counts      10422.000
flux            1.095
sig_flux        0.016
dtype: float64
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="simulate_cells" class="doc_header"><code>simulate_cells</code><a href="https://github.com/tburnett/wtlike/tree/master/wtlike/simulation.py#L128" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>simulate_cells</code>(<strong><code>config</code></strong>, <strong><code>source</code></strong>, <strong><code>wdist</code></strong>=<em><code>None</code></em>, <strong><code>source_flux</code></strong>=<em><code>'&lt;lambda&gt;'</code></em>)</p>
</blockquote>
<ul>
<li><code>source</code> -- a PointSource object, use to get exposure at its position and weight distribution</li>
<li><code>wdist</code>   -- a weight function or histogram; if None, get the source distribution</li>
<li><code>source_flux</code> -- function of MJD time for the counts/day; default 100/day</li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary data-open="Hide Code" data-close="Show Code"></summary>
        <summary></summary>
        <div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">simcells</span> <span class="o">=</span> <span class="n">pfits</span> <span class="o">=</span> <span class="kc">None</span>
<span class="k">def</span> <span class="nf">simulation_test</span><span class="p">(</span><span class="n">N</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">funstr</span><span class="o">=</span><span class="s1">&#39;(x-0.5)**2&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ### Test the cell creation</span>
<span class="sd">    </span>
<span class="sd">    Generate {N:,} cells with mu={mu}, alpha={alpha} using the function {funstr}</span>

<span class="sd">    The deviations from the expected norm divided by each cell&#39;s average error:</span>
<span class="sd">    {fig1}</span>
<span class="sd">    Mean and STD of this distribution: {m:.3f}, {sig:.3f}: for a generated Gaussian distribution these wouild be 0 and 1. </span>
<span class="sd">    </span>
<span class="sd">    A validation of the shape is to evaluate the cumulative probability of the over-all mean</span>
<span class="sd">    for each likelihood function. This uses the `poisson.Poisson.cdf` function.</span>
<span class="sd">    {fig2}</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">simcells</span><span class="p">,</span> <span class="n">pfits</span>

    <span class="n">wfun</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;lambda x: </span><span class="si">{</span><span class="n">funstr</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">simcells</span><span class="p">,</span> <span class="n">pfits</span> <span class="o">=</span>  <span class="n">local_sim_cells</span><span class="p">(</span><span class="n">wfun</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
    <span class="n">flux</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">p</span><span class="o">.</span><span class="n">flux</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">pfits</span><span class="p">]);</span> 
    <span class="n">fmean</span> <span class="o">=</span> <span class="mi">1</span><span class="o">+</span><span class="n">alpha</span>
    <span class="k">def</span> <span class="nf">pull</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
        <span class="n">f</span><span class="p">,</span> <span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>  <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">flux</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">errors</span>
        <span class="n">s</span> <span class="o">=</span> <span class="p">(</span><span class="n">h</span><span class="o">-</span><span class="n">l</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">f</span><span class="o">-</span><span class="n">fmean</span><span class="p">)</span><span class="o">/</span><span class="n">s</span>
    <span class="n">pulls</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">pull</span><span class="p">,</span> <span class="n">pfits</span><span class="p">)))</span>
    
    <span class="n">m</span><span class="p">,</span> <span class="n">sig</span> <span class="o">=</span> <span class="n">pulls</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">pulls</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;font&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
    <span class="n">fig1</span><span class="p">,</span><span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="n">num</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">pulls</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">21</span><span class="p">),</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span><span class="kc">None</span><span class="p">),</span> <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;pull&#39;</span><span class="p">);</span> 
    <span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">fig1</span><span class="o">.</span><span class="n">width</span><span class="o">=</span><span class="mi">300</span>

    <span class="k">class</span> <span class="nc">CDF</span><span class="p">():</span>
        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alpha</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="mi">1</span><span class="o">+</span><span class="n">alpha</span>
        <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">p</span><span class="o">.</span><span class="n">poiss</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">cdf</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">fmean</span><span class="o">=</span><span class="mf">1.1</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">p</span><span class="o">.</span><span class="n">poiss</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">fmean</span><span class="p">)</span>

    <span class="c1">#</span>
    <span class="n">cd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">CDF</span><span class="p">(</span><span class="n">alpha</span><span class="p">),</span> <span class="n">pfits</span><span class="p">)))</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="n">num</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">cd</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">21</span><span class="p">),</span> <span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;probability&#39;</span><span class="p">)</span>
                            
    <span class="n">fig2</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">locals</span><span class="p">()</span>

<span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">valid</span><span class="p">:</span>
    <span class="n">nbdoc</span><span class="p">(</span><span class="n">simulation_test</span><span class="p">,</span><span class="n">mu</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h3 id="Test-the-cell-creation">Test the cell creation<a class="anchor-link" href="#Test-the-cell-creation"> </a></h3><p>Generate 10,000 cells with mu=50, alpha=0 using the function (x-0.5)**2</p>
<p>The deviations from the expected norm divided by each cell's average error:</p>
<div class="nbdoc_image">
<figure style="margin-left: 5%" title="Figure 1">  <a href="images/simulation_test_fig_01.png" title="images/simulation_test_fig_01.png">    <img src="images/simulation_test_fig_01.png" alt="Figure 1 at images/simulation_test_fig_01.png" width=300>   </a> </figure>
</div><p>Mean and STD of this distribution: -0.093, 1.045: for a generated Gaussian distribution these wouild be 0 and 1.</p>
<p>A validation of the shape is to evaluate the cumulative probability of the over-all mean
for each likelihood function. This uses the <code>poisson.Poisson.cdf</code> function.</p>
<div class="nbdoc_image">
<figure style="margin-left: 5%" title="Figure 3">  <a href="images/simulation_test_fig_03.png" title="images/simulation_test_fig_03.png">    <img src="images/simulation_test_fig_03.png" alt="Figure 3 at images/simulation_test_fig_03.png" width=300>   </a> </figure>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Follow-on:-combine-the-cells-and-fit-the-result">Follow-on: combine the cells and fit the result<a class="anchor-link" href="#Follow-on:-combine-the-cells-and-fit-the-result"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary data-open="Hide Code" data-close="Show Code"></summary>
        <summary></summary>
        <div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cells</span><span class="o">=</span><span class="p">[]</span>
<span class="k">def</span> <span class="nf">simulation_lightcurve_demo</span><span class="p">(</span><span class="n">source_name</span><span class="o">=</span><span class="s1">&#39;Geminga&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ### Lightcurve generation test</span>
<span class="sd">    </span>
<span class="sd">    This uses the exposure measured for the source {source_name}, and</span>
<span class="sd">    the default time bins to create a light curve assuming a fixed flux</span>
<span class="sd">    and a histogram of weights from the data.</span>
<span class="sd">    {output}</span>
<span class="sd">    </span>
<span class="sd">    {fig}</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">cells</span>
    <span class="n">source</span> <span class="o">=</span> <span class="n">PointSource</span><span class="p">(</span><span class="s1">&#39;Geminga&#39;</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">capture_print</span><span class="p">(</span><span class="s1">&#39;Print out&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">output</span><span class="p">:</span>
        <span class="n">cells</span> <span class="o">=</span>  <span class="n">simulate_cells</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">source_flux</span><span class="o">=</span><span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="mi">100</span><span class="p">)</span>
        <span class="n">fits</span> <span class="o">=</span> <span class="n">fit_cells</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">cells</span><span class="p">)</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">flux_plot</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">fits</span><span class="p">),</span> <span class="n">width</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="nb">locals</span><span class="p">()</span>

<span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">valid</span><span class="p">:</span>
    <span class="n">nbdoc</span><span class="p">(</span><span class="n">simulation_lightcurve_demo</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h3 id="Lightcurve-generation-test">Lightcurve generation test<a class="anchor-link" href="#Lightcurve-generation-test"> </a></h3><p>This uses the exposure measured for the source Geminga, and
the default time bins to create a light curve assuming a fixed flux
and a histogram of weights from the data.</p>
<p><details  class="nbdoc-description" >  <summary> Print out </summary>  <div style="margin-left: 5%"><pre>binned exposure for source Geminga: Restoring from cache with key "binned_exposure_Geminga"<br>Weight histogram for Geminga: Restoring from cache with key "weight_hist_Geminga"<br>Loaded 3873 / 4015 cells with exposure &gt; 0.3 for fitting<br></pre></div> </details></p>
<div class="nbdoc_image">
<figure style="margin-left: 5%" title="Figure 1">  <a href="images/simulation_lightcurve_demo_fig_01.png" title="images/simulation_lightcurve_demo_fig_01.png">    <img src="images/simulation_lightcurve_demo_fig_01.png" alt="Figure 1 at images/simulation_lightcurve_demo_fig_01.png" width=500>   </a> </figure>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

