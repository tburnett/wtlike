---

title: Exposure processing

keywords: fastai
sidebar: home_sidebar

summary: "Process FT2 exposure information for a source direction "
description: "Process FT2 exposure information for a source direction "
nb_path: "nbs/03_exposure.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/03_exposure.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="BaseExposure" class="doc_header"><code>class</code> <code>BaseExposure</code><a href="" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>BaseExposure</code>(<strong><code>config</code></strong>, <strong><code>source</code></strong>)</p>
</blockquote>
<p>Base class for implementing exposure calculation</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="KerrExposure" class="doc_header"><code>class</code> <code>KerrExposure</code><a href="" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>KerrExposure</code>(<strong><code>config</code></strong>, <strong><code>source</code></strong>) :: <a href="/wtlikeexposure#BaseExposure"><code>BaseExposure</code></a></p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="SourceExposure" class="doc_header"><code>class</code> <code>SourceExposure</code><a href="https://github.com/tburnett/wtlike/tree/master/wtlike/exposure.py#L131" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>SourceExposure</code>(<strong><code>config</code></strong>, <strong><code>source</code></strong>) :: <a href="/wtlikeexposure#BaseExposure"><code>BaseExposure</code></a></p>
</blockquote>
<p>BaseExposure subclass that uses the source spectrum applied only to used bands</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="sc_data_selection" class="doc_header"><code>sc_data_selection</code><a href="https://github.com/tburnett/wtlike/tree/master/wtlike/exposure.py#L198" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>sc_data_selection</code>(<strong><code>config</code></strong>, <strong><code>source</code></strong>, <strong><code>sc_data</code></strong>)</p>
</blockquote>
<p>Return a DF with the S/C data for the source direction, wtih cos theta and zenith cuts</p>
<p>columns:</p>
<ul>
<li>start, stop, livetime -- from the FT2 info</li>
<li>cos_theta -- angle between bore and direction</li>
<li>exp -- effective area at angle wighted by a default spectral function, times livetime</li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="binned_exposure" class="doc_header"><code>binned_exposure</code><a href="https://github.com/tburnett/wtlike/tree/master/wtlike/exposure.py#L223" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>binned_exposure</code>(<strong><code>config</code></strong>, <strong><code>exposure</code></strong>, <strong><code>time_edges</code></strong>)</p>
</blockquote>
<p>Bin the exposure in to cells</p>
<ul>
<li>exposure -- A DataFrame derived from FT2</li>
<li>time_bins: list of edges, an interleaved start/stop array</li>
</ul>
<p>Returns:</p>
<p>An array of exposure integrated over each time bin. Assumes that the time bins
are contained within the exposure.</p>
<p>it is interleaved, client must apply [0::2] selection. (why not do it here?)</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="time_bin_edges" class="doc_header"><code>time_bin_edges</code><a href="https://github.com/tburnett/wtlike/tree/master/wtlike/exposure.py#L150" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>time_bin_edges</code>(<strong><code>config</code></strong>, <strong><code>exposure</code></strong>, <strong><code>tbin</code></strong>=<em><code>None</code></em>)</p>
</blockquote>
<p>Return an interleaved array of start/stop values</p>
<p>tbin: an array (a,b,d), default config.time_bins</p>
<p>interpretation of a, b:</p>

<pre><code>if &gt; 50000, interpret as MJD
if &lt;0, back from stop
otherwise, offset from start

</code></pre>
<p>d : if positive, the day bin size
    if 0; return contiguous bins</p>

</div>

</div>

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="binned_exposure" class="doc_header"><code>binned_exposure</code><a href="https://github.com/tburnett/wtlike/tree/master/wtlike/exposure.py#L223" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>binned_exposure</code>(<strong><code>config</code></strong>, <strong><code>exposure</code></strong>, <strong><code>time_edges</code></strong>)</p>
</blockquote>
<p>Bin the exposure in to cells</p>
<ul>
<li>exposure -- A DataFrame derived from FT2</li>
<li>time_bins: list of edges, an interleaved start/stop array</li>
</ul>
<p>Returns:</p>
<p>An array of exposure integrated over each time bin. Assumes that the time bins
are contained within the exposure.</p>
<p>it is interleaved, client must apply [0::2] selection. (why not do it here?)</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Test-with-a-Geminga-week">Test with a Geminga week<a class="anchor-link" href="#Test-with-a-Geminga-week"> </a></h3><p>First use old method to generate</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Saved-output-for-comparison">Saved output for comparison<a class="anchor-link" href="#Saved-output-for-comparison"> </a></h3>
<pre><code>    Found 16,826 S/C entries:  5,633 remain after zenith and theta cuts
count      5633.00
mean      89305.61
std       33910.22
min        1117.04
25%       60491.62
50%       87129.21
75%      124531.16
max      151232.82
dtype: float64</code></pre>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Check-flux-values-per-energy-band-from-weight-computation">Check flux values per energy band from weight computation<a class="anchor-link" href="#Check-flux-values-per-energy-band-from-weight-computation"> </a></h3><p>Compare with default</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># if config.valid:</span>
<span class="c1">#     # make a DF with spectrum</span>
<span class="c1">#     wtdict = source.wtman.wt_dict</span>

<span class="c1">#     bf_df = pd.DataFrame(dict(</span>
<span class="c1">#         band=wtdict.keys(), flux=[d[&#39;flux&#39;] for d in wtdict.values()]))</span>
<span class="c1">#     bf_df.loc[:,&#39;energy&#39;] = config.energy_bins[bf_df.band//2]</span>
<span class="c1">#     bf_df.loc[:,&#39;eflux&#39;] = (bf_df.flux * bf_df.energy**2)*1e6</span>
<span class="c1">#     print(bf_df.head(), &#39;\n&#39;)</span>


<span class="c1">#     plt.rc(&#39;font&#39;, size=12)</span>
<span class="c1">#     fig, (ax,ax2) =plt.subplots(2,1, figsize=(3.5,4), sharex=True)</span>
<span class="c1">#     plt.subplots_adjust(hspace=0)</span>
<span class="c1">#     ax.loglog(&#39;energy&#39;, &#39;eflux&#39;, &#39;o--&#39;,data=bf_df,label=f&#39;{source.name}&#39;); ax.grid(alpha=0.5)</span>
<span class="c1">#     ax.set(xlabel=&#39;Energy&#39;, ylabel=&#39;Energy flux&#39;,  xlim=(100,None), title=&#39;Spectra&#39;);</span>
<span class="c1">#     base_spectrum = eval(KerrExposure.base_spectrum)</span>
<span class="c1">#     edom = config.energy_bins[:12]</span>
<span class="c1">#     ax.loglog(edom, base_spectrum(edom)*edom**2/3e3, &#39;-&#39; , label=&#39;Kerr base&#39;)</span>
<span class="c1">#     ax.legend();</span>
<span class="c1">#     ax2.plot(&#39;energy&#39;, &#39;flux&#39;, &#39;o--&#39;,data=bf_df,label=f&#39;{source.name}&#39;); ax2.grid(alpha=0.5)</span>
<span class="c1">#     edom2 = np.logspace(2.125,4)</span>
<span class="c1">#     ax2.plot(edom2, base_spectrum(edom2)/6e9, &#39;-&#39; , label=&#39;Kerr base&#39;)</span>
<span class="c1">#     ax2.set(xlabel=&#39;Energy&#39;, ylabel=&#39;Count flux&#39;);</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

</div>
 

